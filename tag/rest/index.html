<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="es-ES">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="es-ES">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="es-ES">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>REST | Lógica Alternativa</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://localhost/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link href='https://fonts.gstatic.com/' crossorigin rel='preconnect' />
<link rel="alternate" type="application/rss+xml" title="Lógica Alternativa &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="Lógica Alternativa &raquo; RSS de los comentarios" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Lógica Alternativa &raquo; REST RSS de la etiqueta" href="/tag/rest/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/localhost\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='cptch_stylesheet-css'  href='/wp-content/plugins/captcha/css/front_end_style.css?ver=4.3.6' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='/wp-includes/css/dashicons.min.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='cptch_desktop_style-css'  href='/wp-content/plugins/captcha/css/desktop_style.css?ver=4.3.6' type='text/css' media='all' />
<link rel='stylesheet' id='st-widget-css'  href='/wp-content/plugins/share-this/css/style.css?ver=4.8.2' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='/wp-content/themes/twentytwelve/style.css?ver=4.8.2' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://localhost/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='counterize_stylesheet-css'  href='/wp-content/plugins/counterize/counterize.css.php?ver=4.8.2' type='text/css' media='all' />
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript' src='/wp-content/plugins/counterize/counterize.js.php?ver=4.8.2'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.2" />

<!-- Bad Behavior 2.2.20 run time: 5.418 ms -->
<script type="text/javascript">
<!--
function bb2_addLoadEvent(func) {
	var oldonload = window.onload;
	if (typeof window.onload != 'function') {
		window.onload = func;
	} else {
		window.onload = function() {
			oldonload();
			func();
		}
	}
}

bb2_addLoadEvent(function() {
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1506273309 127.0.0.1';
			document.forms[i].appendChild(myElement);
		}
	}
});
// --></script>
		<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.2.6'></script>
<script language="JavaScript"><!--
 var DevFmtUrl='http://localhost/wp-content/plugins/devformatter/'; var DevFmtAjaxUrl = 'http://localhost/wp-admin/admin-ajax.php'; //-->
</script>
<script type='text/javascript' src='/wp-content/plugins/devformatter/devfmt_common.js?ver=2015.0.2.1'></script>
<script type='text/javascript' src='/wp-content/plugins/devformatter/devfmt_public.js?ver=2015.0.2.1'></script>
<style type="text/css" media="screen"> @import url( '/wp-content/plugins/devformatter/devfmt_reset.css?ver=2015.0.2.1' ); </style>
<style type="text/css" media="screen"> @import url( '/wp-content/plugins/devformatter/devfmt_css.php?ver=2015.0.2.1' ); </style><script charset="utf-8" type="text/javascript">var switchTo5x=true;</script><script charset="utf-8" type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script><script type="text/javascript">stLight.options({publisher:'wp.08e04e90-ba64-4016-a864-853c9c560eca'});var st_type='wordpress3.5.1';</script></head>

<body class="archive tag tag-rest tag-38 custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="/" title="Lógica Alternativa" rel="home">Lógica Alternativa</a></h1>
			<h2 class="site-description">&#039;¿Otro blog de informática? &#8230; Todavía no&#039; .- Cuaderno de bitácora de Miguel R. Esteban</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menú</button>
			<a class="assistive-text" href="#content" title="Ir al contenido">Ir al contenido</a>
			<div class="nav-menu"><ul>
<li ><a href="/">Inicio</a></li><li class="page_item page-item-30"><a href="/mi-cv/">Mi CV</a></li>
<li class="page_item page-item-122"><a href="/mapa-del-sitio/">Mapa del sitio</a></li>
</ul></div>
		</nav><!-- #site-navigation -->

				<a href="/"><img src="/wp-content/uploads/2013/04/cabecera3.jpg" class="header-image" width="960" height="250" alt="Lógica Alternativa" /></a>
			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<section id="primary" class="site-content">
		<div id="content" role="main">

					<header class="archive-header">
				<h1 class="archive-title">Archivo de la etiqueta: <span>REST</span></h1>

						</header><!-- .archive-header -->

			
	<article id="post-739" class="post-739 post type-post status-publish format-standard hentry category-java category-javascript tag-api tag-java tag-javascript tag-junit tag-maven tag-mock tag-rest tag-spring tag-test">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/mocks-o-el-tdd-y-yo/" rel="bookmark">Mocks&#8230; o el TDD y yo</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<blockquote>
<h1 style="text-align: right;"><em>&#8230; segunda Parte de TDD is dead? … o yo y el TDD</em></h1>
</blockquote>
<p><img src="/wp-content/uploads/2014/10/mockAndTest_p.png" alt="[Mock y test]" width="300" height="294" class="alignright size-full wp-image-780" /><strong>E</strong>ste es el segundo y último artículo de la serie que completa el anterior post <a title="TDD is dead? … o yo y el TDD. Primera Parte" href="/tdd-is-dead-o-yo-y-el-tdd-primera-parte/"><strong>TDD is dead? … o yo y el TDD</strong></a>.</p>
<p>Trataré de explicar como defino y codifico mis propios objetos &#8216;<em>mock</em>&#8216;, y de como los uso tanto para pruebas unitarias, como también en pruebas de integración entre clases.</p>
<p>Y siendo más especifico mostrar como se pueden codificar tres tipos de mock utilizados habitualmente:</p>
<ul>
<li> Simular la <strong>capa de persistencia</strong> a base de datos.</li>
<li> El que se utiliza para <strong>comprobar</strong> que se ha llamado a la <strong>interfaz</strong> que representa desde el objeto que nos interesa probar.</li>
<li>El utilizado simplemente para poder pasar las pruebas y que no nos interesa su comportamiento.</li>
</ul>
<p>Y como dijo el maestro:</p>
<blockquote>
<h1>“&#8230; hablar es barato, vamos a ver un poco de código&#8230;”</h1>
</blockquote>
<h2>Demo</h2>
<p>Para ilustrar el ejemplo utilizaré una aplicación web que mediante un <strong>formulario html</strong> sencillo llamará con <strong>ajax</strong> a un servicio <strong>REST</strong>. Consiste en dar de alta códigos de promoción de una web.</p>
<p><div id="attachment_776" style="width: 460px" class="wp-caption aligncenter"><img src="/wp-content/uploads/2014/10/pantallazoEjemploMock.png" alt="[Pantallazo de la Demo Ejemplo Mock]" width="450" height="251" class="size-full wp-image-776" srcset="/wp-content/uploads/2014/10/pantallazoEjemploMock.png 450w, /wp-content/uploads/2014/10/pantallazoEjemploMock-300x167.png 300w" sizes="(max-width: 450px) 100vw, 450px" /><p class="wp-caption-text">[Pantallado de la demo]</p></div>Los datos que se piden son la promoción, el nombre, el correo electrónico y el código de promoción. Se validará que el correo electrónico no esté ya utilizado y si todo es correcto se enviará el correo a la persona y se mostrarán los datos de los códigos ya dados de alta. </p>
<p>La demo es completamente operativa y se puede usar. Se puede descargar el código aquí:</p>
<p style="text-align: center;"><a title="[MoksExample en GitHub]" href="https://github.com/logicaalternativa/MoksExample" target="_blank"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /><strong>MoksExample</strong></a> en GitHub</p>
<p style="text-align: left;">Los detalles de como funciona y como se puede probar están en el archivo <a title="[Detalles de la DEMO en el README.md]" href="https://github.com/logicaalternativa/MoksExample/blob/master/README.md" target="_blank"><strong>README.md</strong></a></p>
<p style="text-align: left;">La parte de servicios REST es Java, montada sobre <strong>Spring</strong>. En el ecosistema de Spring, <strong>Spring-Data</strong> es el mediador con la capa de persistencia de datos. En el ejemplo se usará como interfaz con la base de datos. Como framework de tests unitarios usaré <strong>Junit</strong>. <strong>Maven</strong> será la herramienta de compilación, ejecución de test y construcción del proyecto. Como es una demo para estos fines se usa <strong>Hsqldb</strong>, base de datos en memoria.</p>
<h2>Simular la capa de persistencia de BBDD</h2>
<p style="text-align: left;">En la demo existen dos entidades <em>PROMOTION</em> y <em>PROMOTION_CODE</em>. La primera es el maestro de promociones y en la segunda se almacenarán todos los códigos de promoción relacionados con las primeras. Los objetos de negocio que las definen son los beans: <a title="[Promtion.java]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/model/Promotion.java" target="_blank"><strong>Promotion</strong></a> y <a title="[PromotionCode.java]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/model/PromotionCode.java" target="_blank"><strong>PromotionCode</strong></a></p>
<p style="text-align: left;"><strong>Spring-Data</strong> se basa en el patrón repositorio. A grandes rasgos y simplificando, Spring-Data implementa la interfaz de las operaciones <em>CRUD</em> y el resto de consultas que se pueden realizar para cada entidad de la capa de persistencia (usualmente una tabla de una base de datos).</p>
<p>Existen por tanto dos interfaces definidos en el pakage <a title="[com.logicaalternativa.ejemplomock.repository] " href="https://github.com/logicaalternativa/MoksExample/tree/master/src/main/java/com/logicaalternativa/ejemplomock/repository" target="_blank"><strong>com.logicaalternativa.ejemplomock.repository</strong></a> cuya misión es definir las operaciones <em>CRUD</em> de las entidades</p>
<ul>
<li><a title="[PromotionRepository.java]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/repository/PromotionRepository.java" target="_blank"><strong>PromotionRepository</strong></a> definido para la entidad  <em>PROMOTION</em></li>
<li><a title="[PromotionCodeRepository]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/repository/PromotionCodeRepository.java" target="_blank"><strong>PromotionCodeRepository</strong></a> definido para la entidad  <em>PROMOTION_CODE</em></li>
</ul>
<p>En este caso los dos extienden del interfaz de Spring-Data <strong>JpaRepository</strong>.</p>
<p>Con Spring-Data sólo tienes que definir la interfaz con las diferentes operaciones de consulta, inserción y modificación que se van a realizar de la entidad y este se encarga de implementar la interfaz. Esto hace que resulte muy fácil codificar tus propios <em><strong>mocks</strong></em>. Después para los test se inyectarán por inversión de control al objeto de negocio.</p>
<p>Para los test he implementado los dos <em>mock</em> de cada uno de los interfaces. Están en el package <a title="[com.logicaalternativa.ejemplomock.repository.mock]" href="https://github.com/logicaalternativa/MoksExample/tree/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock" target="_blank"><strong>com.logicaalternativa.ejemplomock.repository.mock</strong></a> .</p>
<ul>
<li><a title="[PromotionRepositoryMock]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock/PromotionRepositoryMock.java" target="_blank"><strong>PromotionRepositoryMock</strong></a></li>
<li><a title="[PromotionCodeRepositoryMock]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock/PromotionCodeRepositoryMock.java" target="_blank"><strong>PromotionCodeRepositoryMock</strong></a></li>
</ul>
<p>Las dos clases son muy similares y siguen la misma línea. Sólo se ha implementado las operaciones necesarias para realizar los test. La idea es esa <strong>codificar sólo lo estrictamente necesario</strong>. Se añadirá o se modificará código cuando toque, si para un futuro test es necesario implementar algún otro método más.</p>
<p>Centrándome por ejemplo en el mock <strong>PromotionCodeRepositoryMock</strong>, el &#8216;<em>quid de la cuestión</em>&#8216; está en que he definido un atributo lista de tipo <strong>PromotionCode</strong>.<br />
<!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">   <span style="color: #000000; font-weight: bold;">private</span> List<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span> promotionCode<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Este es accesible mediante los métodos públicos:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">   <span style="color: #000000; font-weight: bold;">public</span> List<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span> getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline">   <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setPromotionCode<span style="color: #009900;">&#40;</span>PromotionCode...<span style="color: #006633;">promotionCode</span><span style="color: #009900;">&#41;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">6</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">7</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>He codificado los métodos <em>CRUD</em> para que operen con esta lista. Por ejemplo, así he codificado el método que sirve para obtener un código de promoción a través de su clave primaria.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> PromotionCode findOne<span style="color: #009900;">&#40;</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> email <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>		</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000066; font-weight: bold;">int</span> index <span style="color: #339933;">=</span> findIndex<span style="color: #009900;">&#40;</span> email <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> index <span style="color: #339933;">!=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      <span style="color: #000000; font-weight: bold;">return</span> clone<span style="color: #009900;">&#40;</span> getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span> index <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span>	</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Que lo que hace es encontrar el índice de la lista de códigos de promoción con el mismo email. Si lo encuentra devuelve una copia de ese objeto. Para entrar más en detalle te invito a revisar los métodos <em><strong>findIndex</strong></em>, <em><strong>clone</strong></em> y el resto de métodos que he implementado de <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock/PromotionCodeRepositoryMock.java" title="[PromotionCodeRepositoryMock]"  target="_blank"><strong>PromotionCodeRepositoryMock</strong></a></p>
<p>Otro ejemplo es el método <em><strong>saveAndFlush</strong></em>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #339933;">&lt;</span>S <span style="color: #000000; font-weight: bold;">extends</span> PromotionCode<span style="color: #339933;">&gt;</span> S saveAndFlush<span style="color: #009900;">&#40;</span>S promotionCode <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">     <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">promotionCode</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">     getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">     <span style="color: #000000; font-weight: bold;">return</span> promotionCode <span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> email <span style="color: #339933;">=</span> promotionCode <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">?</span> promotionCode.<span style="color: #006633;">getEmail</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000066; font-weight: bold;">int</span> index <span style="color: #339933;">=</span> findIndex<span style="color: #009900;">&#40;</span> email <span style="color: #009900;">&#41;</span> <span style="color: #339933;">;</span> </pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> index <span style="color: #339933;">==</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">     getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">     getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">set</span><span style="color: #009900;">&#40;</span> index, promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> promotionCode<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">19</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Que busca en la lista el objeto con el mismo email. Si lo encuentra actualiza el objeto de la lista y sino, lo añade a la lista.</p>
<h3>¿Cómo se usa?</h3>
<p>El test <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/bussiness/AddCodeBusinessImpTest.java" title="[AddCodeBusinessImpTest]"  target="_blank"><strong>AddCodeBusinessImpTest</strong></a> prueba el objeto de negocio <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/bussiness/AddCodeBusinessImp.java" title="[AddCodeBusinessImp]" target="_blank"><strong>AddCodeBusinessImp</strong></a>.</p>
<p>La clase de negocio (<strong>AddCodeBusinessImp</strong>) comprueba que existe el código de promoción en la BBDD y utiliza para ello <strong>PromotionRepository</strong>. En el método <em><strong>setUp()</strong></em> del test se inicializa un objeto <strong>PromotionRepositoryMock</strong> con el objeto <strong>Promotion</strong> deseado y este mock se inserta por inversión de control a la instancia de <strong>AddCodeBussinessImp</strong>.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> AddCodeBusinessImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> AddCodeBusinessImp addCodeBusinessImp<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> PromotionRepositoryMock promotionRepositoryMock<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> PromotionCodeRepositoryMock promotionCodeRepositoryMock<span style="color: #339933;">;</span>	</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> Promotion promotion<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Before</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    promotion <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Promotion<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    promotion.<span style="color: #006633;">setIdPromotion</span><span style="color: #009900;">&#40;</span> <span style="color: #cc66cc;">1</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...    </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">promotionRepositoryMock</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> PromotionRepositoryMock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    promotionRepositoryMock.<span style="color: #006633;">setPromotions</span><span style="color: #009900;">&#40;</span> promotion <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    ...  </pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #006633;">addCodeBusinessImp</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> AddCodeBusinessImp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    addCodeBusinessImp.<span style="color: #006633;">setPromotionRepository</span><span style="color: #009900;">&#40;</span> promotionRepositoryMock <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">19</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">20</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">21</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">22</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p><em>promotion</em>, <em>promotionRepositoryMock</em>, <em>addCodeBusinessImp</em> son atributos privados de <strong>AddCodeBusinessImpTest</strong>.</p>
<p>Internamente AddCodeBusinessImp llama al método <em>findOne</em> de PromotionRepository con el identificador de la promoción (el del maestro de promociones) del nuevo código que se quiere insertar.</p>
<p>Si queremos testear que ocurre si no encuentra la promoción en la BBDD, simplemente se hace lo que en el método <em><strong>testPromotionNotBbDd</strong></em> de <strong>AddCodeBusinessImpTest</strong>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> AddCodeBusinessImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Test</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testPromotionNotBbDd<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      promotionRepositoryMock.<span style="color: #006633;">setPromotions</span><span style="color: #009900;">&#40;</span> <span style="color: #009900;">&#40;</span> Promotion<span style="color: #009900;">&#091;</span><span style="color: #009900;">&#093;</span> <span style="color: #009900;">&#41;</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      addCodeBusinessImp.<span style="color: #006633;">validateAndAdd</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      ...</pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Si la lista de promociones en <strong>PromotionRepositoryMock</strong> es nula no se podrá encontrar la promoción (El método <em>findOne</em> devolverá nulo).</p>
<p>En este mismo test también se utiliza <strong>PromotionCodeRepositoryMock</strong>. Inyectado también por inversión de control a la instancia de <strong>AddCodeBusinessImp</strong>, en este caso, sirve para comprobar que se ha insertado el código de promoción. Se hace en el test <em><strong>testOk</strong></em></p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> AddCodeBusinessImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Test</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testOk<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      addCodeBusinessImp.<span style="color: #006633;">validateAndAdd</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      <span style="color: #000000; font-weight: bold;">final</span> List<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span> promotionCodeBbDCodes <span style="color: #339933;">=</span> promotionCodeRepositoryMock.<span style="color: #006633;">getPromotionCode</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      <span style="color: #000066; font-weight: bold;">boolean</span> result <span style="color: #339933;">=</span> promotionCodeBbDCodes <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">                <span style="color: #339933;">&amp;&amp;</span> promotionCodeBbDCodes.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">                <span style="color: #339933;">&amp;&amp;</span> promotionCode.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span> promotionCodeBbDCodes.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span> <span style="color: #cc66cc;">0</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">               <span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      ...</pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Para tener una visión más clara de cual es la idea, lo mejor es revisar cada uno de los test <strong>Junit</strong> de <strong><a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/bussiness/AddCodeBusinessImpTest.java" title="[AddCodeBusinessImpTest]" target="_blank">AddCodeBusinessImpTest</a></strong> Creo que puede ser de gran ayuda para tener una visión global de lo que quiero plantear . He intentado que sean claros y autoexplicativos.</p>
<h2>Mock de comprobación de llamada  a interfaz y datos correctos.</h2>
<p>Lo que interesa en este caso es comprobar que un objeto de negocio  hace la llamada a un interfaz con los datos correctos. Lo que se hace es &#8216;<em>mockear</em>&#8216; esa interfaz capturando los datos de la llamada para comprobar después de que estos son correctos.</p>
<p>En la demo existe un objeto de negocio, <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[SendMailCodePromotionImp]" target="_blank"><strong>SendMailCodePromotionImp</strong></a>, que a partir de una dirección de correo manda el código de promoción por email. Este objeto de negocio realiza internamente una llamada a la interfaz <strong>JavaMailSender</strong> que implementa Spring (<strong>JavaMailSenderImpl</strong>) para enviar el correo electrónico.</p>
<p><a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[JavaMailServerMock]" target="_blank"><strong>JavaMailServerMock</strong></a>, que implementa también el interfaz <strong>JavaMailServer</strong>, es el <em>mock</em> que va a recoger los datos de la llamada. En este caso sólo me interesaba saber la dirección de correo a la que se envía el correo electrónico. Para ello he implementado el método <em><strong>send</strong></em>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> JavaMailServerMock <span style="color: #000000; font-weight: bold;">implements</span> JavaMailSender <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">String</span> sendTo<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Override</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> send<span style="color: #009900;">&#40;</span> MimeMessage mimeMessage <span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> MailException <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #003399;">String</span><span style="color: #009900;">&#091;</span><span style="color: #009900;">&#093;</span> to <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      to <span style="color: #339933;">=</span> mimeMessage.<span style="color: #006633;">getHeader</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;To&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span>MessagingException e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      logger.<span style="color: #006633;">error</span><span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">&quot;[send] &quot;</span>.<span style="color: #006633;">concat</span><span style="color: #009900;">&#40;</span> e.<span style="color: #006633;">getMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span>, e <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      to <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>      </pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    setSendTo<span style="color: #009900;">&#40;</span> to <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">&amp;&amp;</span> to.<span style="color: #006633;">length</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span> <span style="color: #339933;">?</span> to<span style="color: #009900;">&#091;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#093;</span> <span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> getSendTo<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> sendTo<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">19</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">20</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setSendTo<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> sendTo<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">21</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">sendTo</span> <span style="color: #339933;">=</span> sendTo<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">22</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">23</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Se recoge del argumento de entrada la cabecera “<em>To</em>” para almacenarla en un atributo de la clase.</p>
<h3>¿Cómo se usa?</h3>
<p>En el test <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImpTest.java" title="[SendMailCodePromotionImpTest]" target="_blank"><strong>SendMailCodePromotionImpTest</strong></a> se utiliza este Mock. En el método <em><strong>setUp()</strong></em>, se instancia y se inserta por inversión de control al objeto <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[SendMailCodePromotionImp]" target="_blank"><strong>SendMailCodePromotionImp</strong></a>.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SendMailCodePromotionImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> SendMailCodePromotionImp sendMailCodePromotionImp<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> JavaMailServerMock javaMailServerMock<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Before</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">javaMailServerMock</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaMailServerMock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...    </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">sendMailCodePromotionImp</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SendMailCodePromotionImp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">sendMailCodePromotionImp</span>.<span style="color: #006633;">setJavaMailSender</span><span style="color: #009900;">&#40;</span> javaMailServerMock <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>El test <em><strong>testOk</strong></em> de <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImpTest.java" title="[SendMailCodePromotionImpTest]" target="_blank"><strong>SendMailCodePromotionImpTest</strong></a> sirve como ejemplo para comprobar si se ha realizado correctamente la llamada:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SendMailCodePromotionImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testOk<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      sendMailCodePromotionImp.<span style="color: #006633;">sendMailCodePromotion</span><span style="color: #009900;">&#40;</span> email, locale <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> sendTo <span style="color: #339933;">=</span> javaMailServerMock.<span style="color: #006633;">getSendTo</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      <span style="color: #000066; font-weight: bold;">boolean</span> res <span style="color: #339933;">=</span> sendTo <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">              <span style="color: #339933;">&amp;&amp;</span> sendTo.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span> nameUser.<span style="color: #006633;">toUpperCase</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; &lt;&quot;</span> <span style="color: #339933;">+</span> email <span style="color: #339933;">+</span><span style="color: #0000ff;">&quot;&gt;&quot;</span>  <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Donde después de hacer la llamada al método  <em><strong>sendMailCodePromotion</strong></em> del objeto de negocio se obtiene el atributo de <em><strong>sendTo</strong></em> del <em>mock</em> para comprobar que se envía a la misma dirección de correo electrónico.</p>
<p>En este mock sólo se comprueba la cabecera &#8216;<em>To</em>&#8216;. También se podría comprobar el texto del mensaje o cualquier otro dato enviado desde el objeto de negocio.</p>
<h2>Mock para pasar las pruebas</h2>
<p>En la demo he codificado <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/org/springframework/context/mock/MessageSourceMock.java" title="[MessageSourceMock]" target="_blank"><strong>MessageSourceMock</strong></a> que implementa el interfaz <strong>MessageSource</strong>, utilidad que tiene Spring para la internacionalización. Este mock sólo me interesa para poder probar otras funcionalidades. Ha sido necesario codificado porque el objeto de negocio lo necesitaba, pero, en este caso, el resultado de su llamada era irrelevante. Solamente se ha codificado el método <em><strong>getMessage</strong></em> :</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MessageSourceMock <span style="color: #000000; font-weight: bold;">implements</span> MessageSource <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Test</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> getMessage<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> arg0, <span style="color: #003399;">Object</span><span style="color: #009900;">&#091;</span><span style="color: #009900;">&#093;</span> arg1, <span style="color: #003399;">Locale</span> arg2<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> NoSuchMessageException <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> arg0<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">6</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">7</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">8</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Que como puedes comprobar, devuelve directamente la entrada.</p>
<h3>¿Cómo se usa?</h3>
<p>En el test <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImpTest.java" title="[SendMailCodePromotionImpTest]" target="_blank"><strong>SendMailCodePromotionImpTest</strong></a> se utiliza este Mock. En el método <em><strong>setUp()</strong></em>Se instancia y se inserta por inversión de control al objeto<br />
<a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[SendMailCodePromotionImp]" target="_blank"><strong>SendMailCodePromotionImp</strong></a>.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SendMailCodePromotionImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> SendMailCodePromotionImp sendMailCodePromotionImp<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> MessageSourceMock messageSourceMock<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    @Before</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">messageSourceMock</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MessageSourceMock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    sendMailCodePromotionImp <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SendMailCodePromotionImp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #006633;">sendMailCodePromotionImp</span>.<span style="color: #006633;">setMessageSource</span><span style="color: #009900;">&#40;</span> messageSourceMock <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Ya ahora al hacer la llamada <em><strong>getSendTo</strong></em> del objeto de negocio no aparece la tan temida <strong>NullPointerException</strong> 😉</p>
<h2>Conclusiones</h2>
<p>Como se puede ver, con un poco de ingenio es <strong>relativamente sencillo </strong>crearte tus propios objetos mock sin tener que recurrir a Frameworks. La creación de los mock me ayudan a comprender mejor como funciona la aplicación y ver las clases involucradas como verdaderas cajas negras. Esta es la gracia del paradigma de la orientación a objetos.</p>
<p>No necesariamente tiene que llevar demasiado tiempo el codificarlos. Sólo se debería <strong>&#8216;picar&#8217; lo que necesitas cuando lo necesitas</strong> y mucho es reaprobechable. Al final del proyecto seguro que tienes un buen juego de objetos <em>mock</em> para pruebas.</p>
<p>Otra ventaja, es que no hay reflexión, no existe bbdd en memoria para los test, ni ha sido necesario levantar un entorno para pruebas&#8230; el resultado es que los test van &#8216;<em>volaos</em>&#8216;.</p>
<p><a href="/mi-cv/" title="Mi CV" target="_blank">M.E.</a></p>
<blockquote><p><strong>P.D.</strong>: Para  esta demo, de esto que te vas liando y liando&#8230; y poco a poco me &#8216;currado&#8217; un framework MVC hecho en JavaScript. Cuando lo organice un poco será material para próximos post.</p></blockquote>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/api/" rel="tag">API</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/junit/" rel="tag">junit</a>, <a href="/tag/maven/" rel="tag">maven</a>, <a href="/tag/mock/" rel="tag">Mock</a>, <a href="/tag/rest/" rel="tag">REST</a>, <a href="/tag/spring/" rel="tag">Spring</a>, <a href="/tag/test/" rel="tag">Test</a> en <a href="/mocks-o-el-tdd-y-yo/" title="00:24" rel="bookmark"><time class="entry-date" datetime="2014-10-24T00:24:12+00:00">24 octubre, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-427" class="post-427 post type-post status-publish format-standard hentry category-apis category-php tag-api tag-php tag-rest tag-tweets tag-twitter tag-widget">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/tweets-interes-difusion-audiencia-trasteando-api-twiter/" rel="bookmark">Dar valor a los tweets: Interés, difusión, audiencia,&#8230; trasteando con el API de Twitter</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>N</strong>o se puede decir que sea un &#8216;<em>social media</em>&#8216;, pero de un tiempo a esta parte <strong>Twitter</strong> se ha convertido para mi en una fuente de información esencial y casi imprescindible.&nbsp; Tiene un pero, a veces te pierdes entre toda la información que te llega&#8230; Pensando siempre &#8216;<strong>alternativamente</strong>&#8216; me surgieron <strong>estas preguntas</strong>:</p>
<blockquote><p>¿Sé puede hacer un poco más social una red social como Twitter?&#8230; ¿Por qué no mostrar de una manera sencilla como han valorado los demás usuarios el tweet que estás leyendo?&#8230;¿cuánto se ha difundido?&#8230;. ¿Sé puede estimar a cuanta gente a llegado?</p></blockquote>
<p>Lo que me dio pie fue que, para<a title="[747mx.com]" href="http://www.747mx.com/" target="_blank"> 747mx.com</a>, un proyecto hermano de <strong>Lógica Alternativa</strong>, quería incorporar la información de los tweets pero el <strong>widget</strong> oficial me fastidiaba el diseño, no sabía como encajarlo. La solución pasaba en estudiar el <strong>API REST</strong> de <strong>Twitter</strong>. Puesto manos a la obra me di cuenta del mundo de posibilidades que permitía,&#8230; apareció en mi el físico que llevo dentro, ese el que le gusta lo de los coeficientes y esas cosas, la cosa se lío y el resultado fue el siguiente. <a href="/tweets-interes-difusion-audiencia-trasteando-api-twiter/#more-427" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/apis/" rel="category tag">APIs</a>, <a href="/category/programacion/php/" rel="category tag">PHP</a> y está etiquetada con <a href="/tag/api/" rel="tag">API</a>, <a href="/tag/php/" rel="tag">PHP</a>, <a href="/tag/rest/" rel="tag">REST</a>, <a href="/tag/tweets/" rel="tag">tweets</a>, <a href="/tag/twitter/" rel="tag">Twitter</a>, <a href="/tag/widget/" rel="tag">widget</a> en <a href="/tweets-interes-difusion-audiencia-trasteando-api-twiter/" title="20:39" rel="bookmark"><time class="entry-date" datetime="2013-09-17T20:39:54+00:00">17 septiembre, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

		
		</div><!-- #content -->
	</section><!-- #primary -->


			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-3" class="widget widget_text">			<div class="textwidget"><a href="/feed/" title="Suscribirse a este sitio usando RSS 2.0"><img class="alignnone" alt="[RSS]" src="/wp-content/uploads/2013/04/rss_copy.png" width="20" height="20" /></a>&nbsp;&nbsp;<a href="/feed/" title="Suscribirse a este sitio usando RSS 2.0"><abbr title="Really Simple Syndication">RSS</abbr> de las entradas</a></div>
		</aside><aside id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action="/">
				<div>
					<label class="screen-reader-text" for="s">Buscar:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Buscar" />
				</div>
			</form></aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widget-title">Entradas recientes</h3>		<ul>
					<li>
				<a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/">Futuros y promesas,&#8230; y también monadas. Implementando el patrón</a>
						</li>
					<li>
				<a href="/akka-por-ejemplos-actores-tipados/">Actores tipados, Akka por ejemplos</a>
						</li>
					<li>
				<a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/">Akka por ejemplos. Sobre supervisión, bus de eventos, &#8230;</a>
						</li>
					<li>
				<a href="/akka-por-ejemplos/">Akka por ejemplos</a>
						</li>
					<li>
				<a href="/pruebas-de-robustez-y-rendimiento-sobre-cache-y-simple-cache-en-php-y-mas/">Pruebas de robustez y rendimiento, sobre cache y simple cache en PHP y más&#8230;</a>
						</li>
				</ul>
		</aside>		<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Sobre el autor</h3>			<div class="textwidget"><a href="/mi-cv"><a href="/mi-cv/#imagenMiCV"><img class="alignright" alt="[Sobre el autor]" src="/wp-content/uploads/2013/04/miguel_p_90x82_claro.jpg" /></a>
<small>Mi nombre es Miguel Rafael Esteban Martín. Llevo más de 15 años trabajando como&nbsp;analista&nbsp;de software en diferentes empresas, lenguajes de programación y plataformas.<br/>
En este blog hablaré sobre programación y tecnología e intentaré hacerlo de manera clara y amena.<br/>
Actualmente trabajando como <strong>arquitecto software</strong> para ING<br/>
Más sobre mi en el enlace <strong><a href="/mi-cv/#imagenMiCV">Mi CV</a></strong></small>

<p style="text-align: center;"><small><strong>Contacto</strong><br/>
<a href="/mi-cv/#email"><img class="alignnone" alt="[correo electrónico]" src="/wp-content/uploads/2013/04/e_mail_p.png" width="32" height="32" /></a><a href="http://es.linkedin.com/in/miguelresteban"><img class="size-full wp-image-25 alignnone" alt="[Perfil en LinkedIn]" src="/wp-content/uploads/2013/04/linkedin.png" width="32" height="32" /></a><a href="https://twitter.com/MiguelREsteban"><img class="size-full wp-image-25 alignnone" alt="[Perfil en Twitter]" src="/wp-content/uploads/2013/04/twitter.png" width="32" height="32" /></a><a href="https://github.com/logicaalternativa"><img class="size-full wp-image-25 alignnone" alt="[Perfil en GitHub]" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" width="32" height="32" /></a>
</small></p></div>
		</aside><aside id="text-8" class="widget widget_text">			<div class="textwidget"> <!-- De aquí -->
    <div id="twitter"></div>    
    <script type="text/javascript" src="/etc/ejemplos/php/twiter-api/js/carga-widget.js.php"></script>
    <!-- hasta aquí --></div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categorías</h3>		<ul>
	<li class="cat-item cat-item-15"><a href="/category/programacion/android/" >Android</a>
</li>
	<li class="cat-item cat-item-36"><a href="/category/apis/" >APIs</a>
</li>
	<li class="cat-item cat-item-64"><a href="/category/control-de-la-configuracion/" >Control de la configuración</a>
</li>
	<li class="cat-item cat-item-57"><a href="/category/criptografia-y-certificados/" >Criptografía y certificados</a>
</li>
	<li class="cat-item cat-item-10"><a href="/category/general/" >General</a>
</li>
	<li class="cat-item cat-item-14"><a href="/category/programacion/java/" >Java</a>
</li>
	<li class="cat-item cat-item-8"><a href="/category/programacion/javascript/" >JavaScript</a>
</li>
	<li class="cat-item cat-item-21"><a href="/category/la-nube/" >La Nube</a>
</li>
	<li class="cat-item cat-item-87"><a href="/category/programacion/patrones/" >Patrones</a>
</li>
	<li class="cat-item cat-item-3"><a href="/category/programacion/php/" >PHP</a>
</li>
	<li class="cat-item cat-item-20"><a href="/category/programacion/" >Programación</a>
</li>
	<li class="cat-item cat-item-16"><a href="/category/sistemas-operativos/" >Sistemas operativos</a>
</li>
		</ul>
</aside>		</div><!-- #secondary -->
		</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
			<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.es_ES"><img alt="Licencia de Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Lógica Alternativa</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.logicaalternativa.com/mi-cv/" property="cc:attributionName" rel="cc:attributionURL">Miguel Rafael Esteban Martín</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.es_ES">Creative Commons Reconocimiento-NoComercial 3.0 Unported License</a>.		
			<!--
						<a href="https://wordpress.org/" title="Plataforma semántica de publicación personal">Creado con WordPress</a>
			-->
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript' src='/wp-content/themes/twentytwelve/js/navigation.js?ver=20140711'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.8.2'></script>
</body>
</html>
