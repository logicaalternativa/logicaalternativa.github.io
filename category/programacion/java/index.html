<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="es-ES">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="es-ES">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="es-ES">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Java | Lógica Alternativa</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://localhost/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link href='https://fonts.gstatic.com/' crossorigin rel='preconnect' />
<link rel="alternate" type="application/rss+xml" title="Lógica Alternativa &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="Lógica Alternativa &raquo; RSS de los comentarios" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Lógica Alternativa &raquo; Java RSS de la categoría" href="/category/programacion/java/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/localhost\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.29"}};
			!function(t,a,e){var r,n,i,o=a.createElement("canvas"),l=o.getContext&&o.getContext("2d");function c(t){var e=a.createElement("script");e.src=t,e.defer=e.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(e)}for(i=Array("flag","emoji4"),e.supports={everything:!0,everythingExceptFlag:!0},n=0;n<i.length;n++)e.supports[i[n]]=function(t){var e,a=String.fromCharCode;if(!l||!l.fillText)return!1;switch(l.clearRect(0,0,o.width,o.height),l.textBaseline="top",l.font="600 32px Arial",t){case"flag":return(l.fillText(a(55356,56826,55356,56819),0,0),o.toDataURL().length<3e3)?!1:(l.clearRect(0,0,o.width,o.height),l.fillText(a(55356,57331,65039,8205,55356,57096),0,0),e=o.toDataURL(),l.clearRect(0,0,o.width,o.height),l.fillText(a(55356,57331,55356,57096),0,0),e!==o.toDataURL());case"emoji4":return l.fillText(a(55357,56425,55356,57341,8205,55357,56507),0,0),e=o.toDataURL(),l.clearRect(0,0,o.width,o.height),l.fillText(a(55357,56425,55356,57341,55357,56507),0,0),e!==o.toDataURL()}return!1}(i[n]),e.supports.everything=e.supports.everything&&e.supports[i[n]],"flag"!==i[n]&&(e.supports.everythingExceptFlag=e.supports.everythingExceptFlag&&e.supports[i[n]]);e.supports.everythingExceptFlag=e.supports.everythingExceptFlag&&!e.supports.flag,e.DOMReady=!1,e.readyCallback=function(){e.DOMReady=!0},e.supports.everything||(r=function(){e.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",r,!1),t.addEventListener("load",r,!1)):(t.attachEvent("onload",r),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&e.readyCallback()})),(r=e.source||{}).concatemoji?c(r.concatemoji):r.wpemoji&&r.twemoji&&(c(r.twemoji),c(r.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='cptch_stylesheet-css'  href='/wp-content/plugins/captcha/css/front_end_style.css?ver=4.3.6' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='/wp-includes/css/dashicons.min.css?ver=4.7.29' type='text/css' media='all' />
<link rel='stylesheet' id='cptch_desktop_style-css'  href='/wp-content/plugins/captcha/css/desktop_style.css?ver=4.3.6' type='text/css' media='all' />
<link rel='stylesheet' id='st-widget-css'  href='/wp-content/plugins/share-this/css/style.css?ver=4.7.29' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='/wp-content/themes/twentytwelve/style.css?ver=4.7.29' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://localhost/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.7.29" />

<!-- Bad Behavior 2.2.20 run time: 1.106 ms -->
<script type="text/javascript">
<!--
function bb2_addLoadEvent(func) {
	var oldonload = window.onload;
	if (typeof window.onload != 'function') {
		window.onload = func;
	} else {
		window.onload = function() {
			oldonload();
			func();
		}
	}
}

bb2_addLoadEvent(function() {
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1730237625 127.0.0.1';
			document.forms[i].appendChild(myElement);
		}
	}
});
// --></script>
		<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.2.6'></script>
<script language="JavaScript"><!--
 var DevFmtUrl='http://localhost/wp-content/plugins/devformatter/'; var DevFmtAjaxUrl = 'http://localhost/wp-admin/admin-ajax.php'; //-->
</script>
<script type='text/javascript' src='/wp-content/plugins/devformatter/devfmt_common.js?ver=2015.0.2.1'></script>
<script type='text/javascript' src='/wp-content/plugins/devformatter/devfmt_public.js?ver=2015.0.2.1'></script>
<style type="text/css" media="screen"> @import url( '/wp-content/plugins/devformatter/devfmt_reset.css?ver=2015.0.2.1' ); </style>
<style type="text/css" media="screen"> @import url( '/wp-content/plugins/devformatter/devfmt_css.php?ver=2015.0.2.1' ); </style><script charset="utf-8" type="text/javascript">var switchTo5x=true;</script><script charset="utf-8" type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script><script type="text/javascript">stLight.options({publisher:'wp.08e04e90-ba64-4016-a864-853c9c560eca'});var st_type='wordpress3.5.1';</script></head>

<body class="archive category category-java category-14 custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="/" title="Lógica Alternativa" rel="home">Lógica Alternativa</a></h1>
			<h2 class="site-description">&#039;¿Otro blog de informática? &#8230; Todavía no&#039; .- Cuaderno de bitácora de Miguel R. Esteban</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menú</button>
			<a class="assistive-text" href="#content" title="Ir al contenido">Ir al contenido</a>
			<div class="nav-menu"><ul>
<li ><a href="/">Inicio</a></li><li class="page_item page-item-30"><a href="/mi-cv/">Mi CV</a></li>
<li class="page_item page-item-122"><a href="/mapa-del-sitio/">Mapa del sitio</a></li>
</ul></div>
		</nav><!-- #site-navigation -->

				<a href="/"><img src="/wp-content/uploads/2013/04/cabecera3.jpg" class="header-image" width="960" height="250" alt="Lógica Alternativa" /></a>
			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<section id="primary" class="site-content">
		<div id="content" role="main">

					<header class="archive-header">
				<h1 class="archive-title">Archivo de la categoría: <span>Java</span></h1>

						</header><!-- .archive-header -->

			
	<article id="post-1194" class="post-1194 post type-post status-publish format-standard hentry category-funcional category-general category-java category-presentaciones tag-charla tag-java tag-tipos-algebracicos">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/charla-en-madridjugmadrid-gug-sobre-tipos-algebraicos-en-java-21/" rel="bookmark">Charla en MadridJUG/Madrid GUG sobre tipos algebraicos en Java 21</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>E</strong>l pasado <strong>24 de octubre</strong> dí una charla sobre el soporte completo que se ha dado en <strong>Java 21</strong> a los<strong> tipos algebraicos</strong>. Estuvo muy bien, sobre todo por el debate que se estableció durante la charla y en el networking posterior.</p>
<p style="text-align: center;"><strong><a href="http://www.logicaalternativa.com/slides/algebraic-data-types/index.html"><img class="aligncenter wp-image-1195 size-full" src="/wp-content/uploads/2024/02/miniaturaTiposAlgebraicos.png" alt="" width="300" height="131" /></a>Diapositivas presentación: <a href="http://www.logicaalternativa.com/slides/algebraic-data-types/index.html">Tipos algebraicos en Java 21</a></strong></p>
<p style="text-align: left;">El repositorio de código:</p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/algebraictypes"><img class="wp-image-1134 size-full alignnone" src="/wp-content/uploads/2018/12/GitHub-Mark-32px.png" alt="" width="32" height="32" /></a>  <a href="https://github.com/logicaalternativa/algebraictypes"><strong>https://github.com/logicaalternativa/algebraictypes</strong></a></p>
<p>y también el video del directo de la charla</p>
<p style="text-align: center;"><iframe title="YouTube video player" src="https://www.youtube-nocookie.com/embed/egNdxs0RpF4?si=FH5CNg2s68XelsJB" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/funcional/" rel="category tag">Funcional</a>, <a href="/category/general/" rel="category tag">General</a>, <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/presentaciones/" rel="category tag">Presentaciones</a> y está etiquetada con <a href="/tag/charla/" rel="tag">Charla</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/tipos-algebracicos/" rel="tag">Tipos algebracicos</a> en <a href="/charla-en-madridjugmadrid-gug-sobre-tipos-algebraicos-en-java-21/" title="20:52" rel="bookmark"><time class="entry-date" datetime="2023-10-24T20:52:04+00:00">24 octubre, 2023</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-1182" class="post-1182 post type-post status-publish format-standard hentry category-funcional category-general category-java category-patrones category-presentaciones category-programacion category-reactiva tag-charla tag-commitconf tag-dsl tag-java tag-programacion-functional tag-programacion-reactiva">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/charla-commit-conf-2023-sobre-programacion-funcional-y-patrones-funcionales/" rel="bookmark">Charla Commit Conf 2023 sobre programación funcional y patrones funcionales</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>E</strong>l pasado <strong>21 de abril</strong> di una charla sobre <strong>programación reactiva</strong> y como tener conocimiento de los<strong> patrones funcionales</strong> pueden ayudar a entender mejor este tipo de programación.</p>
<p>En la charla también introduzco el concepto de <strong>DSL</strong> (<em>Domain Specific Language</em>) que permiten de una manera real abstraer nuestro código de la tecnología escogida.</p>
<p>En otro orden de cosas, para mí fue un honor que la organización del <strong>Commit Conf</strong> confiara en mí para ser ponente.</p>
<p>Aquí están las diapositivas de la presentación</p>
<p style="text-align: center;"><a href="http://www.logicaalternativa.com/slides/programacion-reactiva-patrones-funcionales"><img class="aligncenter wp-image-1190 size-full" src="/wp-content/uploads/2023/05/presentacionCommitConf2023.png" alt="Presentación Commit Conf 2023" width="300" height="171" /></a><strong>Diapositivas presentación: <a href="http://www.logicaalternativa.com/slides/programacion-reactiva-patrones-funcionales">Programación reactiva y patrones funcionales</a></strong></p>
<p>y el vídeo de la charla</p>
<p style="text-align: center;"><iframe title="YouTube video player" src="https://www.youtube-nocookie.com/embed/3FD00P0lEpY" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/funcional/" rel="category tag">Funcional</a>, <a href="/category/general/" rel="category tag">General</a>, <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/patrones/" rel="category tag">Patrones</a>, <a href="/category/presentaciones/" rel="category tag">Presentaciones</a>, <a href="/category/programacion/" rel="category tag">Programación</a>, <a href="/category/programacion/reactiva/" rel="category tag">Reactiva</a> y está etiquetada con <a href="/tag/charla/" rel="tag">Charla</a>, <a href="/tag/commitconf/" rel="tag">CommitConf</a>, <a href="/tag/dsl/" rel="tag">DSL</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/programacion-functional/" rel="tag">Programación Functional</a>, <a href="/tag/programacion-reactiva/" rel="tag">programación reactiva</a> en <a href="/charla-commit-conf-2023-sobre-programacion-funcional-y-patrones-funcionales/" title="22:37" rel="bookmark"><time class="entry-date" datetime="2023-05-27T22:37:31+00:00">27 mayo, 2023</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-1035" class="post-1035 post type-post status-publish format-standard hentry category-java category-patrones tag-futuros tag-java tag-patrones">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/" rel="bookmark">Futuros y promesas,&#8230; y también monadas. Implementando el patrón</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<blockquote><p><strong>«Los modelos NIO no bloqueantes y la programación asíncrona y reactiva son paradigmas que poco a poco van adoptándose y utilizando más</strong>.»</p></blockquote>
<p>Los modelos <em><strong>NIO</strong></em> no bloqueantes y la programación <strong>asíncrona</strong> y <strong>reactiva</strong> son paradigmas que poco a poco van adoptándose y utilizando más. No creo que diga una tontería al afirmar que muy probablemente serán la norma en un futuro cercano. La razón es clara: aunque no se obtiene un rendimiento mejor que los modelos tradicionales sincrónicos, si son modelos mucho <strong>más eficientes</strong>. Obtienen el mismo rendimiento con menos recursos al tener un mejor control de los hilos, uno de los recursos más preciados en un sistema operativo.</p>
<div style="width: 310px" class="wp-caption alignright"><img src="/wp-content/uploads/2017/08/future.png" alt="Futuros y promesas" width="300" height="252" /><p class="wp-caption-text">Futuros y promesas</p></div>
<p>Para poder articular una programación asíncrona y reactiva es necesario utilizar patrones adaptados a este tipo de programación. Puedes utilizar el patrón <strong>observable</strong> o las <strong>señales</strong>,  pero casi podríamos decir que tu camino te llevará irremisiblemente al patrón <strong>futuro</strong> en cuando tienes que integrar varios resultados asíncronos. Si además nuestra implementación del patrón futuros-promesas cumple con las propiedades de las <strong>monadas</strong> se nos abre un mudo de posibilidades. Con la programación funcional, la composición de futuros se podrá hacer de una manera elegante obteniendo un código más legible.</p>
<p>Esto permite realizar <strong>DSL&#8217;s</strong> (Domain Specific Language) y separar la lógica de negocio de los efectos de lado. Por ahora “<em>&#8230; ahí lo dejo</em>”; prefiero no perder foco en el objetivo de este artículo, pero en mi mente esta tratar todo esto en una nueva reseña. En este artículo entraré a desarrollar todos estos nuevos conceptos intentando desmitificarlos, porque al principio todo lo de “<em>Futuros</em>”, “<em>Promesas</em>” y “<em>Mónadas</em>” puede que suene “<em>muy místico</em>”. Lo haré apoyado en mi propia implementación del patrón Futuros y promesas que está disponible en mi GitHub.</p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/AlternativeFuture" target="_blank" rel="noopener"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a> <a href="https://github.com/logicaalternativa/AlternativeFuture" target="_blank" rel="noopener">AlternativeFuture</a></p>
<p>La implementación está basada “<em>fuertemente</em>” en el Api de Scala de futuros y sólo recordar que Akka en su versión de Java la exporta directamente y que además los futuros de Scala son también monadas. Cuando digo que me apoyo en el Api de Scala me refiero a seguir la definición de su contrato, de hecho, no me interesaba el código fuente y si hacer el ejercicio de, a partir de su interfaz, realizar mi propia implementación en Java. El código que podéis ver y utilizar es todo mio. Hecha esta aclaración es el momento de empezar a entrar en faena.</p>
<p>Intentaré hacer un acercamiento de dentro a fuera. Primero pondré el foco en las ideas principales para ir después abriendo el zoom y conseguir tener la imagen completa.</p>
<h2>Futuros</h2>
<p>«<em>¿Qué es un futuro?</em>» Pongámonos en contexto. Imaginemos dos procesos: uno será el principal que llamará a un método que devuelve un futuro de un valor. El otro será el que calcule realmente el valor de manera asíncrona ejecutado en un segundo plano con respecto al principal. Voy a poner un ejemplo para hacerlo más didáctico. <strong>A</strong>na (el hilo <strong>A</strong>, el principal) le dice a <strong>B</strong>artolo (el hilo <strong>B</strong>) que haga la colada (llamada al método)</p>
<div style="width: 610px" class="wp-caption aligncenter"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/futuresanabartolo-1/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-1-e1502818196258.png" alt="Llamada asíncrona" width="600" height="344" /></a><p class="wp-caption-text">1. Llamada asíncrona</p></div>
<p>El proceso principal obtiene un futuro como resultado de llamar a un método que se lanzará en segundo plano gracias al hilo B. En el ejemplo<strong> B</strong>artolo manda una nota (representa el futuro) a <strong>A</strong>na que le permitirá apuntar lo  que se quiere que se haga con la colada cuando haya terminado <strong>B</strong>artolo. El hilo <strong>A</strong> no queda a la espera del resultado de la acción ejecutada por el hilo <strong>B</strong> y queda liberado para realizar otras operaciones. En el ejemplo <strong>A</strong>na no espera a que <strong>B</strong>artolo termine y  puede seguir haciendo otras tareas.</p>
<div style="width: 620px" class="wp-caption aligncenter"><a href="/futuresanabartolo-2/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-2.png" alt="2. Se devuelve un futuro" width="610" height="350" /></a><p class="wp-caption-text">2. Se devuelve un futuro</p></div>
<p>Este futuro es en realidad un artefacto que permite asignar, desde el proceso principal una función <em>callback</em>. En el siguiente paso, <strong>A</strong>na decidirá que es lo que quiere hacer cuando termine la colada, es decir, asignará la función callback que se ejecutará cuando se obtenga el resultado del segundo proceso ejecutado por <strong>B</strong>artolo.</p>
<div style="width: 620px" class="wp-caption aligncenter"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/futuresanabartolo-3/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-3.png" alt="Asignar callback" width="610" height="350" /></a><p class="wp-caption-text">3. Asignar callback</p></div>
<p>Cuando, gracias al segundo proceso, se haya calculado finalmente el valor, se ejecutará la función de regreso al que se le pasará como argumento el valor final obtenido. En el ejemplo tenemos la función «<em>planchar la ropa</em>» y el resultado del proceso: «<em>la ropa lavada»</em>.</p>
<div style="width: 620px" class="wp-caption aligncenter"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/futuresanabartolo-4/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-4.png" alt="Resultado del futuro" width="610" height="350" /></a><p class="wp-caption-text">4. Resultado del futuro</p></div>
<h3>Contextos de ejecución</h3>
<p>La ejecución de las funciones callback con el valor final como argumento se hará dentro de lo que se llama un <strong>contexto de ejecución</strong>. Este no es más que un pool de hilos que permite <strong>independizar la ejecución</strong> de la función con el valor final tanto del hilo principal como del segundo proceso, es decir, se ejecutarán en un tercer hilo “<em>reutilizable</em>”. En el ejemplo que estamos siguiendo es <strong>C</strong>arlos (el hilo <strong>C</strong>) el que plancha la  ropa.</p>
<div style="width: 620px" class="wp-caption alignright"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/futuresanabartolo-5/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-5.png" alt="Ejecución de la función callback con el valor del futuro" width="610" height="490" /></a><p class="wp-caption-text">Ejecución de la función callback con el valor del futuro</p></div>
<p>En la implementación del patrón que he propuesto a cada una de las funciones callback y de orden superior definidas en el interfaz futuro se le puede pasar un contexto de ejecución.</p>
<h2>Más cosas de los futuros</h2>
<p>A grandes rasgos, esta es la esencia: el futuro permite configurar desde la ejecución principal que hacer cuando finalmente exista el valor. Y se hace sin tener que bloquear hilos porque sino arruinamos la asincronía.</p>
<p>Teniendo esto en mente y sin perder de vista lo simple de este concepto, base de todo, voy a ir añadiendo nuevos conceptos e ideas que nos permitirá ir completando la visión general del patrón.</p>
<h3>Dos caminos</h3>
<p>Añadiendo una nueva capa a las funciones <em>callback</em>. El resultado de la ejecución de cualquier método puede ser, o bien su valor, o bien que su ejecución se haya saldado con un error, luego el resultado final que contiene un futuro puede ser:</p>
<ul>
<li>un valor correcto</li>
<li>o también una excepción.</li>
</ul>
<p>¿Por qué no contemplar esta circunstancia con dos caminos? Un camino para cuando el valor sea correcto con su correspondiente función <em>callback</em> (el método <strong><em>onSuccess</em></strong>) y otro que nos permita definir otra función de regreso cuando se produzca un error (el método <strong><em>onFailure</em></strong>)</p>
<hr />
<h4 style="padding-left: 90px;"><span style="color: #808080;">Signatura de un <strong><em>onSuccess</em></strong> y <strong><em>onFailure</em></strong> de <strong><em>AlternativeFuture[T]</em></strong>:</span></h4>
<h5 style="padding-left: 90px;"><span style="color: #808080;">onSuccess</span></h5>
<p><pre style="padding-left: 90px;"><span style="color: #808080;"><strong>void</strong> onSuccesful( final <strong>Consumer</strong>&lt;<strong>T</strong>&gt; function, final <strong>Executor</strong> executor );</span></pre></p>
<p style="padding-left: 90px;"><span style="color: #808080;">El argumento <strong><em>function</em></strong> es una función cuyo argumento es de tipo <strong><em>T</em></strong> (es el tipo del valor final del futuro) y resultado <strong><em>void</em></strong>.</span></p>
<p><pre style="padding-left: 90px;"><span style="color: #808080;">function: <strong>T</strong> =&gt; <strong>void</strong></span></pre></p>
<p style="padding-left: 90px;"><span style="color: #808080;">Esta será la función que se ejecutaría cuando de resultado final del futuro ha ido bien.</span></p>
<h5 style="padding-left: 90px;"><span style="color: #808080;">onFailure</span></h5>
<p><pre style="padding-left: 90px;"><span style="color: #808080;"><strong>void</strong> onFailure ( final <strong>Consumer</strong>&lt;<strong>Throwable</strong>&gt; function, final <strong>Executor</strong> executor );</span></pre></p>
<p style="padding-left: 90px;"><span style="color: #808080;">En este caso el argumento <strong><em>function</em></strong> es una función cuyo argumento es un Throwable (la excepción que se reportaría si se produciría un error) y resultado <em>void</em>.</span></p>
<p><pre style="padding-left: 90px;"><span style="color: #808080;">function: <strong>Throwable</strong> =&gt; <strong>void</strong></span></pre></p>
<p style="padding-left: 90px;"><span style="color: #333333;"><span style="color: #808080;">Está será la función que se ejecutará cuando el futuro se haya solventado con un error</span>.</span></p>
<hr style="padding-left: 60px;" />
<h3>¿Cuando se ejecuta la función callback?</h3>
<p>Para dar respuesta a esta pregunta nos debemos fijar en que existan las dos cosas necesarias para la ejecución de la función: que exista <strong>la función</strong> y que exista <strong>el valor</strong>. Hay entonces dos posibilidades:</p>
<ul>
<li>Puede que ya haya asignada una o varias funciones callback al futuro, entonces la ejecución de las mismas será cuando se obtenga el valor.</li>
<li>O bien puede ser que se obtenga primero el valor y el disparador de que la función se ejecute será la propia asignación de la función callback.</li>
</ul>
<p>Es importante tener en mente que un futuro (“barra” promesa, esto lo explicaré más adelante), sólo se le puede asignar el valor una vez, además otra característica es que una función callback sólo se ejecutará una vez. Sin embargo se puede asignar al futuro, a lo largo del tiempo, todas las funciones callback que se deseen.</p>
<h2>Promesas</h2>
<p>Si has llegado hasta aquí probablemente ya te habrá asaltado la duda: ¿Cómo se da valor al futuro? ¿Cómo se le asigna un valor? La respuesta: a través de la <strong><em>promesa</em></strong>.</p>
<p>Podemos decir que la promesa y el futuro son las dos caras de la misma moneda y que una promesa está relacionada con un futuro. La idea básica que debemos tener en mente es la siguiente:</p>
<ul>
<li>el futuro permite asignar la función callback para tomar decisiones una vez se haya obtenido el valor</li>
<li>la promesa permite dar valor a ese futuro.</li>
</ul>
<p>Si volvemos al ejemplo anterior, será más sencillo de entender. Si recordamos el proceso principal llamaba a un método que permite en un segundo proceso calcular un valor de manera asíncrona en un tiempo indeterminado (puede ser antes o después). Mientras que el <strong>proceso principal</strong> tiene como herramienta al<strong> interfaz futuro</strong> que le permite indicar que es lo que se debe de hacer una vez se haya calculado el valor,<strong> el interfaz de la promesa</strong> será el instrumento que poseé <strong> el segundo proceso</strong> encargado de calcular el valor para asignar el valor a ese futuro. En síntesis <strong>A</strong>na usaría el futuro y <strong>B</strong>artolo la promesa.</p>
<div style="width: 635px" class="wp-caption alignnone"><a href="/diagramadeactividadespromesasfuturo-2/"><img src="/wp-content/uploads/2017/08/diagramaDeactividadesPromesasFuturo-peque.png" alt="Diagrama de flujo Promesa-Futuro" width="625" height="432" /></a><p class="wp-caption-text">Diagrama de flujo Promesa-Futuro</p></div>
<div style="width: 808px" class="wp-caption aligncenter"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/sequenciapromesasfuturo/"><img src="/wp-content/uploads/2016/11/sequenciaPromesasFuturo.png" alt="Diagrama de secuencia Promesa-Futuro" width="798" height="472" /></a><p class="wp-caption-text">Diagrama de secuencia Promesa-Futuro</p></div>
<hr />
<h4 style="padding-left: 120px;"><span style="color: #808080;">Implementación</span></h4>
<p style="padding-left: 120px;"><span style="color: #808080;">Si echáis un vistazo al código, podéis observar que sólo existe una implementación que implementa las dos interfaces: la promesa y el futuro.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">La clase <a href="https://github.com/logicaalternativa/AlternativeFuture/blob/master/src/main/java/com/logicaalternativa/futures/imp/AlternativePromiseImp.java" target="_blank" rel="noopener"><strong><em>AlternativePromiseImp</em></strong></a> tiene un atributo que permite almacenar el valor del futuro. Este se asignará gracias a los métodos que expone el interfaz promesa <strong><em><a href="https://github.com/logicaalternativa/AlternativeFuture/blob/master/src/main/java/com/logicaalternativa/futures/AlternativePromise.java" target="_blank" rel="noopener">AlternativePromise</a></em></strong>.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">Existen dos atributos más en AlternativePromiseImp que son del tipo de cola FIFO (el primero que entra será el primero que sale). Permiten almacenar las funciones callback gracias a los métodos expuestos por el interfaz <a href="https://github.com/logicaalternativa/AlternativeFuture/blob/master/src/main/java/com/logicaalternativa/futures/AlternativeFuture.java" target="_blank" rel="noopener"><strong><em>AlternativeFuture</em></strong></a>.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">Una de las colas guardará las funciones que se van a ejecutar cuando mediante la promesa relacionada se asigne un valor correcto al futuro. Las funciones se van añadiendo a esta cola utilizando el método &#8216;<em>onSuccesful</em>&#8216; del interfaz AlternativeFuture.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">La otra cola FIFO almacenará las funciones callback que se ejecutarán cuando la promesa relacionada se resuelva con un error. De la misma manera, se van añadiendo estas las funciones gracias al método &#8216;<em>onFailure</em>&#8216; del interfaz AlternativeFuture.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">Bien cuando se asigna un valor a la promesa o bien cuando se añade una función callback al futuro se comprueba que existan los requisitos necesarios (la función y el valor del futuro). Si es así se ejecutará las funciones callback incluidas en la cola de callbacks con el valor final. Según se vayan ejecutando las funciones se eliminarán de la cola.</span></p>
<hr />
<h2>El Futuro como mónada. Programación funcional con AlternativeFuture</h2>
<p>Se puede dar una vuelta de tuerca más y seguir añadiendo capas a la cebolla. El patrón Futuro/promesa permite adoptar un nuevo patrón funcional: la <strong>monada</strong>. Este artículo ya es lo suficientemente extenso, quizás con ya demasiados conceptos así que dejo pospuesto introducir la composición mónadica con AlternativeFuture y os emplazo a un siguiente post continuación de este.</p>
<p><a href="/mi-cv/"><strong><em>M.E.</em></strong></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/patrones/" rel="category tag">Patrones</a> y está etiquetada con <a href="/tag/futuros/" rel="tag">futuros</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/patrones/" rel="tag">patrones</a> en <a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/" title="19:20" rel="bookmark"><time class="entry-date" datetime="2017-08-15T19:20:34+00:00">15 agosto, 2017</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-956" class="post-956 post type-post status-publish format-standard hentry category-general category-java category-programacion tag-actores tag-akka tag-java tag-programacion-reactiva">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/akka-por-ejemplos-actores-tipados/" rel="bookmark">Actores tipados, Akka por ejemplos</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<blockquote><p><strong><span style="color: #808080;">«Tercer y último artículo sobre Akka explicado mediante ejemplos.</span></strong></p>
<p><span style="color: #808080;"><strong>En los dos anteriores se basó en como funcionan la cola de mensajes de un actor, que es un router, como se envían mensajes entre actores. Después se trató temas como la supervisión y el bus de eventos.</strong></span></p>
<p style="text-align: left;"><span style="color: #808080;"><strong>Ahora me centraré en los actores tipados.</strong>«</span></p>
</blockquote>
<p style="text-align: right;"><em>Entrada anterior: <a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/">Akka por ejemplos. Sobre supervisión, bus de eventos, …</a><br />
</em></p>
<p>Todo el código fuente relacionado con esta serie de posts está disponible en mi repositorio de <strong>GitHub</strong></p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a> <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank">AkkaActorsAndFutures</a></p>
<hr />
<h2>Actores tipados</h2>
<p>Los <strong>actores tipados</strong> son una funcionalidad que ofrece <em>Akka</em> recubriendo un <strong>actor no tipado en un interfaz java</strong>. Con un actor tipado el programador realiza llamadas a un método de una clase normal &#8216;<em>sin preocuparse</em>&#8216; (y pongo esto entre comillas por lo que veremos más adelante) de lo que está detrás es un actor de <em>Akka</em>.</p>
<div id="attachment_933" style="width: 230px" class="wp-caption aligncenter"><img class="size-full wp-image-933" src="/wp-content/uploads/2015/10/typedActor-peque.png" alt="[Actor tipado]" width="220" height="158" /><p class="wp-caption-text">[Actor tipado]</p></div>
<p style="text-align: left;">Permite unir los dos mundos, código java estándar con el mundo de los actores. En la documentación de <em>Akka</em> puedes leer que tienen su nicho, pero hay que &#8216;<em>usarlos con moderación</em>&#8216;. Recomiendan que si lo que buscas es una arquitectura de alta escalabilidad utilizar estos actores no es la solución más sencilla. Por ejemplo en este caso, aunque se puede, no es tan natural la supervisión y la monitorización padre-hijo.</p>
<p>Para los actores tipados, <em>Akka</em> utiliza el patrón de <strong><a href="https://en.wikipedia.org/wiki/Active_object" target="_blank">Objetos Activos</a></strong> y proxys de Java. Para levantar un actor tipado es necesario una<strong> interfaz</strong> y una <strong>implementación</strong>. Simplificando, en los actores tipados no existe el método &#8216;<em>onReceive()</em>&#8216; y se utilizan como un clase más de Java haciendo llamadas a los métodos que exporta la interfaz.</p>
<p>En realidad lo que hay detrás es un actor no tipado. <em>Akka</em> monta un proxy en el que el interfaz será la fachada y el &#8216;<em>contrato público</em>&#8216; que podrá utilizar el resto del código java. Los atributos de los métodos de ese interfaz serán los mensajes que se enviarán al actor y la implementación será la que dicte el comportamiento. Por lo demás se cumple con el modelo de actores que asegurá que <strong>no habrá más de un hilo ejecutando el actor</strong>.</p>
<p>Todo esto, que haya un actor detrás de este interfaz, hace que tenga un <strong>comportamiento diferente</strong> al esperado en una clase <em>java, </em>y hay que tenerlo en mente cuando se utilizan actores tipados.</p>
<p>Para los ejemplos se ha utilizado una clase <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/typed/imp/TypedActorDummyImp.java" target="_blank">TypedActorDummyImp</a></em> que implementa el interfaz <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/typed/TypedActorDummy.java" target="_blank">TypedActorDummy</a></em> con una serie de métodos sencillos que permitirán ver con facilidad el funcionamiento de los actores tipados.</p>
<p>He creado dos test, uno <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/typed/TypedActorDummyImpTest.java" target="_blank"><strong><em>TypedActorDummyImpTest.java</em></strong></a> que comprueba el comportamiento en una llamada normal a un método con diferentes tipos de retorno y otro <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/typed/TypedActorDummyImpExceptionsTest.java" target="_blank"><strong><em>TypedActorDummyImpExceptionsTest.java</em></strong></a> para ver cual será su comportamiento si se produce una excepción.</p>
<h3>Comportamiento según el tipo de retorno.</h3>
<p>Un método puede devolver tres tipos de respuesta: o bien es un método que <strong>no devuelve nada</strong> (<em>void</em>), o devuelve <strong>un objeto</strong>, o bien devuelve un <strong>futuro de objeto</strong>.</p>
<h4>Cuando un método devuelve no devuelve nada: void</h4>
<p>Cuando un actor tipado el tipo de respuesta es &#8216;<em>void</em>&#8216;, lo que está ocurriendo es que se está mandando un <strong>mensaje del tipo dispara y olvida</strong> (<em>&#8216;fire-forget</em>&#8216;). En realidad se está enviado un mensaje &#8216;<strong><em>tell</em></strong>&#8216; al actor que hay por detrás, y no se espera respuesta.</p>
<p>Esto hace que tenga un comportamiento un poco &#8216;<em>diferente</em>&#8216; del esperado y es algo que se puede comprobar en los dos ejemplos.</p>
<h5>Test 1: Llamada normal</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpTest#testReturnVoidWithSleep test</strong></pre><br />
En este test se levanta un actor tipado que tiene un método que devuelve <em>void.</em> Se simula una operación costosa con un “<em>Thread.sleep</em>”.</p>
<p>Se comprueba que no se espera a la ejecución del método, sino que se continua inmediatamente con la siguiente orden. El mensaje se ha encolado al actor y este ejecutará la implementación en segundo plano, sin ningún tipo de espera en el hilo principal.</p>
<h5>Test 2: Cuando se produce una excepción</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpExceptionsTest#testRuntimeExceptionVoid test</strong></pre><br />
Como consecuencia de que el mensaje es enviado al actor, ejecutándose en un segundo plano, el hilo principal no es capaz de saber si ha ocurrido un error en la ejecución. Si se produce una excepción no será recogida desde la llamada al método.</p>
<p>El test anterior permite hacer esta comprobación y es bastante didáctico.</p>
<h4>Cuando un método devuelve un futuro</h4>
<h5>Test 1: Llamada normal</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpTest#testFutureEcho test</strong></pre><br />
Cuando se llama a un método de un actor tipado que devuelve un futuro, el comportamiento sería el mismo que si se enviara un mensaje de<strong> petición y respuesta no bloqueante</strong>. Es el equivalente al envío de un mensaje con &#8216;<em>Patterns.ask(&#8230;)&#8217;</em> de un actor no tipado.</p>
<p>Por lo tanto la respuesta se recogerá cuando se resuelve el futuro y no desde la llamada al método. El hilo principal continuaría su ejecución sin esperar.</p>
<h5>Test 2: Cuando se produce una excepción</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpExceptionsTest#testRuntimeExceptionFuture test</strong></pre><br />
Lo mismo pasaría si se produjera una <strong>excepción</strong>, sería<strong> devuelta en la resolución del futuro</strong> y no sería recogida en la llamada al método tipado. Esto entra dentro de lo lógico si pensamos que cuando se produce el error es en el momento en el que se procesa el mensaje por parte del actor.</p>
<h4>Cuando un método devuelve un objeto</h4>
<h5>Test 1: Llamada normal</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpTest#testEcho test</strong></pre></p>
<h5>Test 2: Cuando se produce una excepción</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpExceptionsTest#testRuntimeExceptionString test</strong></pre><br />
Cuando se llama a un método de un actor tipado que devuelve un objeto, el comportamiento es &#8216;<em>parecido</em>&#8216; al esperado. Y digo &#8216;<em>parecido</em>&#8216; porque en realidad lo que se está haciendo es enviando el mensaje al actor y esperando la respuesta (siguiendo un patrón de p<strong>etición-respuesta bloqueante</strong>)</p>
<p>Por lo tanto desde la llamada al método de un actor tipado hace que hilo de ejecución principal espere la respuesta (aunque por detrás se esté enviando un mensaje ejecutándose en otro &#8216;hilo&#8217;). Por lo tanto el comportamiento es &#8216;el mismo&#8217; al acostumbrado (ver el ejemplo 1). En este caso si se produce una excepción si será recogida en la llamada al método (Ver test 2)</p>
<hr />
<p>Como conclusión final de esta serie de posts decir que aunque el modelo de actores y <em>Akka</em> presentan nuevos conceptos, estos una vez aprendidos son sencillos de asimilar.</p>
<p>A cambio ofrece un modo elegante y sencillo de codificar aplicaciones que soporten programación paralela  que sean escalables, robustas y  de alta disponibilidad.</p>
<p>Espero que os sirva.</p>
<p><strong><em><a href="/mi-cv/">M.E.</a></em></strong></p>
<p><!--wp_fromhtmlpreview_devfmt--><!--wp_fromhtmlpreview_devfmt--></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/general/" rel="category tag">General</a>, <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/" rel="category tag">Programación</a> y está etiquetada con <a href="/tag/actores/" rel="tag">actores</a>, <a href="/tag/akka/" rel="tag">akka</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/programacion-reactiva/" rel="tag">programación reactiva</a> en <a href="/akka-por-ejemplos-actores-tipados/" title="21:48" rel="bookmark"><time class="entry-date" datetime="2015-11-09T21:48:05+00:00">9 noviembre, 2015</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-918" class="post-918 post type-post status-publish format-standard hentry category-java category-programacion tag-actores tag-akka tag-bus-de-eventos tag-futuros tag-java tag-programacion-reactiva tag-robustez">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/" rel="bookmark">Akka por ejemplos. Sobre supervisión, bus de eventos, &#8230;</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<blockquote><p><strong><span style="color: #808080;">Esta es la segunda entrega de Akka por ejemplos. La primera trató sobre cual es el funcionamiento de la cola de mensajes de un actor, que es un router y como se envían mensajes entre actores.</span></strong></p>
<p><strong><span style="color: #808080;">Ahora se tratarán temas como el control de fallos y la supervisión de actores, el bus de eventos de Akka y sobre los &#8216;Dead Letters&#8217;</span></strong></p>
<p style="text-align: right;"><em>Entrada anterior: <strong><a href="/akka-por-ejemplos/">Akka por ejemplos</a></strong></em></p>
</blockquote>
<p>Sin más vamos con los ejemplos.</p>
<p>Todo el código fuente relacionado con esta serie de posts está disponible en mi repositorio de <strong>GitHub</strong></p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a> <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank">AkkaActorsAndFutures</a></p>
<hr />
<h2>Control de fallos: Supervisión y monitorización.</h2>
<p><div id="attachment_930" style="width: 230px" class="wp-caption alignright"><a href="/wp-content/uploads/2015/10/supervision-peque.png"><img class="wp-image-930 size-full" src="/wp-content/uploads/2015/10/supervision-peque.png" alt="[Supervisión padre-hijo en Akka]" width="220" height="172" /></a><p class="wp-caption-text">[Supervisión padre-hijo en Akka]</p></div>En <strong><em>Akka</em></strong> la robustez a fallos se basa en la supervisión de actores con jerarquía padre-hijo. El actor que delega tareas en los actores que crea es el que &#8216;<em>supervisa</em>&#8216; y decide que hacer cuando se produce un fallo en alguno de sus hijos.</p>
<p>Se crea así una jerarquía en forma de árbol en la que la que los actores padres supervisan a los actores hijos. El actor &#8216;<em>user</em>&#8216; de <strong><em>Akka</em></strong> será el padre de primera generación de actores que hayamos creado.</p>
<p>Esto es realmente lo que te da la <strong>robustez</strong> (&#8216;<em>resilence</em>&#8216;)  que un sistema reactivo necesita. Esta robustez se pierde cuando se intenta en vez de tener esta jerarquía, ir a un esquema con una mentalidad más tradicional de inyección de dependencias y se cae en la tentación de inyectar actores a otros actores.</p>
<p>Cuando un actor falla y se produce una excepción, su supervisor puede hacer, o bien <strong>reiniciar</strong> el actor, <strong>parar</strong> el actor, <strong>escalar</strong> la excepción o absorber la excepción y <strong>continuar</strong> con la ejecución.</p>
<p>El sistema de supervisión de <em>Akka</em> permite tener la posibilidad de diferente respuesta del supervisor dependiendo del tipo de excepción y si esta afecta a todos los actores supervisados o sólo al que ha fallado. Esto junto con lo anterior permite implementar fácilmente patrones,  por ejemplo de tipo &#8216;<em>circuit breaker</em>&#8216;, si uno de los actores falla.</p>
<p><em>Akka</em> tiene la posibilidad de establecer eventos o disparadores en el ciclo de vida de un actor. Por ejemplo <strong>antes de crearlo</strong>, <strong>antes</strong> y <strong>después</strong> de <strong>reiniciarlo</strong> y cuando se <strong>para</strong>.</p>
<p>Ademas del concepto de supervisión, en <em>Akka</em> existe el de <strong>monitorización</strong>. Cualquier actor, puede &#8216;<em>monitorizar</em>&#8216; a cualquier otro, lo haya creado o no. El primero obtiene un mensaje &#8216;<strong><em>Terminated</em></strong>&#8216; cuando el monitorizado ha terminado. Esto permite modificar su comportamiento o cambiar su estado. En los ejemplos siguientes el actor supervisor también hace de &#8216;<em>monitor</em>&#8216; de sus hijos.</p>
<p>Para poder mostrar con ejemplos como es el comportamiento de las diferentes estrategias a seguir, he creado en el proyecto dos actores: <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank"><strong><em>ActorNoTypedDummyCheckLifeCycle</em></strong></a> y <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLetItCrash.java" target="_blank">ActorNoTypedLetItCrash</a></em></strong>.</p>
<p><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank">ActorNoTypedDummyCheckLifeCycle</a></em> se utiliza para comprobar los eventos que se disparan y por los &#8216;<em>estados</em>&#8216; que pasa un actor cuando es supervisado con diferentes estrategias. Concatena en un atributo &#8216;<em>state</em>&#8216; los diferentes pasos por los &#8216;<em>hooks</em>&#8216; del ciclo de vida de un actor:</p>
<ul>
<li>Método &#8216;<strong><em>aroundPreStart</em></strong>&#8216;: Primer evento que se dispara cuando se inicia un actor. Sólo se ejecuta cuando se inicia un actor por primera vez.</li>
<li>Método &#8216;<strong><em>preStart&#8217;</em></strong>: Se lanzan cuando se inicia un actor o después de que se haya reiniciado.</li>
<li>Método &#8216;<strong><em>aroundPreRestart&#8217;</em></strong>: Cuando un actor va a ser reiniciado, se dispara antes de parada el actor.</li>
<li>Método &#8216;<strong><em>preRestart</em></strong>&#8216;: También se ejecuta antes de parar el actor cuando va a ser reiniciado. La llamada es después de la del método &#8216;<em>aroundPreRestart</em>&#8216;</li>
<li>Método &#8216;<strong><em>postStop</em></strong>&#8216;: Evento que se llama, o bien cuando se para el actor, o bien antes de reiniciarlo (en este último caso justo después de que se llame al método &#8216;<em>preRestart</em>&#8216;)</li>
<li>Método &#8216;<strong><em>postRestart</em></strong>&#8216;: Se lanza después de reiniciar el actor.</li>
<li>Método &#8216;<strong><em>aroundPostStop</em></strong>&#8216;: Se realiza la llamada justo antes de parar definitivamente el actor.</li>
</ul>
<p>El actor <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLetItCrash.java" target="_blank">ActorNoTypedLetItCrash</a></em> es el que creará y hará de supervisor de <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank">ActorNoTypedDummyCheckLifeCycle</a></em>. En su constructor,  permite definir por parámetro la estrategia de supervisión. Su comportamiento será en de hacer de proxy en el envío de mensajes a  <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank">ActorNoTypedDummyCheckLifeCycle</a></em> hasta que este el actor hijo se pare o cuando el mismo se haya reiniciado.</p>
<p>Para mostrar el comportamiento de las diferentes estrategias y cual es el ciclo de vida especifico de los actores (cuando se llama a los diferentes &#8216;<em>hooks</em>&#8216;) he codificado en el proyecto los siguientes ejemplos.</p>
<h3>Estrategia de supervisión por defecto</h3>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/supervisorstrategy/ActorLetItCrashTestDefault.java" target="_blank">ActorLetItCrashTestDefault.java</a></em></strong><br />
<pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.supervisorstrategy.ActorLetItCrashTestDefault test</strong></pre><br />
Si se produce un excepción en un actor hijo, la <strong>estrategia por defecto</strong> en <em>Akka</em> es la de <strong>reiniciar el actor hijo</strong>, excepto si es un error irrecuperable:</p>
<ul>
<li> cuando se ha producido una excepción al inicializar el actor (<strong><em>ActorInitializationException</em></strong>)</li>
<li>cuando ya se había parado el actor(<strong><em>ActorKilledException</em></strong>)</li>
</ul>
<p>Esta estrategia cobra sentido cuando se quiere mantener un sistema estable. La idea subyacente es que cuando se produce un error el sistema debería volver a un estado consistente y esto se consigue reiniciando el estado del actor.</p>
<p>En este ejemplo, los pasos son:</p>
<ol>
<li>Se envía un primer mensaje &#8216;<em>state</em>&#8216; al actor <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLetItCrash.java" target="_blank">ActorNoTypedLetItCrash</a></em>. Este hará el reenvío del mensaje al actor hijo (<em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank">ActorNoTypedDummyCheckLifeCycle</a></em>) que devolverá la concatenación de los diferentes métodos por los que ha pasado hasta ese momento.</li>
<li>Después se envía un mensaje con una excepción para que el actor hijo provoque la excepción.</li>
<li>Por último se vuelve a enviar un mensaje &#8216;<em>state</em>&#8216; para ver por los eventos que se ejecutan cuando se reinicia el actor.</li>
<li>Finalmente para poder ver todo el flujo, se para el actor.</li>
</ol>
<p>El ejemplo permite comprobar el flujo completo del paso de los diferentes eventos a lo largo de la vida del actor hijo. En este caso con la estrategia de supervisión por defecto, es este:<br />
<pre>Se llama al constructor
 =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
  =&gt; Llamada a <strong><em>preStart</em></strong>
   =&gt; [[exception]] Se provoca una excepción
    =&gt; Llamada a <strong><em>aroundPreRestart</em></strong>
     =&gt; Llamada a <strong><em>preRestart</em></strong>
      =&gt; Llamada a <strong><em>postStop</em></strong>
       =&gt; Llamada al constructor (Se vuelve a crear el actor)
        =&gt; Llamada a <em><strong>aroundPostRestart</strong></em>
         =&gt; Llamada a <em><strong>postRestart</strong></em>
          =&gt; Llamada a <em><strong>preStart</strong></em>
           =&gt; Llamada a <em><strong>aroundPostStop</strong></em>
            =&gt; Llamada a <em><strong>postStop</strong></em></pre></p>
<h3>Estrategia de supervisión: Escalar la excepción</h3>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/supervisorstrategy/ActorLetItCrashTestEscalate.java" target="_blank">ActorLetItCrashTestEscalate.java</a></em></strong><br />
<pre><em>Commando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.supervisorstrategy.ActorLetItCrashTestEscalate test</strong>

</pre><br />
¿Qué ocurre cuando se elige una estrategia de supervisión de tipo &#8216;<strong><em>escalate</em></strong>&#8216;? En este caso la excepción en el actor hijo provoca el error también en el actor supervisor. El comportamiento final depende entonces de la propia estrategia de supervisión de este último.</p>
<p>El ejemplo puede ayudar a verlo más claro. En este caso se configura el supervisor (<em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLetItCrash.java" target="_blank">ActorNoTypedLetItCrash</a></em>) para que la estrategia de supervisión sea la de <strong>escalar la excepción</strong>. Cuando se provoca una excepción en el actor supervisado, el resultado es el mismo que si se <strong>hubiera producido en el supervisor</strong>.</p>
<p>El este caso el supervisor tiene la estrategia de supervisión por defecto, que lo reinicia, volviéndose a crear el actor hijo.</p>
<p>En el test se comprueba este hecho cuando se valida todo el ciclo de vida del actor hijo. Se arranca y después de la excepción, se para, para después volver a arrancar sin reinicio. Esto último provocado porque al reiniciarse actor supervisor, el hijo se para y se vuelve a crear:<br />
<pre>Llamada a constructor
 =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
  =&gt; Llamada a  <strong><em>preStart</em></strong>
   =&gt; [[exception]] Se provoca una excepción
    =&gt; Llamada a <strong><em>aroundPostStop</em></strong>
     =&gt; Llamada a <strong><em>postStop</em></strong>
      =&gt; Llamada al constructor (Se vuelve a crear el actor)
       =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
        =&gt; Llamada a <strong><em>preStart</em></strong>
        =&gt; Llamada a <strong><em>aroundPostStop</em></strong>
         =&gt; Llamada a <strong><em>postStop</em></strong></pre></p>
<h3>Estrategia de supervisión &#8216;resume&#8217;: &#8216;Absorber&#8217; la excepción.</h3>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/supervisorstrategy/ActorLetItCrashTestResume.java" target="_blank">ActorLetItCrashTestResume.java</a></em></strong><br />
<pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.supervisorstrategy.ActorLetItCrashTestResume test</strong>
</pre><br />
Si el supervisor adopta una estrategia de &#8216;<em>resume</em>&#8216; si se produce un error la excepción no produce ni el reinicio, ni la parada del actor supervisado. Aunque se haya producido el error, sigue levantado a la espera de procesar nuevos mensajes.</p>
<p>El test ayuda a comprender este tipo de supervisión. Se comprueba que cuando se produce una excepción al procesar un mensaje, no se hace <strong>ninguna llamada</strong> a los métodos del ciclo de vida, ni tampoco se escala la excepción. El siguiente mensaje lo procesa correctamente.</p>
<p>El ciclo de vida del actor supervisado con este tipo de supervisión será:<br />
<pre>Llamada a constructor
 =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
  =&gt; Llamada a <strong><em>preStart</em></strong>
   =&gt; [[exception]] Se provoca una excepción
    =&gt; Llamada a <strong><em>aroundPostStop</em></strong>
     =&gt; Llamada a <strong><em>postStop</em></strong></pre></p>
<h3>Estrategia de supervisión &#8216;stop&#8217;: Parar el actor supervisado.</h3>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/supervisorstrategy/ActorLetItCrashTestStop.java" target="_blank">ActorLetItCrashTestStop.java</a></em></strong><br />
<pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.supervisorstrategy.ActorLetItCrashTestStop test</strong></pre><br />
En este caso, se para el actor supervisado cuando al procesar un mensaje ocurre una excepción.</p>
<p>En el ejemplo se fuerza esta situación. Si se provoca una excepción en el actor supervisado se comprueba que el actor no se vuelve a reiniciar. De hecho si se le vuelve a enviar un mensaje de estado, este se envía a la cola de &#8216;<em>Dead Letters</em>&#8216; porque la referencia al actor ya no apunta a un actor válido.</p>
<p>El ciclo de vida del actor es el siguiente:<br />
<pre>Llamada a constructor
 =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
  =&gt; Llamada a  <strong><em>preStart</em></strong>
   =&gt; [[exception]] Se provoca una excepción
    =&gt; Llamada a <strong><em>aroundPostStop</em></strong>
     =&gt; Llamada a <strong><em>postStop</em></strong></pre><br />
Los mismos pasos que con la estrategia &#8216;<em>resume</em>&#8216;. Pero en este caso no ha sido necesario parar el actor en el test porque &#8216;<em>muere</em>&#8216; después de provocarse la excepción.</p>
<h2>Bus de eventos interno de Akka</h2>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/bus/PublishSimpleSuscribeTest.java" target="_blank">PublishSimpleSuscribeTest.java</a></em></strong><br />
<pre><em>Comando maven
</em><strong>mvn -Dtest=com.logicaalternativa.examples.akka.bus.PublishSimpleSubcribeTest test</strong>
</pre><br />
<strong><em>Akka</em></strong> poseé un bus interno que permite el envío de mensajes siguiendo el patrón <strong>publicador-suscriptor</strong>. Un &#8216;<em>publicador</em>&#8216; envía un mensaje sin saber quien van a ser los receptores. Los actores que quieran recibir ese tipo de mensajes deberán suscribirse a esa publicación.</p>
<p><img class="alignleft size-full wp-image-952" src="/wp-content/uploads/2015/10/busEvent-peque2.png" alt="[Bus de eventos de Akka]" width="250" height="145" />El paradigma cambia. En vez de enviar un mensaje a un actor concreto, es decir, “<em>(Por favor) haz esto</em>”, cuando se <strong>publica un mensaje en el bus</strong> se está diciendo “<em>(A quien pueda interesar) ha ocurrido esto</em>”</p>
<p>En este caso el ejemplo muestra un uso sencillo del bus de <strong><em>Akka</em></strong> para mostrar este patrón.</p>
<p>Se levantan dos actores suscriptores (del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLogEvent.java" target="_blank"><em>ActorNoTypedLogEvent</em></a>) que se suscribirán a mensajes de tipo <em>Integer</em>. La implementación de este actor es sencilla: registra los mensajes del tipo a los que está suscrito y si se le envía un mensaje &#8216;<em>lastMessage</em>&#8216; devolverá el último mensaje que ha registrado.</p>
<p>En el test después de levantar a los dos suscriptores se envía un mensaje al bus de <em>Akka</em>. Después se comprueba que el mensaje le ha llegado a ambos.</p>
<h2>Dead letters</h2>
<p>Test: <em><strong><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/bus/DeadLettersTest.java" target="_blank">DeadLettersTest.java</a></strong></em><br />
<pre><em>Comando maven
</em><strong>mvn -Dtest=com.logicaalternativa.examples.akka.bus.DeadLettersTest test</strong></pre><br />
Un &#8216;<strong><em>dead letter</em></strong>&#8216; se produce cuando <strong>no</strong> se ha podido <strong>entregar un mensaje a un actor</strong>. Un caso típico es cuando el actor receptor del mensaje ya no existe. El &#8216;<em>dead letter</em>&#8216; contiene el<strong> mensaje enviado</strong>, la referencia al <strong>actor que lo envía</strong> y la del que <strong>lo iba a recibir</strong>.</p>
<p>Por defecto <em>Akka</em> informa en el log de la aplicación los dead letters que se producen (esto es configurable). También pública esta información <strong>a través del bus de eventos de <em>Akka</em></strong>, lo que permite que una aplicación tenga la posibilidad de una gestión específica de estos mensajes perdidos.</p>
<p>En el ejemplo para poder provocar un <em>dead letter</em> se crea un actor del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a> pararlo para a continuación enviarle un mensaje. Este mensaje &#8216;<strong><em>se pierde</em></strong>&#8216; y es recogido como &#8216;<em>dead letter</em>&#8216;.</p>
<p>Por otra parte en el ejemplo se está utilizando un actor del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLogEvent.java" target="_blank"><em>ActorNoTypedLogEvent</em></a> configurado para que suscriba en el bus de eventos de <em>Akka</em> los mensajes del tipo <strong><em>DeadLetter</em></strong>.</p>
<p>Cuando se manda un mensaje de &#8216;<em>lastMessage</em>&#8216; al actor <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLogEvent.java" target="_blank"><em>ActorNoTypedLogEvent</em></a> este devolverá la información del mensaje perdido en forma de <em>DeadLetter</em>.</p>
<p>Como comprobación final del test se validará la información contenida en el objeto <strong><em>DeadLetter</em></strong>: el mensaje y la referencia al actor receptor.</p>
<hr />
<p>Hasta aquí este segundo artículo de Akka por ejemplos. El próximo y último artículo de esta serie será sobre <strong>actores tipados</strong>.</p>
<p>Espero que os sirva.</p>
<p><strong><em><a href="/mi-cv/" target="_blank">M.E.</a></em></strong></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/" rel="category tag">Programación</a> y está etiquetada con <a href="/tag/actores/" rel="tag">actores</a>, <a href="/tag/akka/" rel="tag">akka</a>, <a href="/tag/bus-de-eventos/" rel="tag">bus de eventos</a>, <a href="/tag/futuros/" rel="tag">futuros</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/programacion-reactiva/" rel="tag">programación reactiva</a>, <a href="/tag/robustez/" rel="tag">robustez</a> en <a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/" title="23:34" rel="bookmark"><time class="entry-date" datetime="2015-10-25T23:34:53+00:00">25 octubre, 2015</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-861" class="post-861 post type-post status-publish format-standard hentry category-java category-programacion tag-actores tag-akka tag-futuros tag-java tag-programacion-reactiva tag-scala">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/akka-por-ejemplos/" rel="bookmark">Akka por ejemplos</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><span style="color: #808080;"><strong>«Akka representa muchos conceptos nuevos que al principio cuesta asimilar. Para poder entenderlo mejor, he ido creando, poco a poco, una serie de ejemplos que me han permitido comprender mejor el paradigma que conlleva.</strong></span></p>
<p><span style="color: #808080;"><strong> <img class="size-full wp-image-866 alignleft" src="/wp-content/uploads/2015/10/akkaExample.png" alt="[Akkapor ejemplos]" width="250" height="94" /></strong></span></p>
<p><span style="color: #808080;"><strong>Este artículo trata sobre esto, intentar tener una prueba de código de cada nuevo concepto que permita ver cual es su comportamiento y función.»</strong></span></p>
<blockquote>
<p style="text-align: right;">Entrada siguiente: <strong><a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/">Akka por ejemplos. Sobre supervisión, bus de eventos, &#8230;</a></strong></p>
</blockquote>
<p><strong><em>Akka</em></strong> es un framework basado en el modelo de actores que permite dar solución al problema de la <strong>programación concurrente</strong>. Además de formar parte de Scala de manera nativa existe como librería en Java.</p>
<p>Permite diseñar aplicaciones que sean <strong>escalables horizontalmente</strong> de manera transparente, con alta <strong>toleracia a fallos</strong> y <strong>basada en eventos</strong> que permite cumplir el &#8216;<strong><em><a href="http://www.reactivemanifesto.org/" target="_blank">manifiesto reactivo</a></em></strong>&#8216;.</p>
<p>Este será el primer de una seríe de artículos explicando conceptos clave que se utilizan en <strong>Akka mediante ejemplos</strong>. En esta primera parte trataré como funciona las <strong>colas de mensajes</strong> de un actor, que es un <strong>router</strong> y las diferentes maneras de como se pueden enviar <strong>mensajes entre actores</strong>.</p>
<p>En próximas entregas trataré sobre el sistema de <strong>supervisión de los actores</strong> en <em>Akka</em>, como funciona el<strong> bus de eventos</strong> y que son los <strong>actores tipados</strong>.</p>
<p>Esta entrada es eminentemente práctica, te invito a descargarte el proyecto y a que eches un vistazo y ejecutes los ejemplos. Se entenderá mejor lo que quiero explicar en este artículo. Todo el código fuente relacionado con esta serie de post está disponible en mi repositorio de <strong>GitHub</strong></p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a> <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank">AkkaActorsAndFutures</a></p>
<h2>Sobre los test</h2>
<p>La idea fundamental a la hora de realizar los test ha sido la de realizar implementaciones <em>dummy</em> y &#8216;<em>ad hoc</em>&#8216; y, gracias a ellas, montar test que permitieran ver con facilidad cual es el funcionamiento de la pieza que interesa.</p>
<p>Por otra parte, he buscado que el código incluido en los test puedan servir de ejemplo uando se quiera implementar ese mismo concepto en una aplicación real.</p>
<p>Es por esto por lo que he evitado utilizar el framework de <em>Akka</em> de test &#8216;<em>akka-testkit&#8217;</em> y en algunos momentos puede parecer que me he complicado la vida realizando las validaciones cuando se completan los futuros y utilizando agentes de Akka para compartir estados entre actores.</p>
<p>Mucha de la funcionalidad común a todos los actores, como crear el sistema de actores y métodos de utilidad se ha llevado a test base (<em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/testbase/TestBase.java" target="_blank">TestBase</a></em> y <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/testbase/TestBaseTypedActor.java" target="_blank">TestBaseTypedActor</a></em> ) de los que heredan todos los test.</p>
<h2>Prólogo: Los agentes</h2>
<p>Ya que en los test utilizo <strong>agentes</strong>, antes de entrar a explicar los test, intentaré hacer una breve introdución de lo que es un <strong>agente</strong> en <em>Akka.</em></p>
<p>Un agente de <em>Akka</em> permite almacenar un valor y actualizarlo sin problemas de concurrencia. Tienen la particularidad que la <strong>actualización</strong> se realiza de manera <strong>asíncrona</strong>, pero se puede <strong>leer</strong> el valor de manera <strong>síncrona</strong>.</p>
<p>Su funcionamiento es similar a un mailbox de un actor. Se basa en encolar los nuevos valores de tal manera que el valor interno se va actualizando en orden de llegada. No existe concurrencia y por eso su actualización es asíncrona.</p>
<p>Hay que tener en cuenta que cuando se pide su valor de manera síncrona devuelve el valor &#8216;<em>actual</em>&#8216; no el valor &#8216;<em>futuro</em>&#8216; que tendrá cuando se procesen todos los valores encolados hasta ese momento.</p>
<p>Vamos entonces con los test.</p>
<hr />
<h2>Como funciona la cola de mensajes de un Actor</h2>
<p style="padding-left: 30px;">Test: <em><strong><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/queue/ActorQueueTest.java" target="_blank">ActorQueueTest.java</a></strong></em></p>
<p><pre><em>Commando maven:</em><strong>
mvn  −Dtest=com.logicaalternativa.examples.akka.queue.ActorQueueTest test</strong></pre><br />
<div id="attachment_889" style="width: 140px" class="wp-caption alignright"><img class="wp-image-889 size-full" src="/wp-content/uploads/2015/10/maibox-e1444336153949.png" alt="[Un actor, un mailbox]" width="130" height="156" /><p class="wp-caption-text">Un actor, un mailbox</p></div>El modelo de actores nos asegura que<strong> no puede haber más de una ejecución</strong> concurrente de un actor. Es decir, no puede haber más de un hilo ejecutando el código de actor. Los mensajes que se envían al actor se encolan en su &#8216;<em>inbox</em>&#8216; de tal manera que se ejecutan de uno en uno.</p>
<p>En este ejemplo se está levantando dentro del sistema de actores, un actor del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a>. Este tiene una lógica muy sencilla: si se envía un mensaje tipo <em>Long</em> la ejecución se espera los milisegundos indicados en el valor del mensaje. Si el mensaje es de tipo <em>String</em> devuelve un eco del mensaje.</p>
<p>En el test <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/queue/ActorQueueTest.java" target="_blank">ActorQueueTest</a></em> se envía un primer mensaje tipo <em>Long</em> para que se realice una espera y después 10 mensajes de tipo <em>String</em>.</p>
<p>En en la ejecución del test, se puede observar de que aunque se envían todos los mensajes sin esperar la ejecución del actor, en realidad estos se encolan. El actor no procesa el siguiente mensaje hasta que no ha terminado la ejecución anterior.</p>
<p>El resultado es que<strong> los mensajes son procesados por orden de llegada</strong> ya que este actor tiene la implementación por defecto de &#8216;<em>mailbox</em>&#8216; (existen otras implementaciones que permiten prioridades de mensajes). Con lo que realiza la espera del primero de ellos y después el eco del resto.</p>
<p>En este test para comprobar el orden de los mensajes que se están ejecutando en el actor se está utilizando un agente de <em>Akka</em> para guardar el estado de manera asíncrona.  El agente almacena la concatenación de los mensajes tipo cadena que se envían al actor.</p>
<p>Para verificar que el orden de los mensajes enviados es el mismo orden de los mensajes que se han procesado se comprueba que estas dos cadenas son iguales.</p>
<h2>Cómo funciona un Router</h2>
<p style="padding-left: 30px;">Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/queue/ActorQueueRouteRoundRobinTest.java" target="_blank">ActorQueueRouteRoundRobinTest.java</a></em></strong></p>
<p><pre><em>Commando maven</em>
<strong>mvn  −Dtest=com.logicaalternativa.examples.akka.queue.ActorQueueRouteRoundRobinTest test</strong></pre><br />
<em>Akka</em> permite el concepto de &#8216;<strong><em>Router</em></strong>&#8216;. Esto permite asociar en una misma referencia de un actor envolver un grupo de actores del mismo tipo.</p>
<p>Se basa en el mismo concepto que tenemos todos en mente de que es un <em>Router</em>: un frontal al que se envían los mensajes y que se encarga de reenviarlos a sus &#8216;<em>routees</em>&#8216; para que estos los procesen y devolver la respuesta.</p>
<p>Permite un procesamiento en paralelo mayor, al existir más instancias de un actor, pero con la comodidad de tener una referencia única a la que enviar los mensajes.</p>
<p><div id="attachment_896" style="width: 230px" class="wp-caption alignleft"><img class="wp-image-896 size-full" src="/wp-content/uploads/2015/10/router-peque.png" alt="[Concepto de router]" width="220" height="193" /><p class="wp-caption-text">Router</p></div>Cada miembro del router es de hecho un actor y tiene su propia cola. La estrategia del envío de los mensajes a los miembros del enrutador se define al crear este. En el test de ejemplo se está utilizando la estrategia de envío secuencial de mensajes (<em>&#8216;RoundRobinPool&#8217;</em>): se envía un mensaje a un actor del grupo, el siguiente al siguiente actor y así sucesivamente. En la documentación de <em>Akka</em> puedes ver que existen y se pueden utilizar otras estrategias.</p>
<p>El ejemplo levanta un sistema de actores. Se crea un router de 5 actores del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedWhoIam.java" target="_blank"><em>ActorNoTypedWhoIam</em></a>. Este actor tiene una implementación muy sencilla. Se limita a responder en un <em>Map</em> con el mismo mensaje que le envían y su nombre de actor.</p>
<p>Al router se le envían 10 mensajes. En la resolución de cada futuro de respuesta se comprueba que el mensaje es el mismo que se ha enviado. Por otra parte, gracias a la nombre del <em>routee</em>, se guarda la información de que <em>routee</em> ha procesado el mensaje.</p>
<p>Por último se comprueba que a cada actor del grupo del router le ha llegado el mismo número de mensajes (estrategía de envío <em>RoundRobinPool</em>). En este caso son 2 ya que el router lo forman 5 actores y se mandan 10 mensajes.</p>
<p>En las trazas se puede comprobar que el actor con el nombre &#8216;<em>a</em>&#8216; le llegan los mensajes &#8216;<em>0</em>&#8216; y &#8216;<em>5</em>&#8216;, al &#8216;<em>b</em>&#8216; el &#8216;<em>1</em>&#8216; y el &#8216;<em>6</em>&#8216; y así sucesivamente.</p>
<h2>Como se pueden enviar mensajes entre actores</h2>
<p style="padding-left: 30px;">Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/message/ActorProxyTest.java" target="_blank">ActorProxyTest.java</a></em></strong></p>
<p><pre><em>Comando maven</em>
<strong>mvn  -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest test</strong></pre><br />
Fundamentalmente los actores se pueden enviar mensajes de dos maneras diferentes: tipo &#8216;<strong><em>fire &amp; forget</em></strong>&#8216; (dispara y olvida) utilizando la función &#8216;<em>tell</em>&#8216; o bien seguir un esquema <strong><em>petición-respuesta</em></strong> utilizando la función &#8216;<em>ask</em>&#8216;.</p>
<p>Por otra parte un actor puede crear otros actores a los que necesita enviar mensajes. Es muy común que existan actores cuya tarea sea la de orquestar o supervisar el trabajo de los actores que ha creado (&#8216;actores hijos&#8217;), y que una parte de esta tarea sea la de reenviar a sus hijos los mensajes que les llegan. Para estos cosos es muy útil utilizar la función &#8216;<em>forward</em>&#8216;</p>
<p>El ejemplo se crea un actor <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedProxy.java" target="_blank">ActorNoTypedProxy</a></em> que crea un actor hijo del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a>. Recordemos que este último devuelve un echo de los mensajes que se le envían.</p>
<p><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedProxy.java" target="_blank">ActorNoTypedProxy</a></em> hará de proxy para mostrar las diferentes formas de enviar y reenviar mensajes entre actores. Recibe los siguientes mensajes tipo cadena:</p>
<h3>&#8216;<em>forward</em>&#8216;, redirigir el mensaje</h3>
<p><pre><em>Commando maven test 'forward'</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest#testForward test</strong></pre><br />
Cuando recibe un mensaje de este tipo ejecuta llamada al método &#8216;<em>forward</em>&#8216; del actor hijo, con el mismo mensaje. El actor hijo (<a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a>) recibirá el mensaje como si el emisor hubiera sido el que emitió el mensaje al actor <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedProxy.java" target="_blank">ActorNoTypedProxy</a></em>.</p>
<h3>&#8216;<em>redirect</em>&#8216; dispara y olvida</h3>
<p><pre><em>Comando maven test redirect</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest#testRedirectMessageToChild test</strong></pre><br />
El actor que hace de proxy redirecciona el mensaje llamando a la función &#8216;<strong><em>tell</em></strong>&#8216; del hijo indicando que el remitente es el del mensaje original que le llega al proxy. Aquí también el actor hijo (<a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a>) recibirá el mensaje como si el emisor hubiera sido el que emitió el mensaje a <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedProxy.java" target="_blank">ActorNoTypedProxy</a></em>.</p>
<div id="attachment_899" style="width: 230px" class="wp-caption aligncenter"><img class="wp-image-899 size-full" src="/wp-content/uploads/2015/10/forward-peque.png" alt="[forward o 'redirect']" width="220" height="128" /><p class="wp-caption-text">forward o &#8216;redirect&#8217;</p></div>
<h3> &#8216;<em>future</em>&#8216;, petición-respuesta no bloqueante y asíncrona</h3>
<p><pre><em>Comando maven test 'future'</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest#testFutur test</strong></pre><br />
Este es un ejemplo de comportamiento <strong>no bloqueante</strong> y <strong>asíncrono</strong> utilizando los <strong>futuros</strong> de <em><strong>Scala</strong></em> que ofrece <em>Akka</em>. <em>ActorNoTypedProxy</em> utiliza la función &#8216;<em>ask</em>&#8216; para con el mismo mensaje que le ha llegado, preguntar al actor hijo <em>ActorNoTypedDummy</em> y obtener el futuro de la respuesta. Este futuro se envía al remitente del mensaje original.</p>
<p>Al ser este un futuro, si fuera necesario, se puede desde el actor que hace de proxy, operar con él o realizar cualquier tipo de transformación. Por ejemplo se puede registrar un callback, realizar alguna transformación operando con el de manera funcional, etc&#8230;</p>
<p>Para simplificar en el test se espera el resultado de la respuesta y como esta también es un futuro, se espera también a este para obtener el resultado.</p>
<h3> &#8216;<em>await</em>&#8216;, petición-respuesta bloqueante y síncrona</h3>
<p><pre><em>Comando maven test 'await'</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest#testAwaitFutur test</strong></pre><br />
Sigue el mismo esquema que el test anterior pero esperado la respuesta de una manera <strong>síncrona</strong>.</p>
<p>En el actor proxy realiza la misma llamada &#8216;<em>ask</em>&#8216; y a continuación se utiliza la función &#8216;<em>Await</em>&#8216; que espera la resolución del futuro. Se obtiene así un <strong>comportamiento bloqueante</strong> y <strong>síncrono</strong> de<strong> petición-respuesta</strong>.</p>
<hr />
<p>Hasta aquí llega esta primera parte de esta serie de artículos centrados en explicar como funciona Akka con ejemplos. Conceptos como la <strong>supervisión entre actores</strong>, el <strong>bus de eventos</strong> y que son los <strong>actores tipados</strong> serán material de futuras entregas.</p>
<p>Espero que os sirva.</p>
<p><strong><em><a href="/mi-cv/">M.E.</a></em></strong></p>
<blockquote>
<p style="text-align: right;">Entrada siguiente: <strong><a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/">Akka por ejemplos. Sobre supervisión, bus de eventos, &#8230;</a></strong></p>
</blockquote>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/" rel="category tag">Programación</a> y está etiquetada con <a href="/tag/actores/" rel="tag">actores</a>, <a href="/tag/akka/" rel="tag">akka</a>, <a href="/tag/futuros/" rel="tag">futuros</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/programacion-reactiva/" rel="tag">programación reactiva</a>, <a href="/tag/scala/" rel="tag">scala</a> en <a href="/akka-por-ejemplos/" title="20:45" rel="bookmark"><time class="entry-date" datetime="2015-10-12T20:45:56+00:00">12 octubre, 2015</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-739" class="post-739 post type-post status-publish format-standard hentry category-java category-javascript tag-api tag-java tag-javascript tag-junit tag-maven tag-mock tag-rest tag-spring tag-test">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/mocks-o-el-tdd-y-yo/" rel="bookmark">Mocks&#8230; o el TDD y yo</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<blockquote>
<h1 style="text-align: right;"><em>&#8230; segunda Parte de TDD is dead? … o yo y el TDD</em></h1>
</blockquote>
<p><img src="/wp-content/uploads/2014/10/mockAndTest_p.png" alt="[Mock y test]" width="300" height="294" class="alignright size-full wp-image-780" /><strong>E</strong>ste es el segundo y último artículo de la serie que completa el anterior post <a title="TDD is dead? … o yo y el TDD. Primera Parte" href="/tdd-is-dead-o-yo-y-el-tdd-primera-parte/"><strong>TDD is dead? … o yo y el TDD</strong></a>.</p>
<p>Trataré de explicar como defino y codifico mis propios objetos &#8216;<em>mock</em>&#8216;, y de como los uso tanto para pruebas unitarias, como también en pruebas de integración entre clases.</p>
<p>Y siendo más especifico mostrar como se pueden codificar tres tipos de mock utilizados habitualmente:</p>
<ul>
<li> Simular la <strong>capa de persistencia</strong> a base de datos.</li>
<li> El que se utiliza para <strong>comprobar</strong> que se ha llamado a la <strong>interfaz</strong> que representa desde el objeto que nos interesa probar.</li>
<li>El utilizado simplemente para poder pasar las pruebas y que no nos interesa su comportamiento.</li>
</ul>
<p>Y como dijo el maestro:</p>
<blockquote>
<h1>“&#8230; hablar es barato, vamos a ver un poco de código&#8230;”</h1>
</blockquote>
<h2>Demo</h2>
<p>Para ilustrar el ejemplo utilizaré una aplicación web que mediante un <strong>formulario html</strong> sencillo llamará con <strong>ajax</strong> a un servicio <strong>REST</strong>. Consiste en dar de alta códigos de promoción de una web.</p>
<p><div id="attachment_776" style="width: 460px" class="wp-caption aligncenter"><img src="/wp-content/uploads/2014/10/pantallazoEjemploMock.png" alt="[Pantallazo de la Demo Ejemplo Mock]" width="450" height="251" class="size-full wp-image-776" srcset="/wp-content/uploads/2014/10/pantallazoEjemploMock.png 450w, /wp-content/uploads/2014/10/pantallazoEjemploMock-300x167.png 300w" sizes="(max-width: 450px) 100vw, 450px" /><p class="wp-caption-text">[Pantallado de la demo]</p></div>Los datos que se piden son la promoción, el nombre, el correo electrónico y el código de promoción. Se validará que el correo electrónico no esté ya utilizado y si todo es correcto se enviará el correo a la persona y se mostrarán los datos de los códigos ya dados de alta. </p>
<p>La demo es completamente operativa y se puede usar. Se puede descargar el código aquí:</p>
<p style="text-align: center;"><a title="[MoksExample en GitHub]" href="https://github.com/logicaalternativa/MoksExample" target="_blank"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /><strong>MoksExample</strong></a> en GitHub</p>
<p style="text-align: left;">Los detalles de como funciona y como se puede probar están en el archivo <a title="[Detalles de la DEMO en el README.md]" href="https://github.com/logicaalternativa/MoksExample/blob/master/README.md" target="_blank"><strong>README.md</strong></a></p>
<p style="text-align: left;">La parte de servicios REST es Java, montada sobre <strong>Spring</strong>. En el ecosistema de Spring, <strong>Spring-Data</strong> es el mediador con la capa de persistencia de datos. En el ejemplo se usará como interfaz con la base de datos. Como framework de tests unitarios usaré <strong>Junit</strong>. <strong>Maven</strong> será la herramienta de compilación, ejecución de test y construcción del proyecto. Como es una demo para estos fines se usa <strong>Hsqldb</strong>, base de datos en memoria.</p>
<h2>Simular la capa de persistencia de BBDD</h2>
<p style="text-align: left;">En la demo existen dos entidades <em>PROMOTION</em> y <em>PROMOTION_CODE</em>. La primera es el maestro de promociones y en la segunda se almacenarán todos los códigos de promoción relacionados con las primeras. Los objetos de negocio que las definen son los beans: <a title="[Promtion.java]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/model/Promotion.java" target="_blank"><strong>Promotion</strong></a> y <a title="[PromotionCode.java]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/model/PromotionCode.java" target="_blank"><strong>PromotionCode</strong></a></p>
<p style="text-align: left;"><strong>Spring-Data</strong> se basa en el patrón repositorio. A grandes rasgos y simplificando, Spring-Data implementa la interfaz de las operaciones <em>CRUD</em> y el resto de consultas que se pueden realizar para cada entidad de la capa de persistencia (usualmente una tabla de una base de datos).</p>
<p>Existen por tanto dos interfaces definidos en el pakage <a title="[com.logicaalternativa.ejemplomock.repository] " href="https://github.com/logicaalternativa/MoksExample/tree/master/src/main/java/com/logicaalternativa/ejemplomock/repository" target="_blank"><strong>com.logicaalternativa.ejemplomock.repository</strong></a> cuya misión es definir las operaciones <em>CRUD</em> de las entidades</p>
<ul>
<li><a title="[PromotionRepository.java]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/repository/PromotionRepository.java" target="_blank"><strong>PromotionRepository</strong></a> definido para la entidad  <em>PROMOTION</em></li>
<li><a title="[PromotionCodeRepository]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/repository/PromotionCodeRepository.java" target="_blank"><strong>PromotionCodeRepository</strong></a> definido para la entidad  <em>PROMOTION_CODE</em></li>
</ul>
<p>En este caso los dos extienden del interfaz de Spring-Data <strong>JpaRepository</strong>.</p>
<p>Con Spring-Data sólo tienes que definir la interfaz con las diferentes operaciones de consulta, inserción y modificación que se van a realizar de la entidad y este se encarga de implementar la interfaz. Esto hace que resulte muy fácil codificar tus propios <em><strong>mocks</strong></em>. Después para los test se inyectarán por inversión de control al objeto de negocio.</p>
<p>Para los test he implementado los dos <em>mock</em> de cada uno de los interfaces. Están en el package <a title="[com.logicaalternativa.ejemplomock.repository.mock]" href="https://github.com/logicaalternativa/MoksExample/tree/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock" target="_blank"><strong>com.logicaalternativa.ejemplomock.repository.mock</strong></a> .</p>
<ul>
<li><a title="[PromotionRepositoryMock]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock/PromotionRepositoryMock.java" target="_blank"><strong>PromotionRepositoryMock</strong></a></li>
<li><a title="[PromotionCodeRepositoryMock]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock/PromotionCodeRepositoryMock.java" target="_blank"><strong>PromotionCodeRepositoryMock</strong></a></li>
</ul>
<p>Las dos clases son muy similares y siguen la misma línea. Sólo se ha implementado las operaciones necesarias para realizar los test. La idea es esa <strong>codificar sólo lo estrictamente necesario</strong>. Se añadirá o se modificará código cuando toque, si para un futuro test es necesario implementar algún otro método más.</p>
<p>Centrándome por ejemplo en el mock <strong>PromotionCodeRepositoryMock</strong>, el &#8216;<em>quid de la cuestión</em>&#8216; está en que he definido un atributo lista de tipo <strong>PromotionCode</strong>.<br />
<!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">   <span style="color: #000000; font-weight: bold;">private</span> List<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span> promotionCode<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Este es accesible mediante los métodos públicos:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">   <span style="color: #000000; font-weight: bold;">public</span> List<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span> getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline">   <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setPromotionCode<span style="color: #009900;">&#40;</span>PromotionCode...<span style="color: #006633;">promotionCode</span><span style="color: #009900;">&#41;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">6</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">7</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>He codificado los métodos <em>CRUD</em> para que operen con esta lista. Por ejemplo, así he codificado el método que sirve para obtener un código de promoción a través de su clave primaria.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> PromotionCode findOne<span style="color: #009900;">&#40;</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> email <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>		</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000066; font-weight: bold;">int</span> index <span style="color: #339933;">=</span> findIndex<span style="color: #009900;">&#40;</span> email <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> index <span style="color: #339933;">!=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      <span style="color: #000000; font-weight: bold;">return</span> clone<span style="color: #009900;">&#40;</span> getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span> index <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span>	</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Que lo que hace es encontrar el índice de la lista de códigos de promoción con el mismo email. Si lo encuentra devuelve una copia de ese objeto. Para entrar más en detalle te invito a revisar los métodos <em><strong>findIndex</strong></em>, <em><strong>clone</strong></em> y el resto de métodos que he implementado de <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock/PromotionCodeRepositoryMock.java" title="[PromotionCodeRepositoryMock]"  target="_blank"><strong>PromotionCodeRepositoryMock</strong></a></p>
<p>Otro ejemplo es el método <em><strong>saveAndFlush</strong></em>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #339933;">&lt;</span>S <span style="color: #000000; font-weight: bold;">extends</span> PromotionCode<span style="color: #339933;">&gt;</span> S saveAndFlush<span style="color: #009900;">&#40;</span>S promotionCode <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">     <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">promotionCode</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">     getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">     <span style="color: #000000; font-weight: bold;">return</span> promotionCode <span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> email <span style="color: #339933;">=</span> promotionCode <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">?</span> promotionCode.<span style="color: #006633;">getEmail</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000066; font-weight: bold;">int</span> index <span style="color: #339933;">=</span> findIndex<span style="color: #009900;">&#40;</span> email <span style="color: #009900;">&#41;</span> <span style="color: #339933;">;</span> </pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> index <span style="color: #339933;">==</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">     getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">     getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">set</span><span style="color: #009900;">&#40;</span> index, promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> promotionCode<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">19</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Que busca en la lista el objeto con el mismo email. Si lo encuentra actualiza el objeto de la lista y sino, lo añade a la lista.</p>
<h3>¿Cómo se usa?</h3>
<p>El test <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/bussiness/AddCodeBusinessImpTest.java" title="[AddCodeBusinessImpTest]"  target="_blank"><strong>AddCodeBusinessImpTest</strong></a> prueba el objeto de negocio <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/bussiness/AddCodeBusinessImp.java" title="[AddCodeBusinessImp]" target="_blank"><strong>AddCodeBusinessImp</strong></a>.</p>
<p>La clase de negocio (<strong>AddCodeBusinessImp</strong>) comprueba que existe el código de promoción en la BBDD y utiliza para ello <strong>PromotionRepository</strong>. En el método <em><strong>setUp()</strong></em> del test se inicializa un objeto <strong>PromotionRepositoryMock</strong> con el objeto <strong>Promotion</strong> deseado y este mock se inserta por inversión de control a la instancia de <strong>AddCodeBussinessImp</strong>.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> AddCodeBusinessImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> AddCodeBusinessImp addCodeBusinessImp<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> PromotionRepositoryMock promotionRepositoryMock<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> PromotionCodeRepositoryMock promotionCodeRepositoryMock<span style="color: #339933;">;</span>	</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> Promotion promotion<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Before</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    promotion <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Promotion<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    promotion.<span style="color: #006633;">setIdPromotion</span><span style="color: #009900;">&#40;</span> <span style="color: #cc66cc;">1</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...    </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">promotionRepositoryMock</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> PromotionRepositoryMock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    promotionRepositoryMock.<span style="color: #006633;">setPromotions</span><span style="color: #009900;">&#40;</span> promotion <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    ...  </pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #006633;">addCodeBusinessImp</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> AddCodeBusinessImp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    addCodeBusinessImp.<span style="color: #006633;">setPromotionRepository</span><span style="color: #009900;">&#40;</span> promotionRepositoryMock <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">19</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">20</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">21</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">22</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p><em>promotion</em>, <em>promotionRepositoryMock</em>, <em>addCodeBusinessImp</em> son atributos privados de <strong>AddCodeBusinessImpTest</strong>.</p>
<p>Internamente AddCodeBusinessImp llama al método <em>findOne</em> de PromotionRepository con el identificador de la promoción (el del maestro de promociones) del nuevo código que se quiere insertar.</p>
<p>Si queremos testear que ocurre si no encuentra la promoción en la BBDD, simplemente se hace lo que en el método <em><strong>testPromotionNotBbDd</strong></em> de <strong>AddCodeBusinessImpTest</strong>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> AddCodeBusinessImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Test</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testPromotionNotBbDd<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      promotionRepositoryMock.<span style="color: #006633;">setPromotions</span><span style="color: #009900;">&#40;</span> <span style="color: #009900;">&#40;</span> Promotion<span style="color: #009900;">&#091;</span><span style="color: #009900;">&#093;</span> <span style="color: #009900;">&#41;</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      addCodeBusinessImp.<span style="color: #006633;">validateAndAdd</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      ...</pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Si la lista de promociones en <strong>PromotionRepositoryMock</strong> es nula no se podrá encontrar la promoción (El método <em>findOne</em> devolverá nulo).</p>
<p>En este mismo test también se utiliza <strong>PromotionCodeRepositoryMock</strong>. Inyectado también por inversión de control a la instancia de <strong>AddCodeBusinessImp</strong>, en este caso, sirve para comprobar que se ha insertado el código de promoción. Se hace en el test <em><strong>testOk</strong></em></p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> AddCodeBusinessImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Test</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testOk<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      addCodeBusinessImp.<span style="color: #006633;">validateAndAdd</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      <span style="color: #000000; font-weight: bold;">final</span> List<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span> promotionCodeBbDCodes <span style="color: #339933;">=</span> promotionCodeRepositoryMock.<span style="color: #006633;">getPromotionCode</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      <span style="color: #000066; font-weight: bold;">boolean</span> result <span style="color: #339933;">=</span> promotionCodeBbDCodes <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">                <span style="color: #339933;">&amp;&amp;</span> promotionCodeBbDCodes.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">                <span style="color: #339933;">&amp;&amp;</span> promotionCode.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span> promotionCodeBbDCodes.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span> <span style="color: #cc66cc;">0</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">               <span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      ...</pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Para tener una visión más clara de cual es la idea, lo mejor es revisar cada uno de los test <strong>Junit</strong> de <strong><a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/bussiness/AddCodeBusinessImpTest.java" title="[AddCodeBusinessImpTest]" target="_blank">AddCodeBusinessImpTest</a></strong> Creo que puede ser de gran ayuda para tener una visión global de lo que quiero plantear . He intentado que sean claros y autoexplicativos.</p>
<h2>Mock de comprobación de llamada  a interfaz y datos correctos.</h2>
<p>Lo que interesa en este caso es comprobar que un objeto de negocio  hace la llamada a un interfaz con los datos correctos. Lo que se hace es &#8216;<em>mockear</em>&#8216; esa interfaz capturando los datos de la llamada para comprobar después de que estos son correctos.</p>
<p>En la demo existe un objeto de negocio, <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[SendMailCodePromotionImp]" target="_blank"><strong>SendMailCodePromotionImp</strong></a>, que a partir de una dirección de correo manda el código de promoción por email. Este objeto de negocio realiza internamente una llamada a la interfaz <strong>JavaMailSender</strong> que implementa Spring (<strong>JavaMailSenderImpl</strong>) para enviar el correo electrónico.</p>
<p><a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[JavaMailServerMock]" target="_blank"><strong>JavaMailServerMock</strong></a>, que implementa también el interfaz <strong>JavaMailServer</strong>, es el <em>mock</em> que va a recoger los datos de la llamada. En este caso sólo me interesaba saber la dirección de correo a la que se envía el correo electrónico. Para ello he implementado el método <em><strong>send</strong></em>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> JavaMailServerMock <span style="color: #000000; font-weight: bold;">implements</span> JavaMailSender <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">String</span> sendTo<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Override</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> send<span style="color: #009900;">&#40;</span> MimeMessage mimeMessage <span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> MailException <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #003399;">String</span><span style="color: #009900;">&#091;</span><span style="color: #009900;">&#093;</span> to <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      to <span style="color: #339933;">=</span> mimeMessage.<span style="color: #006633;">getHeader</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;To&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span>MessagingException e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      logger.<span style="color: #006633;">error</span><span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">&quot;[send] &quot;</span>.<span style="color: #006633;">concat</span><span style="color: #009900;">&#40;</span> e.<span style="color: #006633;">getMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span>, e <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      to <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>      </pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    setSendTo<span style="color: #009900;">&#40;</span> to <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">&amp;&amp;</span> to.<span style="color: #006633;">length</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span> <span style="color: #339933;">?</span> to<span style="color: #009900;">&#091;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#093;</span> <span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> getSendTo<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> sendTo<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">19</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">20</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setSendTo<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> sendTo<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">21</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">sendTo</span> <span style="color: #339933;">=</span> sendTo<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">22</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">23</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Se recoge del argumento de entrada la cabecera “<em>To</em>” para almacenarla en un atributo de la clase.</p>
<h3>¿Cómo se usa?</h3>
<p>En el test <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImpTest.java" title="[SendMailCodePromotionImpTest]" target="_blank"><strong>SendMailCodePromotionImpTest</strong></a> se utiliza este Mock. En el método <em><strong>setUp()</strong></em>, se instancia y se inserta por inversión de control al objeto <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[SendMailCodePromotionImp]" target="_blank"><strong>SendMailCodePromotionImp</strong></a>.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SendMailCodePromotionImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> SendMailCodePromotionImp sendMailCodePromotionImp<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> JavaMailServerMock javaMailServerMock<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Before</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">javaMailServerMock</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaMailServerMock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...    </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">sendMailCodePromotionImp</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SendMailCodePromotionImp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">sendMailCodePromotionImp</span>.<span style="color: #006633;">setJavaMailSender</span><span style="color: #009900;">&#40;</span> javaMailServerMock <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>El test <em><strong>testOk</strong></em> de <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImpTest.java" title="[SendMailCodePromotionImpTest]" target="_blank"><strong>SendMailCodePromotionImpTest</strong></a> sirve como ejemplo para comprobar si se ha realizado correctamente la llamada:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SendMailCodePromotionImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testOk<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      sendMailCodePromotionImp.<span style="color: #006633;">sendMailCodePromotion</span><span style="color: #009900;">&#40;</span> email, locale <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> sendTo <span style="color: #339933;">=</span> javaMailServerMock.<span style="color: #006633;">getSendTo</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      <span style="color: #000066; font-weight: bold;">boolean</span> res <span style="color: #339933;">=</span> sendTo <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">              <span style="color: #339933;">&amp;&amp;</span> sendTo.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span> nameUser.<span style="color: #006633;">toUpperCase</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; &lt;&quot;</span> <span style="color: #339933;">+</span> email <span style="color: #339933;">+</span><span style="color: #0000ff;">&quot;&gt;&quot;</span>  <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Donde después de hacer la llamada al método  <em><strong>sendMailCodePromotion</strong></em> del objeto de negocio se obtiene el atributo de <em><strong>sendTo</strong></em> del <em>mock</em> para comprobar que se envía a la misma dirección de correo electrónico.</p>
<p>En este mock sólo se comprueba la cabecera &#8216;<em>To</em>&#8216;. También se podría comprobar el texto del mensaje o cualquier otro dato enviado desde el objeto de negocio.</p>
<h2>Mock para pasar las pruebas</h2>
<p>En la demo he codificado <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/org/springframework/context/mock/MessageSourceMock.java" title="[MessageSourceMock]" target="_blank"><strong>MessageSourceMock</strong></a> que implementa el interfaz <strong>MessageSource</strong>, utilidad que tiene Spring para la internacionalización. Este mock sólo me interesa para poder probar otras funcionalidades. Ha sido necesario codificado porque el objeto de negocio lo necesitaba, pero, en este caso, el resultado de su llamada era irrelevante. Solamente se ha codificado el método <em><strong>getMessage</strong></em> :</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MessageSourceMock <span style="color: #000000; font-weight: bold;">implements</span> MessageSource <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Test</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> getMessage<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> arg0, <span style="color: #003399;">Object</span><span style="color: #009900;">&#091;</span><span style="color: #009900;">&#093;</span> arg1, <span style="color: #003399;">Locale</span> arg2<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> NoSuchMessageException <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> arg0<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">6</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">7</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">8</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Que como puedes comprobar, devuelve directamente la entrada.</p>
<h3>¿Cómo se usa?</h3>
<p>En el test <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImpTest.java" title="[SendMailCodePromotionImpTest]" target="_blank"><strong>SendMailCodePromotionImpTest</strong></a> se utiliza este Mock. En el método <em><strong>setUp()</strong></em>Se instancia y se inserta por inversión de control al objeto<br />
<a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[SendMailCodePromotionImp]" target="_blank"><strong>SendMailCodePromotionImp</strong></a>.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SendMailCodePromotionImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> SendMailCodePromotionImp sendMailCodePromotionImp<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> MessageSourceMock messageSourceMock<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    @Before</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">messageSourceMock</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MessageSourceMock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    sendMailCodePromotionImp <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SendMailCodePromotionImp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #006633;">sendMailCodePromotionImp</span>.<span style="color: #006633;">setMessageSource</span><span style="color: #009900;">&#40;</span> messageSourceMock <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Ya ahora al hacer la llamada <em><strong>getSendTo</strong></em> del objeto de negocio no aparece la tan temida <strong>NullPointerException</strong> 😉</p>
<h2>Conclusiones</h2>
<p>Como se puede ver, con un poco de ingenio es <strong>relativamente sencillo </strong>crearte tus propios objetos mock sin tener que recurrir a Frameworks. La creación de los mock me ayudan a comprender mejor como funciona la aplicación y ver las clases involucradas como verdaderas cajas negras. Esta es la gracia del paradigma de la orientación a objetos.</p>
<p>No necesariamente tiene que llevar demasiado tiempo el codificarlos. Sólo se debería <strong>&#8216;picar&#8217; lo que necesitas cuando lo necesitas</strong> y mucho es reaprobechable. Al final del proyecto seguro que tienes un buen juego de objetos <em>mock</em> para pruebas.</p>
<p>Otra ventaja, es que no hay reflexión, no existe bbdd en memoria para los test, ni ha sido necesario levantar un entorno para pruebas&#8230; el resultado es que los test van &#8216;<em>volaos</em>&#8216;.</p>
<p><a href="/mi-cv/" title="Mi CV" target="_blank">M.E.</a></p>
<blockquote><p><strong>P.D.</strong>: Para  esta demo, de esto que te vas liando y liando&#8230; y poco a poco me &#8216;currado&#8217; un framework MVC hecho en JavaScript. Cuando lo organice un poco será material para próximos post.</p></blockquote>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/api/" rel="tag">API</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/junit/" rel="tag">junit</a>, <a href="/tag/maven/" rel="tag">maven</a>, <a href="/tag/mock/" rel="tag">Mock</a>, <a href="/tag/rest/" rel="tag">REST</a>, <a href="/tag/spring/" rel="tag">Spring</a>, <a href="/tag/test/" rel="tag">Test</a> en <a href="/mocks-o-el-tdd-y-yo/" title="00:24" rel="bookmark"><time class="entry-date" datetime="2014-10-24T00:24:12+00:00">24 octubre, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-642" class="post-642 post type-post status-publish format-standard hentry category-control-de-la-configuracion category-java category-javascript tag-ant tag-grunt tag-java tag-javascript">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/aprendiendo-grunt-a-partir-de-ant/" rel="bookmark">Aprendiendo Grunt a partir de Ant</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h2>Prólogo</h2>
<h3>Hace unos años, unos 8 ya &#8230;</h3>
<p><img class="alignright size-full wp-image-657" src="/wp-content/uploads/2014/05/grunt.png" alt="[Grunt logo]" width="240" height="295" />En un proyecto me tocó realizar una &#8216;<strong>builtool</strong>&#8216;. Era una herramienta común que utilizarían todos los demás proyectos no importando su tecnología, <strong>PHP</strong>,<strong>.Net</strong>, <strong>Java</strong>, etc. Obtenía el código del sistema de control de versiones compilaba, paquetizaba y subía la build compilada a otra rama del control de versiones. En realidad era un pre-Maven porque obligaba a una cierta estructura de directorios en los proyectos pero no tenía ni su control de dependencias, ni sus arquetipos para nuevos proyectos. La herramienta estaba hecha en <strong>Ant</strong>.</p>
<p>Realmente nunca me llegó a apasionar ese proyecto, siempre me ha gustado más programar. Pero me ayudó a tener conciencia de la importancia de saber montar el &#8216;<strong><em>Control de la configuración</em></strong>&#8216; de un proyecto y también, como podéis imaginar, a tener bastante soltura con <strong>Ant</strong>.</p>
<h2>Capitulo I</h2>
<h3>… en la actualidad</h3>
<p>Para el <strong>Front</strong> del nuevo proyecto, con mucha carga de JavaScript, teníamos que generar la build  y realizar el despliegue. Para hacer menos pesada y más rápida la descarga necesitamos comprimir html, jasvascript y css y en el caso de estos dos últimos unificarlos en un sólo fichero.  Este proceso también lo  utilizaríamos para hacer despliegue continuo en nuestro entorno de preproducción, utilizando <strong>Jenkins</strong>.</p>
<p><strong>Grunt</strong> se ajustaba perfectamente a nuestras necesidades y además se unificaba las tecnologías. La elección de Grunt en vez de <strong>Gulp</strong>, otra herramienta similar, fue porque el primero está incluido en <strong>Yeoman</strong>, que viene a ser en Javascript lo que Maven es a Java. Una herramienta de gestión de dependencias, arquetipos, generación de buidls, test, etc.., que al igual que <strong>Maven</strong> permite gestionar todo el ciclo de vida de las builds. Elegí Grunt como un primer paso del camino que muy probablemente nos lleve a Yeoman.</p>
<p>Me enfrente al reto aprendiendo algo nuevo desde la perspectiva de algo conocido. Utilizando como punto de apoyo, sin que lo conocido conllevara  a perjuicios iniciales. Estas son las semejanzas, las diferencias y las conclusiones a las que he llegado.</p>
<h2>En que se parecen&#8230;</h2>
<p><strong>Ant</strong> tiene ya mucho recorrido, o dicho de otra manera ya es bastante &#8216;<em>viejuno</em>&#8216;. En cierta forma fue la respuesta de Java al <strong>Make</strong> de C. Surgió de la necesidad de crear una herramienta que pudiera compilar, generar ejecutables y que no dependiera del sistema operativo donde se ejecutara. Permite también la generación de test, despliegue, generación de documentación, etc.</p>
<p><strong>Grunt</strong> está dentro del ecosistema Javascript, es un &#8216;<strong><em>ejecutor de tareas</em></strong>&#8216; y se usa fundamentalmente para realización de builds, su testeo y su despliegue.</p>
<h3>Arquitectura y configuración</h3>
<p>Para utilizar <strong>Ant</strong> es necesario primero tener instalado <strong>Java</strong> y después la distribución de Ant. Algo similar ocurre con <strong>Grunt</strong> para poder usarlo es requisito tener instalado<strong> node.js</strong> y el cliente de Grunt.</p>
<p>Tanto en Ant como en Grunt la <strong>configuración de la build</strong> del proyecto se hace a través de un archivo. Su nombre por defecto en &#8216;<strong><em>build.xml</em></strong>&#8216; en Ant y &#8216;<strong><em>Gruntfile.js</em></strong>&#8216; en Grunt</p>
<h3>Tareas y objetivos</h3>
<p>En esencia tanto en Ant como en Grunt se utilizan las <strong>tareas</strong> disponibles (&#8216;<em>tasks</em>&#8216;) para definir <strong>objetivos</strong> (&#8216;<em>target</em>&#8216;). Los objetivos contienen la configuración de nuestro proyecto utilizando estas tareas&#8230; &#8216;<em>Copia estos ficheros</em>&#8216;, &#8216;<em>borra los ficheros de este tipo</em>&#8216;, etc..</p>
<p>En <strong>Ant</strong> un <em>target</em> pueden depender de otros. Se ejecutarán los <em>targets</em> de los que depende antes que él y lo harán en el orden indicado. Esto permite crear un flujo de ejecución de tareas.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="XML"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;project</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;Ejemplo de build&quot;</span> <span style="color: #000066;">default</span>=<span style="color: #ff0000;">&quot;ejecutar&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;target</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;ejecutar&quot;</span> <span style="color: #000066;">depends</span>=<span style="color: #ff0000;">&quot;clean,crearDistro,crearWar&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/project<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>En este caso &#8216;<em>ejecutar</em>&#8216; sería el target por defecto.</p>
<p>En <strong>Grunt</strong> se definen &#8216;<em>alias</em>&#8216; para el mismo resultado.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Javascript"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #660066;">grunt</span>.<span style="color: #660066;">registerTask</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'default'</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'clean'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'copy'</span><span style="color: #339933;">,</span><span style="color: #3366CC;">'uglify'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'concat'</span><span style="color: #339933;">,</span><span style="color: #3366CC;">'cssmin'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">..</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Eso no significa que no puedas ejecutar <em>targets</em><strong> individuales</strong>. Por ejemplo en Ant para lanzar el target <em>clean</em> sería, ejecutando en el directorio donde está el &#8216;<em>build.xml</em>&#8216;</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ ant clean</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>o en Grunt, ejecutado en el directorio donde está el &#8216;<em>Gruntfile.js</em>&#8216;</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ grunt clean</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<h4>Variables externas</h4>
<p>Tanto en Ant como en Grunt se pueden <strong>pasar variables</strong> al archivo de configuración <strong>desde línea de comandos</strong>, lo que resulta muy útil a la hora de configurar varios entornos del mismo proyecto en el Jenkins.</p>
<p>En <strong>Ant</strong></p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ ant −<span style="color: #007800;">DdirEntorno</span>=prepro</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Usando así la variable en el <em>buid.xml</em></p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="XML"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;target</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;clean&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>	</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;delete</span> <span style="color: #000066;">dir</span>=<span style="color: #ff0000;">&quot;${dirEntorno}&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/target<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>En Grunt:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ grunt −−<span style="color: #007800;">dirEntorno</span>=prepro</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Y el Gruntfile.js</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Javascript"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">clean<span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> main<span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  src<span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'&lt;%= dirEntorno %&gt;'</span><span style="color: #009900;">&#93;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<h2>… y en que se diferencian</h2>
<h3>Xml o Json/Javascript</h3>
<p><strong>Ant</strong> utiliza <em>xml</em> para definir la configuración. Esto hace que, sobre todo al principio, y con archivos de build complejos, que sea bastante rígido y engorroso.</p>
<p><strong>Grunt</strong> en este aspecto utiliza <em>json</em>, un formato mucho más liviano. Además está embebido en un archivo javascript permitiendo utilizar este lenguaje con toda su potencia. Este aspecto le da mucho más flexibilidad que Ant. Aquí es donde se le notan los años a Ant y como muestra Gant,una alternativa en el mundo Groovy que &#8216;pasa&#8217; del xml</p>
<h3>Gestión de dependencias de las tareas</h3>
<p>La filosofía de las dependencias de las tareas es completamente diferente. Ant ,de serie, trae diferentes tareas que ya se pueden usar. Esto no significa que se puedan utilizar otras tareas de terceros. Para esto se usa la tarea &#8216;<em>typedef</em>&#8216;.</p>
<p>La <strong>gestión de dependencias de las librerías</strong> que son necesarias para ejecutar estar tareas es completamente &#8216;<em>a mano&#8217;</em>. No te queda otra que bajarte la librería he incluirla, o bien en tu distribución de ant (en el directorio <em>&#8216;lib&#8217;</em>) o bien dentro de tu <em>home</em> (en el directorio &#8216;<em>.ant/lib</em>&#8216;)</p>
<p>En esto Grunt si que gana por goleada. Por defecto no viene con ninguna tarea predefinida, por lo que eres el que elige cual vas a utilizar, seleccionandola de su <a title="[Plugins de grunt]" href="http://gruntjs.com/plugins" target="_blank">página de plugins</a>. Probablemente existan varias posibilidades a la tarea que estás buscando. Después, para poder utilizarla, Grunt utiliza la potencia del gestor de paquetes de <strong>node.js</strong>, <strong>npm</strong>.</p>
<p>Por ejemplo, para instalar la tarea &#8216;<em>uglify</em>&#8216; que se utiliza para comprimir archivos js, se ejecuta el siguiente comando en el directorio donde este el <strong>Grutfile.js</strong></p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ npm <span style="color: #c20cb9; font-weight: bold;">install</span> grunt−contrib−uglify −−save−dev</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Esto incluye las dependencias en el &#8216;<em>package.json</em>&#8216; (Este fichero se crea al iniciar el proyecto ejecutando &#8216;<em>npm init&#8217;</em>)</p>
<p>Y para pode usar la tarea hay que añadir al <strong>Gruntfile.js</strong>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Javascript"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #660066;">grunt</span>.<span style="color: #660066;">loadNpmTasks</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'grunt−contrib−uglify'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Fácil y cómodo, aunque tampoco falto de problemas. Por ejemplo la tarea <em>clean</em> de repente dejo de funcionar en Windows, mientras que el Linux no había problema. El problema, una de las dependencias subió de versión&#8230; y dejo de funcionar. La solución fue añadir la dependencia a la versión que funcionaba directamente en el archivo &#8216;<em>package.json</em>&#8216;. Espero tener tiempo para explicarlo mejor en otro post.</p>
<h2>Epílogo, Conclusiones</h2>
<p>Si eres de Back ,tienes algo de experiencia en Ant y quieres montar tu control de configuración para el Front que está basado en Javascript, trabajar con &#8216;Grunt&#8217; te va a resultar muy familiar.</p>
<p>Son tecnologías diferentes, algunas tareas serán similares y otras más específicas  no encontrarás en Ant, pero la esencia es la misma, así que sin miedo.</p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/control-de-la-configuracion/" rel="category tag">Control de la configuración</a>, <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/ant/" rel="tag">ant</a>, <a href="/tag/grunt/" rel="tag">grunt</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a> en <a href="/aprendiendo-grunt-a-partir-de-ant/" title="23:22" rel="bookmark"><time class="entry-date" datetime="2014-05-11T23:22:48+00:00">11 mayo, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-583" class="post-583 post type-post status-publish format-standard hentry category-java category-javascript tag-concurrencia tag-java tag-javascript tag-vert-x">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/vert-x-mucho-mas-que-trabajar-en-java-como-node-js-y-en-groovy-ruby/" rel="bookmark">Vert.x: Mucho más que trabajar en Java como en node.js.. y en groovy, ruby,&#8230;</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h1>Prueba de concepto: Gateway con websockets y Gtalk utilizando Vert.x</h1>
<p><img class="alignleft size-full wp-image-602" src="/wp-content/uploads/2014/03/logo-white-big.png" alt="[Vert.x Logo]" width="240" height="72" />La primera vez que oí hablar de <a title="Vert.x" href="http://vertx.io/" target="_blank" rel="noopener"><strong>Vert.x</strong></a> fue en la charla sobre el nuevo lenguaje <a title="Ceylang" href="http://ceylon-lang.org/" target="_blank" rel="noopener">Ceylon</a> basado en la JVM que dio <strong>Gavin King</strong>  (la mente pensante detrás de Hibernate) el pasado febrero en <strong>MadridJUG</strong>. Comentó que para la web estaban enfocando sus esfuerzos en un framework asíncrono basado en <strong>Vert.x</strong>.</p>
<p>«<em>¿Asíncrono&#8230;?»</em> Ya se me levantó la ceja a lo &#8216;Sobera&#8217; .. y lo que me dio ya la puntilla es cuando se puso a picar en directo un servidor web (puro live coding :-)) me olía todo tenía un aire a como se trabaja con <strong>node.js</strong>,.. Así que me dije&#8230;»<em>esto de Vert.x me lo tengo que mirar</em>«.</p>
<p>He de reconocer que con el título del post me he pasado&#8230; He estado dándole vueltas a uno que tuviera &#8216;<em>punch</em>&#8216;&#8230; y me parece que he tirado por lo fácil. En realidad Vert.x es mucho más que un servidor web&#8230; Su &#8216;<em>misión</em>&#8216;, &#8216;<em>visión</em>&#8216; y &#8216;<em>valores</em>&#8216; es soportar <strong>millones</strong> <strong>de</strong> <strong>conexiones concurrentes</strong> usando un número mínimo de hilos del sistema operativo (¿¿?? así lo asegura en su documentación), imposibles en un esquema multihilo típico.</p>
<h2>¿Qué es Vert.x?</h2>
<p>Vert.x es un framework basado en eventos que corre en la máquina virtual de Java. Hecho para que sea fácil de <strong>escalar</strong> y soporte a <strong>tolerancia a fallos</strong>. Pensado para que existan de una manera sencilla varios cores en diferentes JVM y que se intercomuniquen entre ellos. <strong>Vert.x</strong> resuelve la concurrencia siguiendo el <a title="Modelo de actores" href="http://en.wikipedia.org/wiki/Actor_model" target="_blank" rel="noopener"><strong>modelo de actores</strong></a> y además asegura que no existirán bloqueos entre hilos. Otra de sus características es su &#8216;<strong><em>bus de eventos</em></strong>&#8216; que permite desacoplar tu aplicación en módulos y comunicarse entre ellos a través de mensajes. Y todo de manera asíncrona.</p>
<p><strong>Vert.x</strong> es &#8216;<strong><em>Políglota</em></strong>&#8216;, soporta <strong>JavaScript</strong>, <strong>Ruby</strong>, <strong>Groovy</strong>, <strong>Java</strong> o <strong>Python</strong> y con vista a soportar <strong>Scala</strong>, <strong>Clojure</strong> e incluso <strong>PHP</strong>. Ejecuta<strong> código fuente</strong> por lo que, por ejemplo, existe la posibilidad de arrancarlo con ficheros &#8216;.java&#8217; sin necesidad de compilarlos.</p>
<h2>Simple hilo ó multihilo</h2>
<p>Llegaréis a la conclusión y la compartiré de que con el título lo he simplificando demasiado ¿Pero porque he hecho esta comparación? Porqué Node.js y Vert.x tienen funcionamientos similares.</p>
<p>En JavaScript no existe la concurrencia. Aunque esta afirmación pueda ser no del todo cierto, porque en <strong>html5</strong> y en el cliente existe los <strong>workers</strong>, en JavaScript sólo existe un hilo y las operaciones que bloquean se ejecutan con llamadas asíncronas.</p>
<p>Y quizás esto, lo que parece su debilidad, es su virtud es esto lo que hace que node.js este valorado como un servidor con poca latencia cuando existe mucha carga .</p>
<p>La diferencia fundamental entre node.js (o Vert.x) y un sistema tradicional multihilo es que la máquina virtual de node utiliza un sólo hilo para atender todas las peticiones. El hilo se limita a recibir la petición y realizar llamadas asíncronas. No espera el resultado de la petición y continua con la siguiente. Más tarde recogerá el resultado para devolverlo al cliente.</p>
<p>Por el contrario en un sistema multihilo, por ejemplo en un despliegue tradicional de Java, existe un hilo para cada petición. Este se queda bloqueado mientras espera el resultado de una operación. Esto hace que bajo mucha carga existan muchos hilos y parte de ellos esperando, lo que repercute en la latencia.</p>
<p><strong>Vert.x</strong> trabaja de igual manera, en este caso utilizando el modelo de actores en el que cada uno de los actores será un &#8216;<strong><em>verticle</em></strong>&#8216;. En la documentación lo definen con una partícula de Vert.x y en la práctica es la manera de definir el código desplegado. Los &#8216;<em>verticles</em>&#8216; se pueden agrupar en <strong>módulos</strong> (lo más usual cuando la aplicación deja de ser trivial) y estos se pueden reutilizar.</p>
<h2>&#8230;Y la prueba de concepto</h2>
<p>Con Vert.x es muy sencillo crear <strong>servidores</strong> y <strong>clientes</strong> <strong>socket</strong>, <strong>ssl</strong>, <strong>http</strong> y <strong>websocket</strong>.</p>
<p>Necesitaba poder familiarizarme con la herramienta y tenía que hacer algo. Es entonces cuando recordé la presentación y demo muy, muy chula que hizo <strong>Iván</strong> <strong>López</strong> en <strong>MadridGUG</strong> utilizando una cuenta de Gtalk como boot. Así que basándome en esa idea he creado una prueba de concepto realizando un <strong>Gateway con WebSockets y Gtalk utilizando Vert.x</strong>. El proyecto es un proyecto <strong>Java</strong>.</p>
<p>Se utiliza una cuenta de Gtalk para poder crear una sala de chat entre usuarios que se conectan por Gtalk y usuarios que se conectan con un navegador mediante websockets.</p>
<p>Este ejemplo no explota todas las posibilidades  de Vert.x como el escalado y el bus de eventos pero si que despliega servidores web y de websocket. Me ha permitido conocer como se genera, se configura y se ejecuta un módulo. En definitiva, ha conseguido mi objetivo que como he dicho más arriba era familiarizarme con el framework</p>
<p>El proyecto lo he subido a <a title="GitHug de lógica alternativa" href="https://github.com/logicaalternativa" target="_blank" rel="noopener">GitHub</a> y que es lo que hace y como está explicado en el <a href="https://github.com/logicaalternativa/gateway-gtalk-websocket-vertx/blob/master/README.md" target="_blank" rel="noopener">README.md </a>.</p>
<p style="text-align: center;"><a title="Prueba de concepto: Gateway WebSockets y Gtalk utilizando Vert.x" href="https://github.com/logicaalternativa/gateway-gtalk-websocket-vertx" target="_blank" rel="noopener"><img class="size-full wp-image-432 alignnone" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a><a href="https://github.com/logicaalternativa/gateway-gtalk-websocket-vertx" target="_blank" rel="noopener"> Prueba de concepto: Gateway WebSockets y Gtalk utilizando Vert.x</a></p>
<p style="text-align: center;"><a title="Archivo README.md" href="https://github.com/logicaalternativa/gateway-gtalk-websocket-vertx/blob/master/README.md" target="_blank" rel="noopener">README.md</a></p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/concurrencia/" rel="tag">Concurrencia</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/vert-x/" rel="tag">vert.x</a> en <a href="/vert-x-mucho-mas-que-trabajar-en-java-como-node-js-y-en-groovy-ruby/" title="23:27" rel="bookmark"><time class="entry-date" datetime="2014-03-09T23:27:12+00:00">9 marzo, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-555" class="post-555 post type-post status-publish format-standard has-post-thumbnail hentry category-java category-javascript tag-java tag-javascript tag-mvc tag-nosql">
				<header class="entry-header">
			<img width="240" height="102" src="/wp-content/uploads/2014/01/foto.jpg" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="Java versus JavaScript" />
						<h1 class="entry-title">
				<a href="/java-versus-javascript-reflexiones/" rel="bookmark">Java versus JavaScript, reflexiones</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>C</strong>on la aparición de <strong>Node.js</strong> y la posibilidad de programar <strong>JavaScript</strong> en servidor se palpa entre los “<em>javeros</em>” cierta, no se encontrar la palabra, &#8230;¿preocupación?. La sensación es de “<em>&#8230;nos están cambiando el agua&#8230;</em>” y el comentario más oído es “<em>&#8230; parece que es lo que se lleva ahora, no me gusta, pero habrá que aprenderlo&#8230;</em>”</p>
<p>A este desasosiego no ayudan post como los de <strong>PayPal</strong> (<a title="[PayPal se pasa a Node.js]" href="https://www.paypal-engineering.com/2013/11/22/node-js-at-paypal/" target="_blank" rel="noopener">enlace</a> ) en el que en resumen dicen que se pasan a JavaScript entre otras cosas porque es más rápido, necesitan menos gente y además se tira menos código. En respuesta a este post ha habido otros que han salido en defensa de Java y para poner coherencia en el tema (<a title="[Replica al post de Paypal]" href="http://developer-blog.cloudbees.com/2013/12/about-paypal-node-vs-java-fight.html?m=1" target="_blank" rel="noopener">enlace</a>)&#8230; y es que es lo que tienen casi todos los benchmark que pecan de partidistas.</p>
<p>En todas las ingenierías, pero mucho más en informática, tienes que estar en continua formación y estar al tanto de lo que se está haciendo. Es cierto que no podemos negar que también va todo un poco por modas y que es todo es cíclico. Parece que más tarde o más temprano siempre volvemos al mismo sitio que nos estamos moviendo en un circulo cerrado. Yo prefiero verlo más como una espiral&#8230; si la ves verticalmente parece que estás en el mismo punto,&#8230; pero que si la ves horizontalmente te das cuenta que estás en un nivel superior. Un ejemplo de esto son las nuevas bases de datos <strong>NOsql</strong>. Puede parecer que vuelven a las bases de datos pre-relacionales pero en realidad aportan muchas más cosas (escalabilidad, rapidez, big data y su explotación).</p>
<p>Pasa lo mismo con JavaScript hace mucho mucho tiempo que ha dejado de ser un lenguaje que sirve para poco más que hacer validaciones y hacer las “<em>cosas bonitas</em>” en la capa de presentación.</p>
<p>El gran problema de los “javeros” que dan sus primeros pasos en JavaScript, entre los que me incluyo, es que a la hora de enfrentarse al nuevo lenguaje piensan “<em>&#8230; al final será algo como Java, con tipado dinámico y bueno con callbacks..</em>. ” y nada más lejos de la realidad, JavaScript es otra filosofía y en realidad casi casi comparte con Java poco más que el nombre y algunas palabras reservadas.</p>
<p>Creo que en el aprendizaje hay que enfrentarse con una actitud diferente y positiva. Me parece muy interesante el trabajo que ha realizado <strong>Micael Gallego </strong>en su blog (<a title="[Blog Micael Gallego]" href="http://micaelgallego.github.io/blog/Viaje-por-las-tecnologias-de-front-end/" target="_blank" rel="noopener">enlace</a>), en el que explica su viaje en el aprendizaje del lenguaje desde el punto de vista de un programador Java y como a lo largo de los diferentes artículos va entendiendo la filosofía de JavaScript. A mi me ha ayudado mucho su lectura, así que no puedo más que recomendarla.</p>
<p>Reconozco que no soy experto en JavaScript y no puedo opinar en profundidad. Pero desde fuera creo que lo bueno y lo malo de JavaScript es que debido a su dinamismo, se pueden hacer las cosas de varias maneras. En Java por el contrario que es todo más cuadriculado.</p>
<p>De todas maneras creo que lo mejor es ser práctico, intentar conocer las debilidades y las fortalezas de cada lenguaje&#8230; Por ejemplo no me platearía hacer una aplicación de escritorio para Widonws en Java, para eso creo que es mucho mejor .NET. Por la misma razón me encontraría más a gusto, en aplicaciones de Backend en un proyecto con un equipo de trabajo numeroso, en un arquitectura Java que en una JavaScript, ya que al ser Java más “estricto” el código tendería ser más uniforme.</p>
<p>Lo que es cierto es que JavaScript permite hacer nuevas arquitecturas muy escalables y derivando gran parte de la responsabilidades al cliente. <strong>Angular.js</strong> es un framework que sigo muy de cerca. Sé que en algunos aspectos puede ser limitado pero prefiero la seguridad de basarme en algo estándar para montar una arquitectura MVC en el cliente.</p>
<p>Además JavaScript, junto con HTML5 se está convirtiendo en la única opción en la parte de navegador. Debido a las restricciones de seguridad que se están poniendo a los <strong>applets</strong> de java y a las <strong>extensiones</strong> y <strong>plugins</strong>. Son un autentico quebradero de cabeza por los agujeros de seguridad encontrados. Un ejemplo, Firefox a partir de su versión 26 no vienen habilitados por defecto los plugins excepto el de Flash.</p>
<p>Por eso en cosas “<em>especiales</em>” en la capa de cliente que por inercia antes te planteabas hacerlas con un applet o una extensión ahora enfocas tus esfuerzos en hacerlas en JavaScript&#8230; y se pueden hacer cosas muy, muy chulas.</p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/mvc/" rel="tag">MVC</a>, <a href="/tag/nosql/" rel="tag">NOsql</a> en <a href="/java-versus-javascript-reflexiones/" title="20:21" rel="bookmark"><time class="entry-date" datetime="2014-01-05T20:21:53+00:00">5 enero, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-532" class="post-532 post type-post status-publish format-standard hentry category-general category-java tag-configuracion tag-externalizar tag-java tag-jetty tag-spring tag-tomcat">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/configuracion-de-entornos-flexible-en-spring-utilizando-spel/" rel="bookmark">Configuración de entornos flexible en Spring utilizando SpEL</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h2>Introducción</h2>
<p>En general cuando desarrollas una aplicación de cualquier tipo te enfrentas al reto de:</p>
<h3 style="padding-left: 30px;">1) Configurar la aplicación de una manera sencilla</h3>
<p style="padding-left: 30px;">La configuración tiene que ser cómoda de modificar y tiene que estar centralizada (evitando que este desperdigada en multitud de ficheros de configuración las rutas, parámetros de conexión etc&#8230;)</p>
<h3 style="padding-left: 30px;">2) Que un mismo ejecutable (jar o war en el caso de java) sirva para diferentes entornos.</h3>
<p style="padding-left: 30px;">Evitar tener que hacer un build para diferentes entornos (Además probablemente en un entorno corporativo no tengas acceso a las contraseñas y a las rutas de los recursos, etc.. de producción) A esto es a lo que me refiero con externalizable.</p>
<p><strong>Spring</strong> es una poderosa y elegante herramienta que permite configurar una aplicación y establecer las dependencias entre sus clases a través de anotaciones o mediante archivos xml.</p>
<p>Pero esta potencia también puede llevar al peligro de que si no somos cuidadosos tengamos los parámetros de conexión, contraseñas, URL y rutas desperdigadas en varios archivos.</p>
<p>Para esto <strong>Spring</strong> ofrece herramientas que permiten cargar propiedades y valores de archivos &#8216;<em>.properties</em>&#8216; y además estos archivos pueden encontrase fuera del jar o del war e incluso pueden estar cifrados. Con esto se soluciona la centralización y la externalización.</p>
<h2>El problema</h2>
<p>Hecha la introducción paso a explicar el problema: Había que configurar una aplicación web en Spring en diferentes entornos en una misma máquina (un entorno en un <strong>Jetty</strong> y otro en un <strong>Tomcat</strong>), por lo que había que externalizar la configuración y además al estar en la misma máquina no servía que la ruta al fichero de configuración fuera fija (de estilo &#8216;<em>/home/usuario/aplicacion.properties</em>&#8216;)</p>
<h2>La solución</h2>
<p>Ha sido utilizar el bean &#8216;<em>PropertyPlaceholderConfigurer</em>&#8216; de <strong>Spring</strong> y utilizar <strong>SpEL</strong> (<em>Spring Expression Language</em>) de esta forma:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="XML"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.0&quot;</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">&quot;UTF-8&quot;</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;beans</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans&quot;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000066;">xmlns:xsi</span>=<span style="color: #ff0000;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000066;">xsi:schemaLocation</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000000; font-weight: bold;">&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;bean</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">&quot;propertyConfigurer&quot;</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span> </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;locations&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;#{systemProperties['aplicacion.config'] != null ? 'file:' + systemProperties['aplicacion.config'] :'classpath:'}application.properties&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> ...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/beans<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 01</strong>. Configuración xml de &#8216;propertyConfigurer&#8217;</p>
<p>La clave está en la línea 8. Si está definida la propiedad del sistema &#8216;<strong><em>aplicacion.config</em></strong>&#8216; buscará en el sistema de ficheros, el archivo de configuración &#8216;<em>aplicacion.properties</em>&#8216; en la dirección que indica su valor. Si no, busca el &#8216;<em>aplication.properties</em>&#8216; en el <em>classpath</em> (es decir dentro del war), por lo que este sería el archivo de configuración de la aplicación por defecto.</p>
<p>Un ejemplo del contenido de &#8216;<em>aplicacion.properties</em>&#8216; podría ser</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #006633;">aplicacion</span>.<span style="color: #006633;">config</span>.<span style="color: #006633;">pathfiles</span><span style="color: #339933;">=/</span>home<span style="color: #339933;">/</span>miguel<span style="color: #339933;">/</span>aplicacion<span style="color: #339933;">/</span>tmp</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 02</strong>. Ejemplo de contenido de aplicacion.properties</p>
<p>Y la manera de usarlo dentro de la configuración xml de Spring sería:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="XML"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.0&quot;</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">&quot;UTF-8&quot;</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;beans</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans&quot;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000066;">xmlns:xsi</span>=<span style="color: #ff0000;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000066;">xsi:schemaLocation</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000000; font-weight: bold;">&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;bean</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">&quot;utilFichero&quot;</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">&quot;com.logicaalternativa.ejemplo.UtilFicheroImp&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span> </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;directorio&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;${aplicacion.config.pathfiles}&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> ...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/beans<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 03.</strong> Ejemplo de como se utilizan los valores definidos en el archivo de configuración</p>
<p>Ya sólo me queda indicar como se define esa propiedad. En el <strong>Tomcat </strong>un buen sitio es el &#8216;<em><strong>catalina.properties</strong>&#8216;</em> de su directorio &#8216;<em>config</em>&#8216;. Se definiría así:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #006633;">aplicacion</span>.<span style="color: #006633;">config</span><span style="color: #339933;">=/</span>home<span style="color: #339933;">/</span>miguel<span style="color: #339933;">/</span>config<span style="color: #339933;">-</span>aplicacion<span style="color: #339933;">-</span>tomcat<span style="color: #339933;">/</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 04.</strong> Configurando el Tomcat</p>
<p>O directamente definiendo la propiedad al arrancar la máquina virtual. Por ejemplo si tu proyecto tiene configurado el plugin,&nbsp; arrancando el jetty embebido de mvn de la siguiente manera:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">mvn -Daplicacion.config=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>miguel<span style="color: #000000; font-weight: bold;">/</span>config-aplicacion-jetty<span style="color: #000000; font-weight: bold;">/</span> jetty:run</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 05</strong>. Ejemplo al arrancar el jetty de mvn</p>
<p style="text-align: left;">En los ejemplos en los dos directorios &#8216;<em>/home/miguel/config&minus;aplicacion&minus;jetty/</em>&#8216; y &#8216;<em>/home/miguel/config&minus;aplicacion&minus;tomcat/</em>&#8216; se encontrarían sendos archivos &#8216;<em>aplicacion.properties</em>&#8216; cada uno configurados con los valores para cada entorno.</p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/general/" rel="category tag">General</a>, <a href="/category/programacion/java/" rel="category tag">Java</a> y está etiquetada con <a href="/tag/configuracion/" rel="tag">Configuración</a>, <a href="/tag/externalizar/" rel="tag">Externalizar</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/jetty/" rel="tag">Jetty</a>, <a href="/tag/spring/" rel="tag">Spring</a>, <a href="/tag/tomcat/" rel="tag">Tomcat</a> en <a href="/configuracion-de-entornos-flexible-en-spring-utilizando-spel/" title="23:53" rel="bookmark"><time class="entry-date" datetime="2013-12-16T23:53:59+00:00">16 diciembre, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-489" class="post-489 post type-post status-publish format-standard hentry category-java tag-despliegue-continuo tag-java tag-jenkins tag-junit tag-maven">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/de-despliegue-continuo-y-de-responsabilidad-personal/" rel="bookmark">De despliegue continuo y de responsabilidad personal</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h1>Despliegue continuo con Jenkins, Maven, Selenium y Junit</h1>
<p>Están surgiendo nuevos conceptos como el <strong>despliegue continuo</strong> y la <strong>responsabilidad personal</strong> que están cambiando la forma de desplegar en un entorno de producción.</p>
<p>Digamos que la “manera tradicional” es decidir que funcionalidades van a ir en cada versión codificarlas, probar esa versión y por fin el despliegue en producción. Quién se haya enfrentado a esto sabe el estrés que produce el despliegue de una nueva versión sobre todo si conlleva bastantes cambios, &#8230;si ya sabemos que todo está probado, que no va a pasar nada, pero el mal trago del despliegue no te lo quita nadie … <em>“¿irá todo bien? ¿no irá?</em>”</p>
<h2>Despliegue continuo</h2>
<p>¿Cómo están haciendo las cosas empresas como Facebook? … pues simplemente <strong>no hay versiones</strong>. <a href="/de-despliegue-continuo-y-de-responsabilidad-personal/#more-489" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a> y está etiquetada con <a href="/tag/despliegue-continuo/" rel="tag">despliegue continuo</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/jenkins/" rel="tag">jenkins</a>, <a href="/tag/junit/" rel="tag">junit</a>, <a href="/tag/maven/" rel="tag">maven</a> en <a href="/de-despliegue-continuo-y-de-responsabilidad-personal/" title="20:38" rel="bookmark"><time class="entry-date" datetime="2013-11-17T20:38:51+00:00">17 noviembre, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-214" class="post-214 post type-post status-publish format-standard hentry category-java tag-hibernate tag-java">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/hibernate-4-obtener-el-objeto-connection-relacionado-con-la-sesion/" rel="bookmark">Hibernate 4: obtener el objeto Connection relacionado con la sesión</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>U</strong>na nota rápida de un problema con el que me he pegado hace poco.</p>
<p>Necesitaba lanzar una función de BBDD (<strong>Oracle</strong>) desde <strong>Hibernate</strong> manteniendo la transacción.&nbsp; Para lanzar la función desde jdbc, en las versiones anteriores de Hibernate era muy intuitivo obtener el objeto <strong>Connection</strong> relacionado con la sesión pero en <strong>Hibernate 4</strong> ha cambiado el interface <strong>Session. <a href="/hibernate-4-obtener-el-objeto-connection-relacionado-con-la-sesion/#more-214" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></strong></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a> y está etiquetada con <a href="/tag/hibernate/" rel="tag">Hibernate</a>, <a href="/tag/java/" rel="tag">Java</a> en <a href="/hibernate-4-obtener-el-objeto-connection-relacionado-con-la-sesion/" title="13:47" rel="bookmark"><time class="entry-date" datetime="2013-05-28T13:47:38+00:00">28 mayo, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-163" class="post-163 post type-post status-publish format-standard hentry category-android category-java">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/cambio-de-color-a-barra-de-progreso-en-android/" rel="bookmark">Cambio de color a barra de progreso en Android</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><b><img class="alignleft size-full wp-image-185" alt="Android" src="/wp-content/uploads/2013/05/Android.png" width="150" height="150" />L</b>a duración de manga de motocross se mide en minutos + 2 vueltas. A nivel regional son 20 minutos + 2 vueltas, a nivel nacional 30 minutos + 2 vueltas, etc&#8230; Entrenando lo normal es hacer mangas de la misma duración, o de menos tiempo (mejorando la rapidez) o de más (mejorando el fondo). Las motos de cross no tienen instrumentación y obliga a que una persona desde fuera indique al piloto cuanto le queda de manga.</p>
<p>¿Qué por qué cuento esto? Desde hace bastante tiempo mi hermano y yo corremos motocross a nivel regional. Bueno en realidad mi hermano es el “quemao” y siempre andaba quejándose de que sus entrenos no podían ser de calidad porque no sabía el tiempo que llevaba, no sabía cuando apretar, cuando regular, bla, bla, bla&#8230;</p>
<p>Ahí salió el “<i>hermano informático</i>”, surgió el problema de cambiar el color a una barra de progreso y echarme a la cara el peor &#8216;<i>stakeholder</i>&#8216; que he tenido en mi vida …  <a href="/cambio-de-color-a-barra-de-progreso-en-android/#more-163" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada fue publicada en <a href="/category/programacion/android/" rel="category tag">Android</a>, <a href="/category/programacion/java/" rel="category tag">Java</a> el <a href="/cambio-de-color-a-barra-de-progreso-en-android/" title="18:34" rel="bookmark"><time class="entry-date" datetime="2013-05-09T18:34:51+00:00">9 mayo, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-133" class="post-133 post type-post status-publish format-standard hentry category-java category-javascript tag-acceso tag-java tag-javascript tag-login tag-securizar tag-sha-1">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/java-securizacion-de-formulario-de-acceso-con-sha-1/" rel="bookmark">(Java) Securización de formulario de acceso con SHA-1</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><img class="alignright size-full wp-image-150" alt="Anonymous_JAVA_p" src="/wp-content/uploads/2013/04/Anonymous_JAVA_p.png" width="138" height="150" /><strong>C</strong>ompletando la <a title="Securización de formulario de acceso con SHA-1" href="/securizacion-de-formulario-de-acceso-con-sha-1/">entrada anterior</a>, he realizado la implementación en <strong>Java</strong>. Básicamente &#8216;<em>todo es lo mismo&#8230; pero no es igual</em>&#8216;&nbsp; :-). Cambia la manera de obtener el <strong>número aleatorio</strong> y la forma de obtener el <strong>sha-1</strong>.</p>
<p>La estructura es la de un proyecto <strong>Maven</strong> web con su <a href="https://github.com/logicaalternativa/ejemplosJava/blob/master/loginsha1/pom.xml" target="_blank">pom.xml</a> para que sea sencillo compilarlo y generar el war. Paso a explicarlo.&nbsp; <a href="/java-securizacion-de-formulario-de-acceso-con-sha-1/#more-133" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/acceso/" rel="tag">acceso</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/login/" rel="tag">login</a>, <a href="/tag/securizar/" rel="tag">securizar</a>, <a href="/tag/sha-1/" rel="tag">SHA-1</a> en <a href="/java-securizacion-de-formulario-de-acceso-con-sha-1/" title="21:29" rel="bookmark"><time class="entry-date" datetime="2013-04-28T21:29:17+00:00">28 abril, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

		
		</div><!-- #content -->
	</section><!-- #primary -->


			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-3" class="widget widget_text">			<div class="textwidget"><a href="/feed/" title="Suscribirse a este sitio usando RSS 2.0"><img class="alignnone" alt="[RSS]" src="/wp-content/uploads/2013/04/rss_copy.png" width="20" height="20" /></a>&nbsp;&nbsp;<a href="/feed/" title="Suscribirse a este sitio usando RSS 2.0"><abbr title="Really Simple Syndication">RSS</abbr> de las entradas</a></div>
		</aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widget-title">Entradas recientes</h3>		<ul>
					<li>
				<a href="/speaker-en-la-commit-conf-2024/">Speaker en la Commit Conf 2024</a>
						</li>
					<li>
				<a href="/charla-en-madridjugmadrid-gug-sobre-tipos-algebraicos-en-java-21/">Charla en MadridJUG/Madrid GUG sobre tipos algebraicos en Java 21</a>
						</li>
					<li>
				<a href="/charla-commit-conf-2023-sobre-programacion-funcional-y-patrones-funcionales/">Charla Commit Conf 2023 sobre programación funcional y patrones funcionales</a>
						</li>
					<li>
				<a href="/notas-sobre-aprendizaje-por-refuerzo/">Notas sobre aprendizaje por refuerzo</a>
						</li>
					<li>
				<a href="/diapositivas-de-la-charla-de-commit-conf/">Vídeo y diapositivas de la charla de Commit Conf</a>
						</li>
				</ul>
		</aside>		<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Sobre el autor</h3>			<div class="textwidget"><a href="/mi-cv"><a href="/mi-cv/#imagenMiCV"><img class="alignright" alt="[Sobre el autor]" src="/wp-content/uploads/2013/04/miguel_p_90x82_claro.jpg" /></a>
<small>Mi nombre es Miguel Rafael Esteban Martín. Llevo más de 20 años trabajando como&nbsp;desarrollador&nbsp; y &nbsp;arquitecto&nbsp; de software en diferentes empresas, lenguajes de programación y plataformas.<br/>
En este blog hablaré sobre programación y tecnología e intentaré hacerlo de manera clara y amena.<br/>
Actualmente trabajando como Principal Software Developer en Oracle.<br/>
Más sobre mi en el enlace <strong><a href="/mi-cv/#imagenMiCV">Mi CV</a></strong></small>

<p style="text-align: center;"><small><strong>Contacto</strong><br/>
<a href="/mi-cv/#email"><img class="alignnone" alt="[correo electrónico]" src="/wp-content/uploads/2013/04/e_mail_p.png" width="32" height="32" /></a><a href="http://es.linkedin.com/in/miguelresteban"><img class="size-full wp-image-25 alignnone" alt="[Perfil en LinkedIn]" src="/wp-content/uploads/2013/04/linkedin.png" width="32" height="32" /></a><a href="https://twitter.com/MiguelREsteban"><img class="size-full wp-image-25 alignnone" alt="[Perfil en Twitter]" src="/wp-content/uploads/2013/04/twitter.png" width="32" height="32" /></a><a href="https://github.com/logicaalternativa"><img class="size-full wp-image-25 alignnone" alt="[Perfil en GitHub]" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" width="32" height="32" /></a>
</small></p></div>
		</aside><aside id="text-8" class="widget widget_text">			<div class="textwidget"> <!-- De aquí -->
    <div id="twitter"></div>    
    <script type="text/javascript" src="/etc/ejemplos/php/twiter-api/js/carga-widget.js.php"></script>
    <!-- hasta aquí --></div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categorías</h3>		<ul>
	<li class="cat-item cat-item-15"><a href="/category/programacion/android/" >Android</a>
</li>
	<li class="cat-item cat-item-36"><a href="/category/apis/" >APIs</a>
</li>
	<li class="cat-item cat-item-64"><a href="/category/control-de-la-configuracion/" >Control de la configuración</a>
</li>
	<li class="cat-item cat-item-57"><a href="/category/criptografia-y-certificados/" >Criptografía y certificados</a>
</li>
	<li class="cat-item cat-item-98"><a href="/category/programacion/funcional/" title="Programación funcional">Funcional</a>
</li>
	<li class="cat-item cat-item-10"><a href="/category/general/" >General</a>
</li>
	<li class="cat-item cat-item-90"><a href="/category/inteligencia-artificial/" >Inteligencia artificial</a>
</li>
	<li class="cat-item cat-item-14 current-cat"><a href="/category/programacion/java/" >Java</a>
</li>
	<li class="cat-item cat-item-8"><a href="/category/programacion/javascript/" >JavaScript</a>
</li>
	<li class="cat-item cat-item-21"><a href="/category/la-nube/" >La Nube</a>
</li>
	<li class="cat-item cat-item-87"><a href="/category/programacion/patrones/" >Patrones</a>
</li>
	<li class="cat-item cat-item-3"><a href="/category/programacion/php/" >PHP</a>
</li>
	<li class="cat-item cat-item-100"><a href="/category/presentaciones/" title="Presentaciones en eventos y conferencias">Presentaciones</a>
</li>
	<li class="cat-item cat-item-20 current-cat-parent current-cat-ancestor"><a href="/category/programacion/" >Programación</a>
</li>
	<li class="cat-item cat-item-105"><a href="/category/programacion/reactiva/" >Reactiva</a>
</li>
	<li class="cat-item cat-item-99"><a href="/category/programacion/scala/" >Scala</a>
</li>
	<li class="cat-item cat-item-16"><a href="/category/sistemas-operativos/" >Sistemas operativos</a>
</li>
		</ul>
</aside>		</div><!-- #secondary -->
		</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
			<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.es_ES"><img alt="Licencia de Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Lógica Alternativa</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.logicaalternativa.com/mi-cv/" property="cc:attributionName" rel="cc:attributionURL">Miguel Rafael Esteban Martín</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.es_ES">Creative Commons Reconocimiento-NoComercial 3.0 Unported License</a>.		
			<!--
						<a href="https://wordpress.org/" title="Plataforma semántica de publicación personal">Creado con WordPress</a>
			-->
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript' src='/wp-content/themes/twentytwelve/js/navigation.js?ver=20140711'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.7.29'></script>
</body>
</html>
