<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="es-ES">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="es-ES">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="es-ES">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Miguel R. Esteban Martín | Lógica Alternativa</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://localhost/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link href='https://fonts.gstatic.com/' crossorigin rel='preconnect' />
<link rel="alternate" type="application/rss+xml" title="Lógica Alternativa &raquo; Feed" href="/feed/" />
<link rel="alternate" type="application/rss+xml" title="Lógica Alternativa &raquo; RSS de los comentarios" href="/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Lógica Alternativa &raquo; RSS de las entradas de Miguel R. Esteban Martín" href="/author/miguel/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.2.1\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/localhost\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.7.26"}};
			!function(t,a,e){var r,n,i,o=a.createElement("canvas"),l=o.getContext&&o.getContext("2d");function c(t){var e=a.createElement("script");e.src=t,e.defer=e.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(e)}for(i=Array("flag","emoji4"),e.supports={everything:!0,everythingExceptFlag:!0},n=0;n<i.length;n++)e.supports[i[n]]=function(t){var e,a=String.fromCharCode;if(!l||!l.fillText)return!1;switch(l.clearRect(0,0,o.width,o.height),l.textBaseline="top",l.font="600 32px Arial",t){case"flag":return(l.fillText(a(55356,56826,55356,56819),0,0),o.toDataURL().length<3e3)?!1:(l.clearRect(0,0,o.width,o.height),l.fillText(a(55356,57331,65039,8205,55356,57096),0,0),e=o.toDataURL(),l.clearRect(0,0,o.width,o.height),l.fillText(a(55356,57331,55356,57096),0,0),e!==o.toDataURL());case"emoji4":return l.fillText(a(55357,56425,55356,57341,8205,55357,56507),0,0),e=o.toDataURL(),l.clearRect(0,0,o.width,o.height),l.fillText(a(55357,56425,55356,57341,55357,56507),0,0),e!==o.toDataURL()}return!1}(i[n]),e.supports.everything=e.supports.everything&&e.supports[i[n]],"flag"!==i[n]&&(e.supports.everythingExceptFlag=e.supports.everythingExceptFlag&&e.supports[i[n]]);e.supports.everythingExceptFlag=e.supports.everythingExceptFlag&&!e.supports.flag,e.DOMReady=!1,e.readyCallback=function(){e.DOMReady=!0},e.supports.everything||(r=function(){e.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",r,!1),t.addEventListener("load",r,!1)):(t.attachEvent("onload",r),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&e.readyCallback()})),(r=e.source||{}).concatemoji?c(r.concatemoji):r.wpemoji&&r.twemoji&&(c(r.twemoji),c(r.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='cptch_stylesheet-css'  href='/wp-content/plugins/captcha/css/front_end_style.css?ver=4.3.6' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='/wp-includes/css/dashicons.min.css?ver=4.7.26' type='text/css' media='all' />
<link rel='stylesheet' id='cptch_desktop_style-css'  href='/wp-content/plugins/captcha/css/desktop_style.css?ver=4.3.6' type='text/css' media='all' />
<link rel='stylesheet' id='st-widget-css'  href='/wp-content/plugins/share-this/css/style.css?ver=4.7.26' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='/wp-content/themes/twentytwelve/style.css?ver=4.7.26' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://localhost/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<link rel='https://api.w.org/' href='/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.7.26" />

<!-- Bad Behavior 2.2.20 run time: 1.453 ms -->
<script type="text/javascript">
<!--
function bb2_addLoadEvent(func) {
	var oldonload = window.onload;
	if (typeof window.onload != 'function') {
		window.onload = func;
	} else {
		window.onload = function() {
			oldonload();
			func();
		}
	}
}

bb2_addLoadEvent(function() {
	for ( i=0; i < document.forms.length; i++ ) {
		if (document.forms[i].method == 'post') {
			var myElement = document.createElement('input');
			myElement.setAttribute('type', 'hidden');
			myElement.name = 'bb2_screener_';
			myElement.value = '1685264484 127.0.0.1';
			document.forms[i].appendChild(myElement);
		}
	}
});
// --></script>
		<script type='text/javascript' src='/wp-includes/js/jquery/jquery.js?ver=1.2.6'></script>
<script language="JavaScript"><!--
 var DevFmtUrl='http://localhost/wp-content/plugins/devformatter/'; var DevFmtAjaxUrl = 'http://localhost/wp-admin/admin-ajax.php'; //-->
</script>
<script type='text/javascript' src='/wp-content/plugins/devformatter/devfmt_common.js?ver=2015.0.2.1'></script>
<script type='text/javascript' src='/wp-content/plugins/devformatter/devfmt_public.js?ver=2015.0.2.1'></script>
<style type="text/css" media="screen"> @import url( '/wp-content/plugins/devformatter/devfmt_reset.css?ver=2015.0.2.1' ); </style>
<style type="text/css" media="screen"> @import url( '/wp-content/plugins/devformatter/devfmt_css.php?ver=2015.0.2.1' ); </style><script charset="utf-8" type="text/javascript">var switchTo5x=true;</script><script charset="utf-8" type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script><script type="text/javascript">stLight.options({publisher:'wp.08e04e90-ba64-4016-a864-853c9c560eca'});var st_type='wordpress3.5.1';</script></head>

<body class="archive author author-miguel author-1 custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="/" title="Lógica Alternativa" rel="home">Lógica Alternativa</a></h1>
			<h2 class="site-description">&#039;¿Otro blog de informática? &#8230; Todavía no&#039; .- Cuaderno de bitácora de Miguel R. Esteban</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menú</button>
			<a class="assistive-text" href="#content" title="Ir al contenido">Ir al contenido</a>
			<div class="nav-menu"><ul>
<li ><a href="/">Inicio</a></li><li class="page_item page-item-30"><a href="/mi-cv/">Mi CV</a></li>
<li class="page_item page-item-122"><a href="/mapa-del-sitio/">Mapa del sitio</a></li>
</ul></div>
		</nav><!-- #site-navigation -->

				<a href="/"><img src="/wp-content/uploads/2013/04/cabecera3.jpg" class="header-image" width="960" height="250" alt="Lógica Alternativa" /></a>
			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<section id="primary" class="site-content">
		<div id="content" role="main">

		
			
			<header class="archive-header">
				<h1 class="archive-title">Archivo del Autor: <span class="vcard"><a class="url fn n" href="/author/miguel/" title="Miguel R. Esteban Martín" rel="me">Miguel R. Esteban Martín</a></span></h1>
			</header><!-- .archive-header -->

			
					<nav id="nav-above" class="navigation" role="navigation">
			<h3 class="assistive-text">Navegación de entradas</h3>
			<div class="nav-previous"><a href="/author/miguel/page/2/" ><span class="meta-nav">&larr;</span> Entradas más antiguas</a></div>
			<div class="nav-next"></div>
		</nav><!-- .navigation -->
	
			
										
	<article id="post-1182" class="post-1182 post type-post status-publish format-standard hentry category-funcional category-general category-java category-patrones category-presentaciones category-programacion category-reactiva tag-charla tag-commitconf tag-dsl tag-java tag-programacion-functional tag-programacion-reactiva">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/charla-commit-conf-2023-sobre-programacion-funcional-y-patrones-funcionales/" rel="bookmark">Charla Commit Conf 2023 sobre programación funcional y patrones funcionales</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>E</strong>l pasado <strong>21 de abril</strong> di una charla sobre <strong>programación reactiva</strong> y como tener conocimiento de los<strong> patrones funcionales</strong> pueden ayudar a entender mejor este tipo de programación.</p>
<p>En la charla también introduzco el concepto de <strong>DSL</strong> (<em>Domain Specific Language</em>) que permiten de una manera real abstraer nuestro código de la tecnología escogida.</p>
<p>En otro orden de cosas, para mí fue un honor que la organización del <strong>Commit Conf</strong> confiara en mí para ser ponente.</p>
<p>Aquí están las diapositivas de la presentación</p>
<p style="text-align: center;"><a href="http://www.logicaalternativa.com/slides/programacion-reactiva-patrones-funcionales"><img class="aligncenter wp-image-1190 size-full" src="/wp-content/uploads/2023/05/presentacionCommitConf2023.png" alt="Presentación Commit Conf 2023" width="300" height="171" /></a><strong>Diapositivas presentación: <a href="http://www.logicaalternativa.com/slides/programacion-reactiva-patrones-funcionales">Programación reactiva y patrones funcionales</a></strong></p>
<p>y el vídeo de la charla</p>
<p style="text-align: center;"><iframe title="YouTube video player" src="https://www.youtube-nocookie.com/embed/3FD00P0lEpY" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/funcional/" rel="category tag">Funcional</a>, <a href="/category/general/" rel="category tag">General</a>, <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/patrones/" rel="category tag">Patrones</a>, <a href="/category/presentaciones/" rel="category tag">Presentaciones</a>, <a href="/category/programacion/" rel="category tag">Programación</a>, <a href="/category/programacion/reactiva/" rel="category tag">Reactiva</a> y está etiquetada con <a href="/tag/charla/" rel="tag">Charla</a>, <a href="/tag/commitconf/" rel="tag">CommitConf</a>, <a href="/tag/dsl/" rel="tag">DSL</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/programacion-functional/" rel="tag">Programación Functional</a>, <a href="/tag/programacion-reactiva/" rel="tag">programación reactiva</a> en <a href="/charla-commit-conf-2023-sobre-programacion-funcional-y-patrones-funcionales/" title="22:37" rel="bookmark"><time class="entry-date" datetime="2023-05-27T22:37:31+00:00">27 mayo, 2023</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-1138" class="post-1138 post type-post status-publish format-standard has-post-thumbnail hentry category-general category-inteligencia-artificial tag-agente tag-aprendizaje-computacional tag-aprendizaje-por-refuerzo tag-inteligencia-artificial tag-machine-learning tag-sistemas-no-supervisados tag-sistemas-supervisados">
				<header class="entry-header">
			<img width="624" height="176" src="/wp-content/uploads/2022/09/ia-hands-624x176.png" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="" srcset="/wp-content/uploads/2022/09/ia-hands-624x176.png 624w, /wp-content/uploads/2022/09/ia-hands-300x84.png 300w, /wp-content/uploads/2022/09/ia-hands-768x216.png 768w, /wp-content/uploads/2022/09/ia-hands.png 792w" sizes="(max-width: 624px) 100vw, 624px" />
						<h1 class="entry-title">
				<a href="/notas-sobre-aprendizaje-por-refuerzo/" rel="bookmark">Notas sobre aprendizaje por refuerzo</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>E</strong>l objetivo de este post es servir de introducción a una de las ramas del machine learning o, en español,  aprendizaje computacional como son los modelos de aprendizaje por refuerzo. Los sistemas de aprendizaje computacional se pueden modelar como una función que dependiendo del valor de unas entradas se obtiene una salida que permite predecir o clasificar.<br />
<pre># <strong><em>Modelización de un sistema de aprendizaje computacional como una función</em></strong> 

Entrada_1  --&gt;  <strong>,-------.</strong>
Entrada_2  --&gt;  <strong>| Modelo|</strong> --&gt; Predicción o clasificación (Salida)
 ...       --&gt;  <strong>`-------'</strong>  
Entrada_n  

----
<em>predicción</em> = <strong>modelo</strong>( entrada_1, entrada_2, ..., entrada_n )</pre><br />
<img class="size-full wp-image-1141 alignleft" src="/wp-content/uploads/2022/07/dog-reward.png" alt="Aprendizaje por Refuerzo" width="350" height="418" srcset="/wp-content/uploads/2022/07/dog-reward.png 350w, /wp-content/uploads/2022/07/dog-reward-251x300.png 251w" sizes="(max-width: 350px) 100vw, 350px" />Si nos atenemos al conocimiento a priori de cuan buena puede ser la predicción, podemos clasificar los sistemas en tres grupos:</p>
<p>En los <strong>sistemas supervisados</strong> se tiene un conocimiento completo. Un ejemplo puede ser un clasificador que es capaz de distinguir entre <a href="https://www.google.es/search?q=muffin+or+chihuahua&amp;hl=es&amp;tbm=isch&amp;source=hp&amp;biw=1375&amp;bih=740&amp;ei=BoT6Yu_yMaeD8gLpl4WgBQ&amp;iflsig=AJiK0e8AAAAAYvqSFp13R2oYV508pi32D1xoKvy7KS3B&amp;oq=muffin+or+c&amp;gs_lcp=CgNpbWcQARgAMgUIABCABDIECAAQHjIECAAQHjIGCAAQHhAFMgYIABAeEAUyBggAEB4QBToLCAAQgAQQsQMQgwE6CAgAELEDEIMBOggIABCABBCxAzoECAAQAzoGCAAQHhAIUOsLWOs6YL5MaAVwAHgAgAGdAYgBlg-SAQQxLjE1mAEAoAEBqgELZ3dzLXdpei1pbWewAQA&amp;sclient=img" target="_blank" rel="noopener">un muffin o un chiguagua</a>, ya que se puede saber (o puede que no sea tan sencillo 😀 ) si el clasificador lo ha hecho bien o se ha equivocado. Por el contrario, los <strong>sistemas no supervisados</strong>, no existe ese conocimiento previo y sirven para descubrir patrones y agrupaciones desconocidos dentro de un conjunto de datos.</p>
<p>El el punto medio están los sistemas de <strong>aprendizaje por refuerzo</strong>, donde sólo podemos saber si el sistema esta respondiendo mejor o peor con respecto a una entrada. Esto se materializa obteniendo una recompensa o una penalización del resultado de la salida, y así,  «<em>saber</em>» si la solución  plateada actual, va por el buen camino.</p>
<p>Un ejemplo en la vida real es un cachorro al que le estamos enseñando a sentarse, si lo hace bien, recibe su recompensa y si no, no recibe nada. Sin entender al principio lo que pasa, al cabo de unas cuantas veces pensará<em> «Si en esta situación, me comporto de esta manera, recibiré una recompensa porque en el pasado ya me ha ocurrido»</em>.</p>
<p>Dentro sistemas de aprendizaje por refuerzo están los algoritmos genéticos utilizados en <strong>sistemas difusos</strong>. Cuando se habla de un sistema difuso se está hablando de un sistema del que no se tiene «<em>incertidumbre</em>» en la percepción del entorno. Hay que tener en cuenta que este tipo de conocimiento incompleto es muy común en el mundo real (<em>«velocidad en torno los 100 km/h»</em>, <em>«temperatura mayor de 25ª»</em>)  y nosotros los humanos somos muy capaces de tomar decisiones a partir de esta información imprecisa.</p>
<p>Con respecto a los algoritmos genéticos son aquellos que se van variando sus parámetros de modelo de una manera parecida a como funciona en la naturaleza. En esta,  aquellas familias de genes que mejor se adaptan al entorno son las que prevalecen y siguen evolucionado y en los algoritmos genéticos son las familias de parámetros que más se acercan a la solución óptima son los que prevalecen y a partir de los más exitosos  se sigue evolucionando.</p>
<p>Los <strong>agentes reactivos</strong> también pueden encajar dentro de los sistemas basados en aprendizaje por refuerzo. Un agente tiene un sistema autónomo que está puede obtener información y comunicarse con el mundo real<img class="size-full wp-image-1163 alignright" src="/wp-content/uploads/2022/09/ant.png" alt="" width="350" height="287" srcset="/wp-content/uploads/2022/09/ant.png 350w, /wp-content/uploads/2022/09/ant-300x246.png 300w" sizes="(max-width: 350px) 100vw, 350px" /></p>
<p><em>Reactivo</em> significa que el agente no tiene una idea clara, ni una representación simbólica de entorno con el que se comunica. Es un  sistema sencillo que simplemente se relaciona y reacciona con su entorno. La inteligencia emerge de las iteraciones de varios de estos agentes.</p>
<p>Una hormiga se limita a reaccionar a su entorno comunicándose con otras a través del olor( feromonas),  físicamente o mediante sonido o vibraciones. La suma de estas interacciones hacen que el hormiguero sea un sistema altamente adaptativo e inteligente sin un sistema de control centralizado, con organizaciones complejas como la separación de tareas dentro de los individuos.</p>
<p>En próximas entradas quiero centrarme en este tipo de sistemas multiagente, que es un agente y su relación con los modelos de aprendizaje por refuerzo.</p>
<p>M.E.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/general/" rel="category tag">General</a>, <a href="/category/inteligencia-artificial/" rel="category tag">Inteligencia artificial</a> y está etiquetada con <a href="/tag/agente/" rel="tag">Agente</a>, <a href="/tag/aprendizaje-computacional/" rel="tag">Aprendizaje computacional</a>, <a href="/tag/aprendizaje-por-refuerzo/" rel="tag">Aprendizaje por refuerzo</a>, <a href="/tag/inteligencia-artificial/" rel="tag">Inteligencia artificial</a>, <a href="/tag/machine-learning/" rel="tag">Machine learning</a>, <a href="/tag/sistemas-no-supervisados/" rel="tag">Sistemas no supervisados</a>, <a href="/tag/sistemas-supervisados/" rel="tag">Sistemas supervisados</a> en <a href="/notas-sobre-aprendizaje-por-refuerzo/" title="19:38" rel="bookmark"><time class="entry-date" datetime="2022-09-05T19:38:35+00:00">5 septiembre, 2022</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-1127" class="post-1127 post type-post status-publish format-standard hentry category-general category-presentaciones category-programacion category-reactiva category-scala tag-actores tag-charla tag-programacion-reactiva tag-video">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/diapositivas-de-la-charla-de-commit-conf/" rel="bookmark">Vídeo y diapositivas de la charla de Commit Conf</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>Los días 23 y 24 de noviembre ha tenido lugar en Madrid la primera edición del <strong>Commit Conf</strong>, uno de los eventos más importantes que se tiene en lengua castellana.</p>
<p>En su momento presente mi charla sobre <strong>Akka Sharding y su relación con DDD</strong> al “<em>call for papers</em>” con ilusión pero sin grandes esperanzas de que fuera aceptada. Hay que tener en cuenta que hasta ese momento no tenía experiencia presentando charlas en eventos públicos aunque afortunadamente si que tengo cierto callo en exponer ideas en público ya que mi trabajo me lo exige.</p>
<p><img class="size-full wp-image-1130 alignleft" src="/wp-content/uploads/2018/12/android-chrome-300x300.png" alt="" width="300" height="300" srcset="/wp-content/uploads/2018/12/android-chrome-300x300.png 300w, /wp-content/uploads/2018/12/android-chrome-300x300-150x150.png 150w" sizes="(max-width: 300px) 100vw, 300px" /></p>
<p>Así que cuando me aceptaron la presentación me lleve una enorme alegría porque consideraron el tema de mi charla interesante. Alegría, pero también responsabilidad por toda la confianza depositada.</p>
<p>Recuerdo con una sonrisa la primera presentación que hice a  a tres compañeros de trabajo que me hicieron de beta testers. Para mi alivio les resultó interesante y fue curioso, porque cada uno tenía una visión diferente de lo que le había gustado de la presentación. Uno se decantó más por las posibilidades que ofrecía este paradigma, otro puso más interés como se implementaba y el otro las implicaciones operacionales que tenía el despliegue de un sistema distribuido. El problema fue el tiempo: se fue más de hora y media.</p>
<p>Luego he tenido la increíble oportunidad de presentar la charla en otros foros como puede ser en el <strong>ScalaMAD</strong> (<a href="https://www.meetup.com/es-ES/Scala-Programming-Madrid/events/254582507/" target="_blank" rel="noopener noreferrer">el 31 de octubre</a>) a los que estoy agradecido y que me permitió pulir la charla.</p>
<p>Al final creo que la presentación en el Commit fue bastante bien, aunque recortada estuvo un poco justa de tiempo, … me faltaron unos minutos, un problema endémico por intentar tener en cuenta todos los conceptos, pero si que la gente se mostró participativa en la tanda de preguntas lo cual es muy bueno.</p>
<p>En resumen la sensación fue muy positiva, una experiencia intensa pero muy bonita de la que guardaré un buen recuerdo. Para terminar, lo prometido, estos son el vídeo y los enlaces de la charla y el repositorio del github de los notebook de Jupiter con la demo.</p>
<p style="text-align: center;"><iframe title="YouTube video player" src="https://www.youtube-nocookie.com/embed/MH3NMaNmClA" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<p style="text-align: center;"><a href="https://logicaalternativa.github.io/slides/akka-sharding/" target="_blank" rel="noopener noreferrer"><img class="size-full wp-image-1131 aligncenter" src="/wp-content/uploads/2018/12/0f49ca99-1c00-48f1-a10c-4eef77108691.png" alt="" width="300" height="169" /></a>Presentación: <em><a href="http://www.logicaalternativa.com/slides/akka-sharding" target="_blank" rel="noopener noreferrer">Akka Sharind y su relación con DDD</a></em></p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/notebook-scala-docker-demo-akka-sharding"><img class="size-full wp-image-1134 aligncenter" src="/wp-content/uploads/2018/12/GitHub-Mark-32px.png" alt="" width="32" height="32" /></a>Código: <a href="https://github.com/logicaalternativa/notebook-scala-docker-demo-akka-sharding" target="_blank" rel="noopener noreferrer"><em>Repo GitHub</em></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/general/" rel="category tag">General</a>, <a href="/category/presentaciones/" rel="category tag">Presentaciones</a>, <a href="/category/programacion/" rel="category tag">Programación</a>, <a href="/category/programacion/reactiva/" rel="category tag">Reactiva</a>, <a href="/category/programacion/scala/" rel="category tag">Scala</a> y está etiquetada con <a href="/tag/actores/" rel="tag">actores</a>, <a href="/tag/charla/" rel="tag">Charla</a>, <a href="/tag/programacion-reactiva/" rel="tag">programación reactiva</a>, <a href="/tag/video/" rel="tag">Video</a> en <a href="/diapositivas-de-la-charla-de-commit-conf/" title="20:00" rel="bookmark"><time class="entry-date" datetime="2018-12-01T20:00:52+00:00">1 diciembre, 2018</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-1035" class="post-1035 post type-post status-publish format-standard hentry category-java category-patrones tag-futuros tag-java tag-patrones">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/" rel="bookmark">Futuros y promesas,&#8230; y también monadas. Implementando el patrón</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<blockquote><p><strong>«Los modelos NIO no bloqueantes y la programación asíncrona y reactiva son paradigmas que poco a poco van adoptándose y utilizando más</strong>.»</p></blockquote>
<p>Los modelos <em><strong>NIO</strong></em> no bloqueantes y la programación <strong>asíncrona</strong> y <strong>reactiva</strong> son paradigmas que poco a poco van adoptándose y utilizando más. No creo que diga una tontería al afirmar que muy probablemente serán la norma en un futuro cercano. La razón es clara: aunque no se obtiene un rendimiento mejor que los modelos tradicionales sincrónicos, si son modelos mucho <strong>más eficientes</strong>. Obtienen el mismo rendimiento con menos recursos al tener un mejor control de los hilos, uno de los recursos más preciados en un sistema operativo.</p>
<div style="width: 310px" class="wp-caption alignright"><img src="/wp-content/uploads/2017/08/future.png" alt="Futuros y promesas" width="300" height="252" /><p class="wp-caption-text">Futuros y promesas</p></div>
<p>Para poder articular una programación asíncrona y reactiva es necesario utilizar patrones adaptados a este tipo de programación. Puedes utilizar el patrón <strong>observable</strong> o las <strong>señales</strong>,  pero casi podríamos decir que tu camino te llevará irremisiblemente al patrón <strong>futuro</strong> en cuando tienes que integrar varios resultados asíncronos. Si además nuestra implementación del patrón futuros-promesas cumple con las propiedades de las <strong>monadas</strong> se nos abre un mudo de posibilidades. Con la programación funcional, la composición de futuros se podrá hacer de una manera elegante obteniendo un código más legible.</p>
<p>Esto permite realizar <strong>DSL&#8217;s</strong> (Domain Specific Language) y separar la lógica de negocio de los efectos de lado. Por ahora “<em>&#8230; ahí lo dejo</em>”; prefiero no perder foco en el objetivo de este artículo, pero en mi mente esta tratar todo esto en una nueva reseña. En este artículo entraré a desarrollar todos estos nuevos conceptos intentando desmitificarlos, porque al principio todo lo de “<em>Futuros</em>”, “<em>Promesas</em>” y “<em>Mónadas</em>” puede que suene “<em>muy místico</em>”. Lo haré apoyado en mi propia implementación del patrón Futuros y promesas que está disponible en mi GitHub.</p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/AlternativeFuture" target="_blank" rel="noopener"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a> <a href="https://github.com/logicaalternativa/AlternativeFuture" target="_blank" rel="noopener">AlternativeFuture</a></p>
<p>La implementación está basada “<em>fuertemente</em>” en el Api de Scala de futuros y sólo recordar que Akka en su versión de Java la exporta directamente y que además los futuros de Scala son también monadas. Cuando digo que me apoyo en el Api de Scala me refiero a seguir la definición de su contrato, de hecho, no me interesaba el código fuente y si hacer el ejercicio de, a partir de su interfaz, realizar mi propia implementación en Java. El código que podéis ver y utilizar es todo mio. Hecha esta aclaración es el momento de empezar a entrar en faena.</p>
<p>Intentaré hacer un acercamiento de dentro a fuera. Primero pondré el foco en las ideas principales para ir después abriendo el zoom y conseguir tener la imagen completa.</p>
<h2>Futuros</h2>
<p>«<em>¿Qué es un futuro?</em>» Pongámonos en contexto. Imaginemos dos procesos: uno será el principal que llamará a un método que devuelve un futuro de un valor. El otro será el que calcule realmente el valor de manera asíncrona ejecutado en un segundo plano con respecto al principal. Voy a poner un ejemplo para hacerlo más didáctico. <strong>A</strong>na (el hilo <strong>A</strong>, el principal) le dice a <strong>B</strong>artolo (el hilo <strong>B</strong>) que haga la colada (llamada al método)</p>
<div style="width: 610px" class="wp-caption aligncenter"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/futuresanabartolo-1/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-1-e1502818196258.png" alt="Llamada asíncrona" width="600" height="344" /></a><p class="wp-caption-text">1. Llamada asíncrona</p></div>
<p>El proceso principal obtiene un futuro como resultado de llamar a un método que se lanzará en segundo plano gracias al hilo B. En el ejemplo<strong> B</strong>artolo manda una nota (representa el futuro) a <strong>A</strong>na que le permitirá apuntar lo  que se quiere que se haga con la colada cuando haya terminado <strong>B</strong>artolo. El hilo <strong>A</strong> no queda a la espera del resultado de la acción ejecutada por el hilo <strong>B</strong> y queda liberado para realizar otras operaciones. En el ejemplo <strong>A</strong>na no espera a que <strong>B</strong>artolo termine y  puede seguir haciendo otras tareas.</p>
<div style="width: 620px" class="wp-caption aligncenter"><a href="/futuresanabartolo-2/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-2.png" alt="2. Se devuelve un futuro" width="610" height="350" /></a><p class="wp-caption-text">2. Se devuelve un futuro</p></div>
<p>Este futuro es en realidad un artefacto que permite asignar, desde el proceso principal una función <em>callback</em>. En el siguiente paso, <strong>A</strong>na decidirá que es lo que quiere hacer cuando termine la colada, es decir, asignará la función callback que se ejecutará cuando se obtenga el resultado del segundo proceso ejecutado por <strong>B</strong>artolo.</p>
<div style="width: 620px" class="wp-caption aligncenter"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/futuresanabartolo-3/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-3.png" alt="Asignar callback" width="610" height="350" /></a><p class="wp-caption-text">3. Asignar callback</p></div>
<p>Cuando, gracias al segundo proceso, se haya calculado finalmente el valor, se ejecutará la función de regreso al que se le pasará como argumento el valor final obtenido. En el ejemplo tenemos la función «<em>planchar la ropa</em>» y el resultado del proceso: «<em>la ropa lavada»</em>.</p>
<div style="width: 620px" class="wp-caption aligncenter"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/futuresanabartolo-4/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-4.png" alt="Resultado del futuro" width="610" height="350" /></a><p class="wp-caption-text">4. Resultado del futuro</p></div>
<h3>Contextos de ejecución</h3>
<p>La ejecución de las funciones callback con el valor final como argumento se hará dentro de lo que se llama un <strong>contexto de ejecución</strong>. Este no es más que un pool de hilos que permite <strong>independizar la ejecución</strong> de la función con el valor final tanto del hilo principal como del segundo proceso, es decir, se ejecutarán en un tercer hilo “<em>reutilizable</em>”. En el ejemplo que estamos siguiendo es <strong>C</strong>arlos (el hilo <strong>C</strong>) el que plancha la  ropa.</p>
<div style="width: 620px" class="wp-caption alignright"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/futuresanabartolo-5/"><img src="/wp-content/uploads/2017/07/futuresAnaBartolo-5.png" alt="Ejecución de la función callback con el valor del futuro" width="610" height="490" /></a><p class="wp-caption-text">Ejecución de la función callback con el valor del futuro</p></div>
<p>En la implementación del patrón que he propuesto a cada una de las funciones callback y de orden superior definidas en el interfaz futuro se le puede pasar un contexto de ejecución.</p>
<h2>Más cosas de los futuros</h2>
<p>A grandes rasgos, esta es la esencia: el futuro permite configurar desde la ejecución principal que hacer cuando finalmente exista el valor. Y se hace sin tener que bloquear hilos porque sino arruinamos la asincronía.</p>
<p>Teniendo esto en mente y sin perder de vista lo simple de este concepto, base de todo, voy a ir añadiendo nuevos conceptos e ideas que nos permitirá ir completando la visión general del patrón.</p>
<h3>Dos caminos</h3>
<p>Añadiendo una nueva capa a las funciones <em>callback</em>. El resultado de la ejecución de cualquier método puede ser, o bien su valor, o bien que su ejecución se haya saldado con un error, luego el resultado final que contiene un futuro puede ser:</p>
<ul>
<li>un valor correcto</li>
<li>o también una excepción.</li>
</ul>
<p>¿Por qué no contemplar esta circunstancia con dos caminos? Un camino para cuando el valor sea correcto con su correspondiente función <em>callback</em> (el método <strong><em>onSuccess</em></strong>) y otro que nos permita definir otra función de regreso cuando se produzca un error (el método <strong><em>onFailure</em></strong>)</p>
<hr />
<h4 style="padding-left: 90px;"><span style="color: #808080;">Signatura de un <strong><em>onSuccess</em></strong> y <strong><em>onFailure</em></strong> de <strong><em>AlternativeFuture[T]</em></strong>:</span></h4>
<h5 style="padding-left: 90px;"><span style="color: #808080;">onSuccess</span></h5>
<p><pre style="padding-left: 90px;"><span style="color: #808080;"><strong>void</strong> onSuccesful( final <strong>Consumer</strong>&lt;<strong>T</strong>&gt; function, final <strong>Executor</strong> executor );</span></pre></p>
<p style="padding-left: 90px;"><span style="color: #808080;">El argumento <strong><em>function</em></strong> es una función cuyo argumento es de tipo <strong><em>T</em></strong> (es el tipo del valor final del futuro) y resultado <strong><em>void</em></strong>.</span></p>
<p><pre style="padding-left: 90px;"><span style="color: #808080;">function: <strong>T</strong> =&gt; <strong>void</strong></span></pre></p>
<p style="padding-left: 90px;"><span style="color: #808080;">Esta será la función que se ejecutaría cuando de resultado final del futuro ha ido bien.</span></p>
<h5 style="padding-left: 90px;"><span style="color: #808080;">onFailure</span></h5>
<p><pre style="padding-left: 90px;"><span style="color: #808080;"><strong>void</strong> onFailure ( final <strong>Consumer</strong>&lt;<strong>Throwable</strong>&gt; function, final <strong>Executor</strong> executor );</span></pre></p>
<p style="padding-left: 90px;"><span style="color: #808080;">En este caso el argumento <strong><em>function</em></strong> es una función cuyo argumento es un Throwable (la excepción que se reportaría si se produciría un error) y resultado <em>void</em>.</span></p>
<p><pre style="padding-left: 90px;"><span style="color: #808080;">function: <strong>Throwable</strong> =&gt; <strong>void</strong></span></pre></p>
<p style="padding-left: 90px;"><span style="color: #333333;"><span style="color: #808080;">Está será la función que se ejecutará cuando el futuro se haya solventado con un error</span>.</span></p>
<hr style="padding-left: 60px;" />
<h3>¿Cuando se ejecuta la función callback?</h3>
<p>Para dar respuesta a esta pregunta nos debemos fijar en que existan las dos cosas necesarias para la ejecución de la función: que exista <strong>la función</strong> y que exista <strong>el valor</strong>. Hay entonces dos posibilidades:</p>
<ul>
<li>Puede que ya haya asignada una o varias funciones callback al futuro, entonces la ejecución de las mismas será cuando se obtenga el valor.</li>
<li>O bien puede ser que se obtenga primero el valor y el disparador de que la función se ejecute será la propia asignación de la función callback.</li>
</ul>
<p>Es importante tener en mente que un futuro (“barra” promesa, esto lo explicaré más adelante), sólo se le puede asignar el valor una vez, además otra característica es que una función callback sólo se ejecutará una vez. Sin embargo se puede asignar al futuro, a lo largo del tiempo, todas las funciones callback que se deseen.</p>
<h2>Promesas</h2>
<p>Si has llegado hasta aquí probablemente ya te habrá asaltado la duda: ¿Cómo se da valor al futuro? ¿Cómo se le asigna un valor? La respuesta: a través de la <strong><em>promesa</em></strong>.</p>
<p>Podemos decir que la promesa y el futuro son las dos caras de la misma moneda y que una promesa está relacionada con un futuro. La idea básica que debemos tener en mente es la siguiente:</p>
<ul>
<li>el futuro permite asignar la función callback para tomar decisiones una vez se haya obtenido el valor</li>
<li>la promesa permite dar valor a ese futuro.</li>
</ul>
<p>Si volvemos al ejemplo anterior, será más sencillo de entender. Si recordamos el proceso principal llamaba a un método que permite en un segundo proceso calcular un valor de manera asíncrona en un tiempo indeterminado (puede ser antes o después). Mientras que el <strong>proceso principal</strong> tiene como herramienta al<strong> interfaz futuro</strong> que le permite indicar que es lo que se debe de hacer una vez se haya calculado el valor,<strong> el interfaz de la promesa</strong> será el instrumento que poseé <strong> el segundo proceso</strong> encargado de calcular el valor para asignar el valor a ese futuro. En síntesis <strong>A</strong>na usaría el futuro y <strong>B</strong>artolo la promesa.</p>
<div style="width: 635px" class="wp-caption alignnone"><a href="/diagramadeactividadespromesasfuturo-2/"><img src="/wp-content/uploads/2017/08/diagramaDeactividadesPromesasFuturo-peque.png" alt="Diagrama de flujo Promesa-Futuro" width="625" height="432" /></a><p class="wp-caption-text">Diagrama de flujo Promesa-Futuro</p></div>
<div style="width: 808px" class="wp-caption aligncenter"><a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/sequenciapromesasfuturo/"><img src="/wp-content/uploads/2016/11/sequenciaPromesasFuturo.png" alt="Diagrama de secuencia Promesa-Futuro" width="798" height="472" /></a><p class="wp-caption-text">Diagrama de secuencia Promesa-Futuro</p></div>
<hr />
<h4 style="padding-left: 120px;"><span style="color: #808080;">Implementación</span></h4>
<p style="padding-left: 120px;"><span style="color: #808080;">Si echáis un vistazo al código, podéis observar que sólo existe una implementación que implementa las dos interfaces: la promesa y el futuro.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">La clase <a href="https://github.com/logicaalternativa/AlternativeFuture/blob/master/src/main/java/com/logicaalternativa/futures/imp/AlternativePromiseImp.java" target="_blank" rel="noopener"><strong><em>AlternativePromiseImp</em></strong></a> tiene un atributo que permite almacenar el valor del futuro. Este se asignará gracias a los métodos que expone el interfaz promesa <strong><em><a href="https://github.com/logicaalternativa/AlternativeFuture/blob/master/src/main/java/com/logicaalternativa/futures/AlternativePromise.java" target="_blank" rel="noopener">AlternativePromise</a></em></strong>.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">Existen dos atributos más en AlternativePromiseImp que son del tipo de cola FIFO (el primero que entra será el primero que sale). Permiten almacenar las funciones callback gracias a los métodos expuestos por el interfaz <a href="https://github.com/logicaalternativa/AlternativeFuture/blob/master/src/main/java/com/logicaalternativa/futures/AlternativeFuture.java" target="_blank" rel="noopener"><strong><em>AlternativeFuture</em></strong></a>.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">Una de las colas guardará las funciones que se van a ejecutar cuando mediante la promesa relacionada se asigne un valor correcto al futuro. Las funciones se van añadiendo a esta cola utilizando el método &#8216;<em>onSuccesful</em>&#8216; del interfaz AlternativeFuture.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">La otra cola FIFO almacenará las funciones callback que se ejecutarán cuando la promesa relacionada se resuelva con un error. De la misma manera, se van añadiendo estas las funciones gracias al método &#8216;<em>onFailure</em>&#8216; del interfaz AlternativeFuture.</span></p>
<p style="padding-left: 120px;"><span style="color: #808080;">Bien cuando se asigna un valor a la promesa o bien cuando se añade una función callback al futuro se comprueba que existan los requisitos necesarios (la función y el valor del futuro). Si es así se ejecutará las funciones callback incluidas en la cola de callbacks con el valor final. Según se vayan ejecutando las funciones se eliminarán de la cola.</span></p>
<hr />
<h2>El Futuro como mónada. Programación funcional con AlternativeFuture</h2>
<p>Se puede dar una vuelta de tuerca más y seguir añadiendo capas a la cebolla. El patrón Futuro/promesa permite adoptar un nuevo patrón funcional: la <strong>monada</strong>. Este artículo ya es lo suficientemente extenso, quizás con ya demasiados conceptos así que dejo pospuesto introducir la composición mónadica con AlternativeFuture y os emplazo a un siguiente post continuación de este.</p>
<p><a href="/mi-cv/"><strong><em>M.E.</em></strong></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/patrones/" rel="category tag">Patrones</a> y está etiquetada con <a href="/tag/futuros/" rel="tag">futuros</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/patrones/" rel="tag">patrones</a> en <a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/" title="19:20" rel="bookmark"><time class="entry-date" datetime="2017-08-15T19:20:34+00:00">15 agosto, 2017</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-956" class="post-956 post type-post status-publish format-standard hentry category-general category-java category-programacion tag-actores tag-akka tag-java tag-programacion-reactiva">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/akka-por-ejemplos-actores-tipados/" rel="bookmark">Actores tipados, Akka por ejemplos</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<blockquote><p><strong><span style="color: #808080;">«Tercer y último artículo sobre Akka explicado mediante ejemplos.</span></strong></p>
<p><span style="color: #808080;"><strong>En los dos anteriores se basó en como funcionan la cola de mensajes de un actor, que es un router, como se envían mensajes entre actores. Después se trató temas como la supervisión y el bus de eventos.</strong></span></p>
<p style="text-align: left;"><span style="color: #808080;"><strong>Ahora me centraré en los actores tipados.</strong>«</span></p>
</blockquote>
<p style="text-align: right;"><em>Entrada anterior: <a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/">Akka por ejemplos. Sobre supervisión, bus de eventos, …</a><br />
</em></p>
<p>Todo el código fuente relacionado con esta serie de posts está disponible en mi repositorio de <strong>GitHub</strong></p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a> <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank">AkkaActorsAndFutures</a></p>
<hr />
<h2>Actores tipados</h2>
<p>Los <strong>actores tipados</strong> son una funcionalidad que ofrece <em>Akka</em> recubriendo un <strong>actor no tipado en un interfaz java</strong>. Con un actor tipado el programador realiza llamadas a un método de una clase normal &#8216;<em>sin preocuparse</em>&#8216; (y pongo esto entre comillas por lo que veremos más adelante) de lo que está detrás es un actor de <em>Akka</em>.</p>
<div id="attachment_933" style="width: 230px" class="wp-caption aligncenter"><img class="size-full wp-image-933" src="/wp-content/uploads/2015/10/typedActor-peque.png" alt="[Actor tipado]" width="220" height="158" /><p class="wp-caption-text">[Actor tipado]</p></div>
<p style="text-align: left;">Permite unir los dos mundos, código java estándar con el mundo de los actores. En la documentación de <em>Akka</em> puedes leer que tienen su nicho, pero hay que &#8216;<em>usarlos con moderación</em>&#8216;. Recomiendan que si lo que buscas es una arquitectura de alta escalabilidad utilizar estos actores no es la solución más sencilla. Por ejemplo en este caso, aunque se puede, no es tan natural la supervisión y la monitorización padre-hijo.</p>
<p>Para los actores tipados, <em>Akka</em> utiliza el patrón de <strong><a href="https://en.wikipedia.org/wiki/Active_object" target="_blank">Objetos Activos</a></strong> y proxys de Java. Para levantar un actor tipado es necesario una<strong> interfaz</strong> y una <strong>implementación</strong>. Simplificando, en los actores tipados no existe el método &#8216;<em>onReceive()</em>&#8216; y se utilizan como un clase más de Java haciendo llamadas a los métodos que exporta la interfaz.</p>
<p>En realidad lo que hay detrás es un actor no tipado. <em>Akka</em> monta un proxy en el que el interfaz será la fachada y el &#8216;<em>contrato público</em>&#8216; que podrá utilizar el resto del código java. Los atributos de los métodos de ese interfaz serán los mensajes que se enviarán al actor y la implementación será la que dicte el comportamiento. Por lo demás se cumple con el modelo de actores que asegurá que <strong>no habrá más de un hilo ejecutando el actor</strong>.</p>
<p>Todo esto, que haya un actor detrás de este interfaz, hace que tenga un <strong>comportamiento diferente</strong> al esperado en una clase <em>java, </em>y hay que tenerlo en mente cuando se utilizan actores tipados.</p>
<p>Para los ejemplos se ha utilizado una clase <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/typed/imp/TypedActorDummyImp.java" target="_blank">TypedActorDummyImp</a></em> que implementa el interfaz <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/typed/TypedActorDummy.java" target="_blank">TypedActorDummy</a></em> con una serie de métodos sencillos que permitirán ver con facilidad el funcionamiento de los actores tipados.</p>
<p>He creado dos test, uno <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/typed/TypedActorDummyImpTest.java" target="_blank"><strong><em>TypedActorDummyImpTest.java</em></strong></a> que comprueba el comportamiento en una llamada normal a un método con diferentes tipos de retorno y otro <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/typed/TypedActorDummyImpExceptionsTest.java" target="_blank"><strong><em>TypedActorDummyImpExceptionsTest.java</em></strong></a> para ver cual será su comportamiento si se produce una excepción.</p>
<h3>Comportamiento según el tipo de retorno.</h3>
<p>Un método puede devolver tres tipos de respuesta: o bien es un método que <strong>no devuelve nada</strong> (<em>void</em>), o devuelve <strong>un objeto</strong>, o bien devuelve un <strong>futuro de objeto</strong>.</p>
<h4>Cuando un método devuelve no devuelve nada: void</h4>
<p>Cuando un actor tipado el tipo de respuesta es &#8216;<em>void</em>&#8216;, lo que está ocurriendo es que se está mandando un <strong>mensaje del tipo dispara y olvida</strong> (<em>&#8216;fire-forget</em>&#8216;). En realidad se está enviado un mensaje &#8216;<strong><em>tell</em></strong>&#8216; al actor que hay por detrás, y no se espera respuesta.</p>
<p>Esto hace que tenga un comportamiento un poco &#8216;<em>diferente</em>&#8216; del esperado y es algo que se puede comprobar en los dos ejemplos.</p>
<h5>Test 1: Llamada normal</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpTest#testReturnVoidWithSleep test</strong></pre><br />
En este test se levanta un actor tipado que tiene un método que devuelve <em>void.</em> Se simula una operación costosa con un “<em>Thread.sleep</em>”.</p>
<p>Se comprueba que no se espera a la ejecución del método, sino que se continua inmediatamente con la siguiente orden. El mensaje se ha encolado al actor y este ejecutará la implementación en segundo plano, sin ningún tipo de espera en el hilo principal.</p>
<h5>Test 2: Cuando se produce una excepción</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpExceptionsTest#testRuntimeExceptionVoid test</strong></pre><br />
Como consecuencia de que el mensaje es enviado al actor, ejecutándose en un segundo plano, el hilo principal no es capaz de saber si ha ocurrido un error en la ejecución. Si se produce una excepción no será recogida desde la llamada al método.</p>
<p>El test anterior permite hacer esta comprobación y es bastante didáctico.</p>
<h4>Cuando un método devuelve un futuro</h4>
<h5>Test 1: Llamada normal</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpTest#testFutureEcho test</strong></pre><br />
Cuando se llama a un método de un actor tipado que devuelve un futuro, el comportamiento sería el mismo que si se enviara un mensaje de<strong> petición y respuesta no bloqueante</strong>. Es el equivalente al envío de un mensaje con &#8216;<em>Patterns.ask(&#8230;)&#8217;</em> de un actor no tipado.</p>
<p>Por lo tanto la respuesta se recogerá cuando se resuelve el futuro y no desde la llamada al método. El hilo principal continuaría su ejecución sin esperar.</p>
<h5>Test 2: Cuando se produce una excepción</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpExceptionsTest#testRuntimeExceptionFuture test</strong></pre><br />
Lo mismo pasaría si se produjera una <strong>excepción</strong>, sería<strong> devuelta en la resolución del futuro</strong> y no sería recogida en la llamada al método tipado. Esto entra dentro de lo lógico si pensamos que cuando se produce el error es en el momento en el que se procesa el mensaje por parte del actor.</p>
<h4>Cuando un método devuelve un objeto</h4>
<h5>Test 1: Llamada normal</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpTest#testEcho test</strong></pre></p>
<h5>Test 2: Cuando se produce una excepción</h5>
<p><pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.typed.TypedActorDummyImpExceptionsTest#testRuntimeExceptionString test</strong></pre><br />
Cuando se llama a un método de un actor tipado que devuelve un objeto, el comportamiento es &#8216;<em>parecido</em>&#8216; al esperado. Y digo &#8216;<em>parecido</em>&#8216; porque en realidad lo que se está haciendo es enviando el mensaje al actor y esperando la respuesta (siguiendo un patrón de p<strong>etición-respuesta bloqueante</strong>)</p>
<p>Por lo tanto desde la llamada al método de un actor tipado hace que hilo de ejecución principal espere la respuesta (aunque por detrás se esté enviando un mensaje ejecutándose en otro &#8216;hilo&#8217;). Por lo tanto el comportamiento es &#8216;el mismo&#8217; al acostumbrado (ver el ejemplo 1). En este caso si se produce una excepción si será recogida en la llamada al método (Ver test 2)</p>
<hr />
<p>Como conclusión final de esta serie de posts decir que aunque el modelo de actores y <em>Akka</em> presentan nuevos conceptos, estos una vez aprendidos son sencillos de asimilar.</p>
<p>A cambio ofrece un modo elegante y sencillo de codificar aplicaciones que soporten programación paralela  que sean escalables, robustas y  de alta disponibilidad.</p>
<p>Espero que os sirva.</p>
<p><strong><em><a href="/mi-cv/">M.E.</a></em></strong></p>
<p><!--wp_fromhtmlpreview_devfmt--><!--wp_fromhtmlpreview_devfmt--></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/general/" rel="category tag">General</a>, <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/" rel="category tag">Programación</a> y está etiquetada con <a href="/tag/actores/" rel="tag">actores</a>, <a href="/tag/akka/" rel="tag">akka</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/programacion-reactiva/" rel="tag">programación reactiva</a> en <a href="/akka-por-ejemplos-actores-tipados/" title="21:48" rel="bookmark"><time class="entry-date" datetime="2015-11-09T21:48:05+00:00">9 noviembre, 2015</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-918" class="post-918 post type-post status-publish format-standard hentry category-java category-programacion tag-actores tag-akka tag-bus-de-eventos tag-futuros tag-java tag-programacion-reactiva tag-robustez">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/" rel="bookmark">Akka por ejemplos. Sobre supervisión, bus de eventos, &#8230;</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<blockquote><p><strong><span style="color: #808080;">Esta es la segunda entrega de Akka por ejemplos. La primera trató sobre cual es el funcionamiento de la cola de mensajes de un actor, que es un router y como se envían mensajes entre actores.</span></strong></p>
<p><strong><span style="color: #808080;">Ahora se tratarán temas como el control de fallos y la supervisión de actores, el bus de eventos de Akka y sobre los &#8216;Dead Letters&#8217;</span></strong></p>
<p style="text-align: right;"><em>Entrada anterior: <strong><a href="/akka-por-ejemplos/">Akka por ejemplos</a></strong></em></p>
</blockquote>
<p>Sin más vamos con los ejemplos.</p>
<p>Todo el código fuente relacionado con esta serie de posts está disponible en mi repositorio de <strong>GitHub</strong></p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a> <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank">AkkaActorsAndFutures</a></p>
<hr />
<h2>Control de fallos: Supervisión y monitorización.</h2>
<p><div id="attachment_930" style="width: 230px" class="wp-caption alignright"><a href="/wp-content/uploads/2015/10/supervision-peque.png"><img class="wp-image-930 size-full" src="/wp-content/uploads/2015/10/supervision-peque.png" alt="[Supervisión padre-hijo en Akka]" width="220" height="172" /></a><p class="wp-caption-text">[Supervisión padre-hijo en Akka]</p></div>En <strong><em>Akka</em></strong> la robustez a fallos se basa en la supervisión de actores con jerarquía padre-hijo. El actor que delega tareas en los actores que crea es el que &#8216;<em>supervisa</em>&#8216; y decide que hacer cuando se produce un fallo en alguno de sus hijos.</p>
<p>Se crea así una jerarquía en forma de árbol en la que la que los actores padres supervisan a los actores hijos. El actor &#8216;<em>user</em>&#8216; de <strong><em>Akka</em></strong> será el padre de primera generación de actores que hayamos creado.</p>
<p>Esto es realmente lo que te da la <strong>robustez</strong> (&#8216;<em>resilence</em>&#8216;)  que un sistema reactivo necesita. Esta robustez se pierde cuando se intenta en vez de tener esta jerarquía, ir a un esquema con una mentalidad más tradicional de inyección de dependencias y se cae en la tentación de inyectar actores a otros actores.</p>
<p>Cuando un actor falla y se produce una excepción, su supervisor puede hacer, o bien <strong>reiniciar</strong> el actor, <strong>parar</strong> el actor, <strong>escalar</strong> la excepción o absorber la excepción y <strong>continuar</strong> con la ejecución.</p>
<p>El sistema de supervisión de <em>Akka</em> permite tener la posibilidad de diferente respuesta del supervisor dependiendo del tipo de excepción y si esta afecta a todos los actores supervisados o sólo al que ha fallado. Esto junto con lo anterior permite implementar fácilmente patrones,  por ejemplo de tipo &#8216;<em>circuit breaker</em>&#8216;, si uno de los actores falla.</p>
<p><em>Akka</em> tiene la posibilidad de establecer eventos o disparadores en el ciclo de vida de un actor. Por ejemplo <strong>antes de crearlo</strong>, <strong>antes</strong> y <strong>después</strong> de <strong>reiniciarlo</strong> y cuando se <strong>para</strong>.</p>
<p>Ademas del concepto de supervisión, en <em>Akka</em> existe el de <strong>monitorización</strong>. Cualquier actor, puede &#8216;<em>monitorizar</em>&#8216; a cualquier otro, lo haya creado o no. El primero obtiene un mensaje &#8216;<strong><em>Terminated</em></strong>&#8216; cuando el monitorizado ha terminado. Esto permite modificar su comportamiento o cambiar su estado. En los ejemplos siguientes el actor supervisor también hace de &#8216;<em>monitor</em>&#8216; de sus hijos.</p>
<p>Para poder mostrar con ejemplos como es el comportamiento de las diferentes estrategias a seguir, he creado en el proyecto dos actores: <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank"><strong><em>ActorNoTypedDummyCheckLifeCycle</em></strong></a> y <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLetItCrash.java" target="_blank">ActorNoTypedLetItCrash</a></em></strong>.</p>
<p><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank">ActorNoTypedDummyCheckLifeCycle</a></em> se utiliza para comprobar los eventos que se disparan y por los &#8216;<em>estados</em>&#8216; que pasa un actor cuando es supervisado con diferentes estrategias. Concatena en un atributo &#8216;<em>state</em>&#8216; los diferentes pasos por los &#8216;<em>hooks</em>&#8216; del ciclo de vida de un actor:</p>
<ul>
<li>Método &#8216;<strong><em>aroundPreStart</em></strong>&#8216;: Primer evento que se dispara cuando se inicia un actor. Sólo se ejecuta cuando se inicia un actor por primera vez.</li>
<li>Método &#8216;<strong><em>preStart&#8217;</em></strong>: Se lanzan cuando se inicia un actor o después de que se haya reiniciado.</li>
<li>Método &#8216;<strong><em>aroundPreRestart&#8217;</em></strong>: Cuando un actor va a ser reiniciado, se dispara antes de parada el actor.</li>
<li>Método &#8216;<strong><em>preRestart</em></strong>&#8216;: También se ejecuta antes de parar el actor cuando va a ser reiniciado. La llamada es después de la del método &#8216;<em>aroundPreRestart</em>&#8216;</li>
<li>Método &#8216;<strong><em>postStop</em></strong>&#8216;: Evento que se llama, o bien cuando se para el actor, o bien antes de reiniciarlo (en este último caso justo después de que se llame al método &#8216;<em>preRestart</em>&#8216;)</li>
<li>Método &#8216;<strong><em>postRestart</em></strong>&#8216;: Se lanza después de reiniciar el actor.</li>
<li>Método &#8216;<strong><em>aroundPostStop</em></strong>&#8216;: Se realiza la llamada justo antes de parar definitivamente el actor.</li>
</ul>
<p>El actor <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLetItCrash.java" target="_blank">ActorNoTypedLetItCrash</a></em> es el que creará y hará de supervisor de <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank">ActorNoTypedDummyCheckLifeCycle</a></em>. En su constructor,  permite definir por parámetro la estrategia de supervisión. Su comportamiento será en de hacer de proxy en el envío de mensajes a  <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank">ActorNoTypedDummyCheckLifeCycle</a></em> hasta que este el actor hijo se pare o cuando el mismo se haya reiniciado.</p>
<p>Para mostrar el comportamiento de las diferentes estrategias y cual es el ciclo de vida especifico de los actores (cuando se llama a los diferentes &#8216;<em>hooks</em>&#8216;) he codificado en el proyecto los siguientes ejemplos.</p>
<h3>Estrategia de supervisión por defecto</h3>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/supervisorstrategy/ActorLetItCrashTestDefault.java" target="_blank">ActorLetItCrashTestDefault.java</a></em></strong><br />
<pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.supervisorstrategy.ActorLetItCrashTestDefault test</strong></pre><br />
Si se produce un excepción en un actor hijo, la <strong>estrategia por defecto</strong> en <em>Akka</em> es la de <strong>reiniciar el actor hijo</strong>, excepto si es un error irrecuperable:</p>
<ul>
<li> cuando se ha producido una excepción al inicializar el actor (<strong><em>ActorInitializationException</em></strong>)</li>
<li>cuando ya se había parado el actor(<strong><em>ActorKilledException</em></strong>)</li>
</ul>
<p>Esta estrategia cobra sentido cuando se quiere mantener un sistema estable. La idea subyacente es que cuando se produce un error el sistema debería volver a un estado consistente y esto se consigue reiniciando el estado del actor.</p>
<p>En este ejemplo, los pasos son:</p>
<ol>
<li>Se envía un primer mensaje &#8216;<em>state</em>&#8216; al actor <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLetItCrash.java" target="_blank">ActorNoTypedLetItCrash</a></em>. Este hará el reenvío del mensaje al actor hijo (<em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummyCheckLifeCycle.java" target="_blank">ActorNoTypedDummyCheckLifeCycle</a></em>) que devolverá la concatenación de los diferentes métodos por los que ha pasado hasta ese momento.</li>
<li>Después se envía un mensaje con una excepción para que el actor hijo provoque la excepción.</li>
<li>Por último se vuelve a enviar un mensaje &#8216;<em>state</em>&#8216; para ver por los eventos que se ejecutan cuando se reinicia el actor.</li>
<li>Finalmente para poder ver todo el flujo, se para el actor.</li>
</ol>
<p>El ejemplo permite comprobar el flujo completo del paso de los diferentes eventos a lo largo de la vida del actor hijo. En este caso con la estrategia de supervisión por defecto, es este:<br />
<pre>Se llama al constructor
 =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
  =&gt; Llamada a <strong><em>preStart</em></strong>
   =&gt; [[exception]] Se provoca una excepción
    =&gt; Llamada a <strong><em>aroundPreRestart</em></strong>
     =&gt; Llamada a <strong><em>preRestart</em></strong>
      =&gt; Llamada a <strong><em>postStop</em></strong>
       =&gt; Llamada al constructor (Se vuelve a crear el actor)
        =&gt; Llamada a <em><strong>aroundPostRestart</strong></em>
         =&gt; Llamada a <em><strong>postRestart</strong></em>
          =&gt; Llamada a <em><strong>preStart</strong></em>
           =&gt; Llamada a <em><strong>aroundPostStop</strong></em>
            =&gt; Llamada a <em><strong>postStop</strong></em></pre></p>
<h3>Estrategia de supervisión: Escalar la excepción</h3>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/supervisorstrategy/ActorLetItCrashTestEscalate.java" target="_blank">ActorLetItCrashTestEscalate.java</a></em></strong><br />
<pre><em>Commando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.supervisorstrategy.ActorLetItCrashTestEscalate test</strong>

</pre><br />
¿Qué ocurre cuando se elige una estrategia de supervisión de tipo &#8216;<strong><em>escalate</em></strong>&#8216;? En este caso la excepción en el actor hijo provoca el error también en el actor supervisor. El comportamiento final depende entonces de la propia estrategia de supervisión de este último.</p>
<p>El ejemplo puede ayudar a verlo más claro. En este caso se configura el supervisor (<em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLetItCrash.java" target="_blank">ActorNoTypedLetItCrash</a></em>) para que la estrategia de supervisión sea la de <strong>escalar la excepción</strong>. Cuando se provoca una excepción en el actor supervisado, el resultado es el mismo que si se <strong>hubiera producido en el supervisor</strong>.</p>
<p>El este caso el supervisor tiene la estrategia de supervisión por defecto, que lo reinicia, volviéndose a crear el actor hijo.</p>
<p>En el test se comprueba este hecho cuando se valida todo el ciclo de vida del actor hijo. Se arranca y después de la excepción, se para, para después volver a arrancar sin reinicio. Esto último provocado porque al reiniciarse actor supervisor, el hijo se para y se vuelve a crear:<br />
<pre>Llamada a constructor
 =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
  =&gt; Llamada a  <strong><em>preStart</em></strong>
   =&gt; [[exception]] Se provoca una excepción
    =&gt; Llamada a <strong><em>aroundPostStop</em></strong>
     =&gt; Llamada a <strong><em>postStop</em></strong>
      =&gt; Llamada al constructor (Se vuelve a crear el actor)
       =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
        =&gt; Llamada a <strong><em>preStart</em></strong>
        =&gt; Llamada a <strong><em>aroundPostStop</em></strong>
         =&gt; Llamada a <strong><em>postStop</em></strong></pre></p>
<h3>Estrategia de supervisión &#8216;resume&#8217;: &#8216;Absorber&#8217; la excepción.</h3>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/supervisorstrategy/ActorLetItCrashTestResume.java" target="_blank">ActorLetItCrashTestResume.java</a></em></strong><br />
<pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.supervisorstrategy.ActorLetItCrashTestResume test</strong>
</pre><br />
Si el supervisor adopta una estrategia de &#8216;<em>resume</em>&#8216; si se produce un error la excepción no produce ni el reinicio, ni la parada del actor supervisado. Aunque se haya producido el error, sigue levantado a la espera de procesar nuevos mensajes.</p>
<p>El test ayuda a comprender este tipo de supervisión. Se comprueba que cuando se produce una excepción al procesar un mensaje, no se hace <strong>ninguna llamada</strong> a los métodos del ciclo de vida, ni tampoco se escala la excepción. El siguiente mensaje lo procesa correctamente.</p>
<p>El ciclo de vida del actor supervisado con este tipo de supervisión será:<br />
<pre>Llamada a constructor
 =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
  =&gt; Llamada a <strong><em>preStart</em></strong>
   =&gt; [[exception]] Se provoca una excepción
    =&gt; Llamada a <strong><em>aroundPostStop</em></strong>
     =&gt; Llamada a <strong><em>postStop</em></strong></pre></p>
<h3>Estrategia de supervisión &#8216;stop&#8217;: Parar el actor supervisado.</h3>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/supervisorstrategy/ActorLetItCrashTestStop.java" target="_blank">ActorLetItCrashTestStop.java</a></em></strong><br />
<pre><em>Comando maven</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.supervisorstrategy.ActorLetItCrashTestStop test</strong></pre><br />
En este caso, se para el actor supervisado cuando al procesar un mensaje ocurre una excepción.</p>
<p>En el ejemplo se fuerza esta situación. Si se provoca una excepción en el actor supervisado se comprueba que el actor no se vuelve a reiniciar. De hecho si se le vuelve a enviar un mensaje de estado, este se envía a la cola de &#8216;<em>Dead Letters</em>&#8216; porque la referencia al actor ya no apunta a un actor válido.</p>
<p>El ciclo de vida del actor es el siguiente:<br />
<pre>Llamada a constructor
 =&gt; Llamada a <strong><em>aroundPreStart</em></strong>
  =&gt; Llamada a  <strong><em>preStart</em></strong>
   =&gt; [[exception]] Se provoca una excepción
    =&gt; Llamada a <strong><em>aroundPostStop</em></strong>
     =&gt; Llamada a <strong><em>postStop</em></strong></pre><br />
Los mismos pasos que con la estrategia &#8216;<em>resume</em>&#8216;. Pero en este caso no ha sido necesario parar el actor en el test porque &#8216;<em>muere</em>&#8216; después de provocarse la excepción.</p>
<h2>Bus de eventos interno de Akka</h2>
<p>Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/bus/PublishSimpleSuscribeTest.java" target="_blank">PublishSimpleSuscribeTest.java</a></em></strong><br />
<pre><em>Comando maven
</em><strong>mvn -Dtest=com.logicaalternativa.examples.akka.bus.PublishSimpleSubcribeTest test</strong>
</pre><br />
<strong><em>Akka</em></strong> poseé un bus interno que permite el envío de mensajes siguiendo el patrón <strong>publicador-suscriptor</strong>. Un &#8216;<em>publicador</em>&#8216; envía un mensaje sin saber quien van a ser los receptores. Los actores que quieran recibir ese tipo de mensajes deberán suscribirse a esa publicación.</p>
<p><img class="alignleft size-full wp-image-952" src="/wp-content/uploads/2015/10/busEvent-peque2.png" alt="[Bus de eventos de Akka]" width="250" height="145" />El paradigma cambia. En vez de enviar un mensaje a un actor concreto, es decir, “<em>(Por favor) haz esto</em>”, cuando se <strong>publica un mensaje en el bus</strong> se está diciendo “<em>(A quien pueda interesar) ha ocurrido esto</em>”</p>
<p>En este caso el ejemplo muestra un uso sencillo del bus de <strong><em>Akka</em></strong> para mostrar este patrón.</p>
<p>Se levantan dos actores suscriptores (del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLogEvent.java" target="_blank"><em>ActorNoTypedLogEvent</em></a>) que se suscribirán a mensajes de tipo <em>Integer</em>. La implementación de este actor es sencilla: registra los mensajes del tipo a los que está suscrito y si se le envía un mensaje &#8216;<em>lastMessage</em>&#8216; devolverá el último mensaje que ha registrado.</p>
<p>En el test después de levantar a los dos suscriptores se envía un mensaje al bus de <em>Akka</em>. Después se comprueba que el mensaje le ha llegado a ambos.</p>
<h2>Dead letters</h2>
<p>Test: <em><strong><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/bus/DeadLettersTest.java" target="_blank">DeadLettersTest.java</a></strong></em><br />
<pre><em>Comando maven
</em><strong>mvn -Dtest=com.logicaalternativa.examples.akka.bus.DeadLettersTest test</strong></pre><br />
Un &#8216;<strong><em>dead letter</em></strong>&#8216; se produce cuando <strong>no</strong> se ha podido <strong>entregar un mensaje a un actor</strong>. Un caso típico es cuando el actor receptor del mensaje ya no existe. El &#8216;<em>dead letter</em>&#8216; contiene el<strong> mensaje enviado</strong>, la referencia al <strong>actor que lo envía</strong> y la del que <strong>lo iba a recibir</strong>.</p>
<p>Por defecto <em>Akka</em> informa en el log de la aplicación los dead letters que se producen (esto es configurable). También pública esta información <strong>a través del bus de eventos de <em>Akka</em></strong>, lo que permite que una aplicación tenga la posibilidad de una gestión específica de estos mensajes perdidos.</p>
<p>En el ejemplo para poder provocar un <em>dead letter</em> se crea un actor del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a> pararlo para a continuación enviarle un mensaje. Este mensaje &#8216;<strong><em>se pierde</em></strong>&#8216; y es recogido como &#8216;<em>dead letter</em>&#8216;.</p>
<p>Por otra parte en el ejemplo se está utilizando un actor del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLogEvent.java" target="_blank"><em>ActorNoTypedLogEvent</em></a> configurado para que suscriba en el bus de eventos de <em>Akka</em> los mensajes del tipo <strong><em>DeadLetter</em></strong>.</p>
<p>Cuando se manda un mensaje de &#8216;<em>lastMessage</em>&#8216; al actor <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedLogEvent.java" target="_blank"><em>ActorNoTypedLogEvent</em></a> este devolverá la información del mensaje perdido en forma de <em>DeadLetter</em>.</p>
<p>Como comprobación final del test se validará la información contenida en el objeto <strong><em>DeadLetter</em></strong>: el mensaje y la referencia al actor receptor.</p>
<hr />
<p>Hasta aquí este segundo artículo de Akka por ejemplos. El próximo y último artículo de esta serie será sobre <strong>actores tipados</strong>.</p>
<p>Espero que os sirva.</p>
<p><strong><em><a href="/mi-cv/" target="_blank">M.E.</a></em></strong></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/" rel="category tag">Programación</a> y está etiquetada con <a href="/tag/actores/" rel="tag">actores</a>, <a href="/tag/akka/" rel="tag">akka</a>, <a href="/tag/bus-de-eventos/" rel="tag">bus de eventos</a>, <a href="/tag/futuros/" rel="tag">futuros</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/programacion-reactiva/" rel="tag">programación reactiva</a>, <a href="/tag/robustez/" rel="tag">robustez</a> en <a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/" title="23:34" rel="bookmark"><time class="entry-date" datetime="2015-10-25T23:34:53+00:00">25 octubre, 2015</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-861" class="post-861 post type-post status-publish format-standard hentry category-java category-programacion tag-actores tag-akka tag-futuros tag-java tag-programacion-reactiva tag-scala">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/akka-por-ejemplos/" rel="bookmark">Akka por ejemplos</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><!--wp_fromhtmlpreview_devfmt--></p>
<p><span style="color: #808080;"><strong>«Akka representa muchos conceptos nuevos que al principio cuesta asimilar. Para poder entenderlo mejor, he ido creando, poco a poco, una serie de ejemplos que me han permitido comprender mejor el paradigma que conlleva.</strong></span></p>
<p><span style="color: #808080;"><strong> <img class="size-full wp-image-866 alignleft" src="/wp-content/uploads/2015/10/akkaExample.png" alt="[Akkapor ejemplos]" width="250" height="94" /></strong></span></p>
<p><span style="color: #808080;"><strong>Este artículo trata sobre esto, intentar tener una prueba de código de cada nuevo concepto que permita ver cual es su comportamiento y función.»</strong></span></p>
<blockquote>
<p style="text-align: right;">Entrada siguiente: <strong><a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/">Akka por ejemplos. Sobre supervisión, bus de eventos, &#8230;</a></strong></p>
</blockquote>
<p><strong><em>Akka</em></strong> es un framework basado en el modelo de actores que permite dar solución al problema de la <strong>programación concurrente</strong>. Además de formar parte de Scala de manera nativa existe como librería en Java.</p>
<p>Permite diseñar aplicaciones que sean <strong>escalables horizontalmente</strong> de manera transparente, con alta <strong>toleracia a fallos</strong> y <strong>basada en eventos</strong> que permite cumplir el &#8216;<strong><em><a href="http://www.reactivemanifesto.org/" target="_blank">manifiesto reactivo</a></em></strong>&#8216;.</p>
<p>Este será el primer de una seríe de artículos explicando conceptos clave que se utilizan en <strong>Akka mediante ejemplos</strong>. En esta primera parte trataré como funciona las <strong>colas de mensajes</strong> de un actor, que es un <strong>router</strong> y las diferentes maneras de como se pueden enviar <strong>mensajes entre actores</strong>.</p>
<p>En próximas entregas trataré sobre el sistema de <strong>supervisión de los actores</strong> en <em>Akka</em>, como funciona el<strong> bus de eventos</strong> y que son los <strong>actores tipados</strong>.</p>
<p>Esta entrada es eminentemente práctica, te invito a descargarte el proyecto y a que eches un vistazo y ejecutes los ejemplos. Se entenderá mejor lo que quiero explicar en este artículo. Todo el código fuente relacionado con esta serie de post está disponible en mi repositorio de <strong>GitHub</strong></p>
<p style="text-align: center;"><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a> <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures" target="_blank">AkkaActorsAndFutures</a></p>
<h2>Sobre los test</h2>
<p>La idea fundamental a la hora de realizar los test ha sido la de realizar implementaciones <em>dummy</em> y &#8216;<em>ad hoc</em>&#8216; y, gracias a ellas, montar test que permitieran ver con facilidad cual es el funcionamiento de la pieza que interesa.</p>
<p>Por otra parte, he buscado que el código incluido en los test puedan servir de ejemplo uando se quiera implementar ese mismo concepto en una aplicación real.</p>
<p>Es por esto por lo que he evitado utilizar el framework de <em>Akka</em> de test &#8216;<em>akka-testkit&#8217;</em> y en algunos momentos puede parecer que me he complicado la vida realizando las validaciones cuando se completan los futuros y utilizando agentes de Akka para compartir estados entre actores.</p>
<p>Mucha de la funcionalidad común a todos los actores, como crear el sistema de actores y métodos de utilidad se ha llevado a test base (<em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/testbase/TestBase.java" target="_blank">TestBase</a></em> y <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/testbase/TestBaseTypedActor.java" target="_blank">TestBaseTypedActor</a></em> ) de los que heredan todos los test.</p>
<h2>Prólogo: Los agentes</h2>
<p>Ya que en los test utilizo <strong>agentes</strong>, antes de entrar a explicar los test, intentaré hacer una breve introdución de lo que es un <strong>agente</strong> en <em>Akka.</em></p>
<p>Un agente de <em>Akka</em> permite almacenar un valor y actualizarlo sin problemas de concurrencia. Tienen la particularidad que la <strong>actualización</strong> se realiza de manera <strong>asíncrona</strong>, pero se puede <strong>leer</strong> el valor de manera <strong>síncrona</strong>.</p>
<p>Su funcionamiento es similar a un mailbox de un actor. Se basa en encolar los nuevos valores de tal manera que el valor interno se va actualizando en orden de llegada. No existe concurrencia y por eso su actualización es asíncrona.</p>
<p>Hay que tener en cuenta que cuando se pide su valor de manera síncrona devuelve el valor &#8216;<em>actual</em>&#8216; no el valor &#8216;<em>futuro</em>&#8216; que tendrá cuando se procesen todos los valores encolados hasta ese momento.</p>
<p>Vamos entonces con los test.</p>
<hr />
<h2>Como funciona la cola de mensajes de un Actor</h2>
<p style="padding-left: 30px;">Test: <em><strong><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/queue/ActorQueueTest.java" target="_blank">ActorQueueTest.java</a></strong></em></p>
<p><pre><em>Commando maven:</em><strong>
mvn  −Dtest=com.logicaalternativa.examples.akka.queue.ActorQueueTest test</strong></pre><br />
<div id="attachment_889" style="width: 140px" class="wp-caption alignright"><img class="wp-image-889 size-full" src="/wp-content/uploads/2015/10/maibox-e1444336153949.png" alt="[Un actor, un mailbox]" width="130" height="156" /><p class="wp-caption-text">Un actor, un mailbox</p></div>El modelo de actores nos asegura que<strong> no puede haber más de una ejecución</strong> concurrente de un actor. Es decir, no puede haber más de un hilo ejecutando el código de actor. Los mensajes que se envían al actor se encolan en su &#8216;<em>inbox</em>&#8216; de tal manera que se ejecutan de uno en uno.</p>
<p>En este ejemplo se está levantando dentro del sistema de actores, un actor del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a>. Este tiene una lógica muy sencilla: si se envía un mensaje tipo <em>Long</em> la ejecución se espera los milisegundos indicados en el valor del mensaje. Si el mensaje es de tipo <em>String</em> devuelve un eco del mensaje.</p>
<p>En el test <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/queue/ActorQueueTest.java" target="_blank">ActorQueueTest</a></em> se envía un primer mensaje tipo <em>Long</em> para que se realice una espera y después 10 mensajes de tipo <em>String</em>.</p>
<p>En en la ejecución del test, se puede observar de que aunque se envían todos los mensajes sin esperar la ejecución del actor, en realidad estos se encolan. El actor no procesa el siguiente mensaje hasta que no ha terminado la ejecución anterior.</p>
<p>El resultado es que<strong> los mensajes son procesados por orden de llegada</strong> ya que este actor tiene la implementación por defecto de &#8216;<em>mailbox</em>&#8216; (existen otras implementaciones que permiten prioridades de mensajes). Con lo que realiza la espera del primero de ellos y después el eco del resto.</p>
<p>En este test para comprobar el orden de los mensajes que se están ejecutando en el actor se está utilizando un agente de <em>Akka</em> para guardar el estado de manera asíncrona.  El agente almacena la concatenación de los mensajes tipo cadena que se envían al actor.</p>
<p>Para verificar que el orden de los mensajes enviados es el mismo orden de los mensajes que se han procesado se comprueba que estas dos cadenas son iguales.</p>
<h2>Cómo funciona un Router</h2>
<p style="padding-left: 30px;">Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/queue/ActorQueueRouteRoundRobinTest.java" target="_blank">ActorQueueRouteRoundRobinTest.java</a></em></strong></p>
<p><pre><em>Commando maven</em>
<strong>mvn  −Dtest=com.logicaalternativa.examples.akka.queue.ActorQueueRouteRoundRobinTest test</strong></pre><br />
<em>Akka</em> permite el concepto de &#8216;<strong><em>Router</em></strong>&#8216;. Esto permite asociar en una misma referencia de un actor envolver un grupo de actores del mismo tipo.</p>
<p>Se basa en el mismo concepto que tenemos todos en mente de que es un <em>Router</em>: un frontal al que se envían los mensajes y que se encarga de reenviarlos a sus &#8216;<em>routees</em>&#8216; para que estos los procesen y devolver la respuesta.</p>
<p>Permite un procesamiento en paralelo mayor, al existir más instancias de un actor, pero con la comodidad de tener una referencia única a la que enviar los mensajes.</p>
<p><div id="attachment_896" style="width: 230px" class="wp-caption alignleft"><img class="wp-image-896 size-full" src="/wp-content/uploads/2015/10/router-peque.png" alt="[Concepto de router]" width="220" height="193" /><p class="wp-caption-text">Router</p></div>Cada miembro del router es de hecho un actor y tiene su propia cola. La estrategia del envío de los mensajes a los miembros del enrutador se define al crear este. En el test de ejemplo se está utilizando la estrategia de envío secuencial de mensajes (<em>&#8216;RoundRobinPool&#8217;</em>): se envía un mensaje a un actor del grupo, el siguiente al siguiente actor y así sucesivamente. En la documentación de <em>Akka</em> puedes ver que existen y se pueden utilizar otras estrategias.</p>
<p>El ejemplo levanta un sistema de actores. Se crea un router de 5 actores del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedWhoIam.java" target="_blank"><em>ActorNoTypedWhoIam</em></a>. Este actor tiene una implementación muy sencilla. Se limita a responder en un <em>Map</em> con el mismo mensaje que le envían y su nombre de actor.</p>
<p>Al router se le envían 10 mensajes. En la resolución de cada futuro de respuesta se comprueba que el mensaje es el mismo que se ha enviado. Por otra parte, gracias a la nombre del <em>routee</em>, se guarda la información de que <em>routee</em> ha procesado el mensaje.</p>
<p>Por último se comprueba que a cada actor del grupo del router le ha llegado el mismo número de mensajes (estrategía de envío <em>RoundRobinPool</em>). En este caso son 2 ya que el router lo forman 5 actores y se mandan 10 mensajes.</p>
<p>En las trazas se puede comprobar que el actor con el nombre &#8216;<em>a</em>&#8216; le llegan los mensajes &#8216;<em>0</em>&#8216; y &#8216;<em>5</em>&#8216;, al &#8216;<em>b</em>&#8216; el &#8216;<em>1</em>&#8216; y el &#8216;<em>6</em>&#8216; y así sucesivamente.</p>
<h2>Como se pueden enviar mensajes entre actores</h2>
<p style="padding-left: 30px;">Test: <strong><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/test/java/com/logicaalternativa/examples/akka/message/ActorProxyTest.java" target="_blank">ActorProxyTest.java</a></em></strong></p>
<p><pre><em>Comando maven</em>
<strong>mvn  -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest test</strong></pre><br />
Fundamentalmente los actores se pueden enviar mensajes de dos maneras diferentes: tipo &#8216;<strong><em>fire &amp; forget</em></strong>&#8216; (dispara y olvida) utilizando la función &#8216;<em>tell</em>&#8216; o bien seguir un esquema <strong><em>petición-respuesta</em></strong> utilizando la función &#8216;<em>ask</em>&#8216;.</p>
<p>Por otra parte un actor puede crear otros actores a los que necesita enviar mensajes. Es muy común que existan actores cuya tarea sea la de orquestar o supervisar el trabajo de los actores que ha creado (&#8216;actores hijos&#8217;), y que una parte de esta tarea sea la de reenviar a sus hijos los mensajes que les llegan. Para estos cosos es muy útil utilizar la función &#8216;<em>forward</em>&#8216;</p>
<p>El ejemplo se crea un actor <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedProxy.java" target="_blank">ActorNoTypedProxy</a></em> que crea un actor hijo del tipo <a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a>. Recordemos que este último devuelve un echo de los mensajes que se le envían.</p>
<p><em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedProxy.java" target="_blank">ActorNoTypedProxy</a></em> hará de proxy para mostrar las diferentes formas de enviar y reenviar mensajes entre actores. Recibe los siguientes mensajes tipo cadena:</p>
<h3>&#8216;<em>forward</em>&#8216;, redirigir el mensaje</h3>
<p><pre><em>Commando maven test 'forward'</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest#testForward test</strong></pre><br />
Cuando recibe un mensaje de este tipo ejecuta llamada al método &#8216;<em>forward</em>&#8216; del actor hijo, con el mismo mensaje. El actor hijo (<a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a>) recibirá el mensaje como si el emisor hubiera sido el que emitió el mensaje al actor <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedProxy.java" target="_blank">ActorNoTypedProxy</a></em>.</p>
<h3>&#8216;<em>redirect</em>&#8216; dispara y olvida</h3>
<p><pre><em>Comando maven test redirect</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest#testRedirectMessageToChild test</strong></pre><br />
El actor que hace de proxy redirecciona el mensaje llamando a la función &#8216;<strong><em>tell</em></strong>&#8216; del hijo indicando que el remitente es el del mensaje original que le llega al proxy. Aquí también el actor hijo (<a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedDummy.java" target="_blank"><em>ActorNoTypedDummy</em></a>) recibirá el mensaje como si el emisor hubiera sido el que emitió el mensaje a <em><a href="https://github.com/logicaalternativa/AkkaActorsAndFutures/blob/master/src/main/java/com/logicaalternativa/examples/akka/ActorNoTypedProxy.java" target="_blank">ActorNoTypedProxy</a></em>.</p>
<div id="attachment_899" style="width: 230px" class="wp-caption aligncenter"><img class="wp-image-899 size-full" src="/wp-content/uploads/2015/10/forward-peque.png" alt="[forward o 'redirect']" width="220" height="128" /><p class="wp-caption-text">forward o &#8216;redirect&#8217;</p></div>
<h3> &#8216;<em>future</em>&#8216;, petición-respuesta no bloqueante y asíncrona</h3>
<p><pre><em>Comando maven test 'future'</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest#testFutur test</strong></pre><br />
Este es un ejemplo de comportamiento <strong>no bloqueante</strong> y <strong>asíncrono</strong> utilizando los <strong>futuros</strong> de <em><strong>Scala</strong></em> que ofrece <em>Akka</em>. <em>ActorNoTypedProxy</em> utiliza la función &#8216;<em>ask</em>&#8216; para con el mismo mensaje que le ha llegado, preguntar al actor hijo <em>ActorNoTypedDummy</em> y obtener el futuro de la respuesta. Este futuro se envía al remitente del mensaje original.</p>
<p>Al ser este un futuro, si fuera necesario, se puede desde el actor que hace de proxy, operar con él o realizar cualquier tipo de transformación. Por ejemplo se puede registrar un callback, realizar alguna transformación operando con el de manera funcional, etc&#8230;</p>
<p>Para simplificar en el test se espera el resultado de la respuesta y como esta también es un futuro, se espera también a este para obtener el resultado.</p>
<h3> &#8216;<em>await</em>&#8216;, petición-respuesta bloqueante y síncrona</h3>
<p><pre><em>Comando maven test 'await'</em>
<strong>mvn -Dtest=com.logicaalternativa.examples.akka.message.ActorProxyTest#testAwaitFutur test</strong></pre><br />
Sigue el mismo esquema que el test anterior pero esperado la respuesta de una manera <strong>síncrona</strong>.</p>
<p>En el actor proxy realiza la misma llamada &#8216;<em>ask</em>&#8216; y a continuación se utiliza la función &#8216;<em>Await</em>&#8216; que espera la resolución del futuro. Se obtiene así un <strong>comportamiento bloqueante</strong> y <strong>síncrono</strong> de<strong> petición-respuesta</strong>.</p>
<hr />
<p>Hasta aquí llega esta primera parte de esta serie de artículos centrados en explicar como funciona Akka con ejemplos. Conceptos como la <strong>supervisión entre actores</strong>, el <strong>bus de eventos</strong> y que son los <strong>actores tipados</strong> serán material de futuras entregas.</p>
<p>Espero que os sirva.</p>
<p><strong><em><a href="/mi-cv/">M.E.</a></em></strong></p>
<blockquote>
<p style="text-align: right;">Entrada siguiente: <strong><a href="/akka-por-ejemplos-sobre-supervision-bus-de-eventos/">Akka por ejemplos. Sobre supervisión, bus de eventos, &#8230;</a></strong></p>
</blockquote>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/" rel="category tag">Programación</a> y está etiquetada con <a href="/tag/actores/" rel="tag">actores</a>, <a href="/tag/akka/" rel="tag">akka</a>, <a href="/tag/futuros/" rel="tag">futuros</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/programacion-reactiva/" rel="tag">programación reactiva</a>, <a href="/tag/scala/" rel="tag">scala</a> en <a href="/akka-por-ejemplos/" title="20:45" rel="bookmark"><time class="entry-date" datetime="2015-10-12T20:45:56+00:00">12 octubre, 2015</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-803" class="post-803 post type-post status-publish format-standard hentry category-php category-sistemas-operativos tag-cache tag-linux tag-php tag-rendimiento tag-robustez">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/pruebas-de-robustez-y-rendimiento-sobre-cache-y-simple-cache-en-php-y-mas/" rel="bookmark">Pruebas de robustez y rendimiento, sobre cache y simple cache en PHP y más&#8230;</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h3 style="text-align: right;"><strong><em>(más =&gt; simular concurrencia, modelo de actores, de “pull request”,&#8230;)</em></strong></h3>
<blockquote><p><strong><span style="color: #808080;"><img class="size-full wp-image-816 alignright" src="/wp-content/uploads/2015/01/robustezRendimiento.png" alt="[Robustez y rendimiento]" width="250" height="209" />“Este artículo trata sobre la importancia de las pruebas de robustez y de rendimiento y su relación directa con la calidad del software, y lo importante que es medir y representar los datos en una gráfica. </span></strong></p>
<p><strong><span style="color: #808080;">Un caso práctico, un sistema de cache PHP simpe basado en almacenamiento en ficheros. En teoría lento ¿verdad? ¿pero lo has comprobado?”</span></strong></p></blockquote>
<h2>Introducción, Cache&#8230;</h2>
<p><strong>C</strong>achear no es que sea nuevo, pero si está de rabiosa actualidad. El cacheo es una técnica fundamental dentro de los paradigmas de escalabilidad y rendimiento que se están implementando en la actualidad. Sus ventajas son claras a la hora de evitar tráfico en los cuellos de botella de una arquitectura, típicamente la base de datos. Las arquitecturas con cache compartida (con sistemas como <strong>Memcached</strong> o a otro nivel <strong>Redis</strong>) y colas de mensajes pasan a ser “la nueva forma” de hacer las cosas.</p>
<p>Está presente también en las tendencias actuales de arquitecturas basadas en <strong>microservicios</strong>. Algunas siguen la máxima “<em>cache everything</em>” (“Cachea todo lo que se mueva..” 🙂 )</p>
<p>Y a otro nivel, también hay un debate abierto con la movilidad y en el que ha entrado de lleno <strong>Linus Torvalds </strong>(<a href="#referencias"><em>1</em></a>). Defiende que añadir más procesamiento en paralelo (más cores a los procesadores de los móviles) no es la solución y que las caches grandes son eficientes.</p>
<p>El cache también tiene sus problemas intrínsecos complejos. Por ejemplo, la invalidez de los valores cacheados. Si no se hace correctamente se puede trabajar con datos &#8216;antiguos&#8217; y perder información. Problema antiguo&#8230; <strong>Martin</strong> <strong>Fowler </strong><em>(<a href="#referencias">2</a>)</em>, ha hecho famosa la cita de <strong>Phil Karlton</strong></p>
<blockquote><p>“There are only two hard things in Computer Science: cache invalidation and naming things.”</p></blockquote>
<h2>El caso práctico, cache simple en PHP</h2>
<p>El objetivo de este post no es tan ambicioso como para meterse de lleno en este problema. En su tiempo para el post “<a title="Dar valor a los tweets: Interés, difusión, audiencia,… trasteando con el API de Twitter" href="/tweets-interes-difusion-audiencia-trasteando-api-twiter/" target="_blank" rel="noopener">Dar valor a los tweets: Interés, difusión, audiencia,… trasteando con el API de Twitter</a>” necesitaba una librería para cachear los resultados del api de Twitter. Me decanté la librería <a title="[php-cache]" href="https://github.com/ecoal95/php-cache/" target="_blank" rel="noopener"><strong>php-cache</strong></a> de <strong><a title="[Emilio Cobos]" href="http://emiliocobos.net/" target="_blank" rel="noopener">Emilio Cobos</a></strong>, me pareció sencilla, fácil de utilizar y configurar y suficiente para lo que necesitaba. Desde entonces llevo usándola también en otros proyectos.</p>
<p>El almacenamiento en memoria es lo más rápido para una cache. Esto, que en <strong>Java</strong> es sencillo de implementar, basta con almacenar el valor en un atributo estático de una clase para que este accesible en todos los hilos de ejecución, en <strong>PHP</strong> es necesario usar extensiones externas al core de <strong>PHP</strong> o utilizar memoria compartida. Esto último honestamente no creo que sea lo más se adecue dentro de este contexto en donde lo que busqué es la máxima sencillez.</p>
<p><img class="alignleft size-full wp-image-820" src="/wp-content/uploads/2015/01/cache.png" alt="[Cache]" width="175" height="148" />La finalidad de la librería es tener un sistema de cache sencillo <strong>sin necesidad de instalación</strong> de extensiones como <em>apc</em> ni ni servicios como <em>memcache</em>. Tan sólo es necesario que el usuario del apache tenga permisos de escritura, cosa que es lo más común. Por esto es ideal para “alojamientos compartidos” de páginas web.</p>
<p>Su funcionamiento similar a otras librerías de este tipo. Está basada en la <strong>serialización</strong> de las variables, y su almacenaje en <strong>ficheros</strong> de texto. El código fuente es sencillo, ordenado y muy fácil de seguir.</p>
<p>Después de decirme a usarla y ver como funcionaba, me surgieron dos dudas. En su momento, en anteriores proyectos, tuve <strong>problemas de concurrencia</strong> en <strong>PHP</strong> cuando más de un proceso leía/escribía en el mismo fichero a la vez. Además que el acceso a cache tuviera acceso a disco «<strong><em>¿cuánto estaba penalizada la velocidad este motivo?</em></strong>»</p>
<p>Estas dos preguntas fueron la excusa para adentrarme en el mundo de las pruebas de rendimiento y de robustez. Otra pata importante dentro del desarrollo que aporta valor a la calidad del software. El resultado de todo esto está reflejado en lo que viene a continuación.</p>
<p>Adelanto que propuse unos cambios en el código y Emilio Cobos a tenido a bien aceptar mi &#8216;<strong><em>pull request</em></strong>&#8216;, por lo tanto he pasado a ser un humilde, pero a la vez orgulloso contribuidor de <strong>php-cache</strong>.</p>
<h2>Pruebas de robustez, concurrencia lectura/escritura de una clave de la cache</h2>
<p><strong>php-cache</strong> utiliza para cada clave de la cache un fichero donde almacena el valor «<em>serializado</em>«. Para probar la concurrencia cuando varios procesos leen/escriben en una misma clave de la cache diseñe dos test.</p>
<p>El primero de ellos, <strong><a title="[robustness-rw.test.php]" href="https://github.com/ecoal95/php-cache/blob/master/test/robustness-rw.test.php" target="_blank" rel="noopener">robustness-rw.test.php</a></strong>, lanza <strong>10 procesos concurrentes</strong>, simulando 10 clientes ejecutando las mismas operaciones a la vez. Cada uno de ellos graba un valor en una clave de la cache y a continuación obtiene el valor de la misma clave de la cache. Estas dos operaciones las realiza cada proceso 50 veces (un total de 500 operaciones de escritura/lectura en total) cambiando cada vez el valor grabado de 3 posibles.</p>
<p>El valor obtenido de la cache tiene que ser igual a alguno de los tres valores posibles. Si es diferente o es nulo el valor se considera como invalido.</p>
<p>El segundo de los test de robustez, <a title="[robustness-rw2.test.php] " href="https://github.com/ecoal95/php-cache/blob/master/test/robustness-rw2.test.php" target="_blank" rel="noopener"><strong>robustness-rw2.test.php</strong></a> es similar al anterior. En este caso además de guardar y obtener el valor se realiza una tercera operación de borrado de la clave de la cache. En este caso, el valor obtenido de la cache tiene que ser igual a alguno de los tres valores posibles o nulo. En cualquier otro caso se considera como inválido.</p>
<p>Los dos test están el directorio <a title="[test]" href="https://github.com/ecoal95/php-cache/tree/master/test" target="_blank" rel="noopener">test</a> repositorio principal de la librería ya que estaban incluidos en el &#8216;<strong><em>pull request</em></strong>&#8216; <strong>aceptado</strong>. En el <a title="[README.md]" href="https://github.com/ecoal95/php-cache/blob/master/test/README.md" target="_blank" rel="noopener"><strong>README.md</strong></a> del directorio test está explicado más en profundidad lo que hacen y como se lanzan.</p>
<p style="text-align: center;"><a title="[php-cache]" href="https://github.com/ecoal95/php-cache/" target="_blank" rel="noopener"><img class="wp-image-432 size-full alignnone" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /> </a> <a title="[php-cache]" href="https://github.com/ecoal95/php-cache/" target="_blank" rel="noopener">Repositorio GitHub Cache.php</a></p>
<h3>Simulando los clientes concurrentes, esquema basado en el modelo de actores</h3>
<p>¿Cómo simular los clientes/peticiones concurrentes? Hay que tener en cuenta que el soporte multihilo no viene habilitado en una instalación tipo de PHP. El esquema que he seguido para simular la concurrencia he seguido en el paradigma de “<em><strong>modelo de actores</strong></em>”.</p>
<p>El script principal (actor principal) se encarga de lanzar los demás actores (procesos secundarios). En este caso son <strong>procesos</strong> PHP, en realidad una copia del mismo test que tiene un comportamiento diferente si “<em>actúa</em>” como actor secundario. Los secundarios se encargan cada uno de de hacer las 50 peticiones de escritura/lectura o escritura/lectura/borrado en una misma clave común.</p>
<p>Una vez lanzado los actores secundarios, el principal espera a que todos terminen para recoger los resultados y calcular la información estadística de los errores que se hayan podido producir.</p>
<p>Los mensajes entre el actor principal (el proceso) y el resto de actores (los procesos secundarios) los he montado utilizando también la librería <strong>php-cache</strong>.</p>
<p>Este es el flujo seguido:</p>
<p><img class="size-full wp-image-811 alignright" src="/wp-content/uploads/2015/01/actores.png" alt="[Concurrencia utlinzando modelo de actores]" width="350" height="284" srcset="/wp-content/uploads/2015/01/actores.png 350w, /wp-content/uploads/2015/01/actores-300x243.png 300w" sizes="(max-width: 350px) 100vw, 350px" /></p>
<ol>
<li>El proceso principal crea los actores pesándoles como <strong>parámetro</strong> una <strong>clave auxiliar</strong> de la cache (diferente para cada proceso) en la que escribirán el resultado. Los actores secundarios una vez hayan terminado su trabajo <strong>escriben</strong> en esa clave de la cache sus resultados.</li>
<li>El proceso/actor principal se encarga de preguntar el estado de los actores lanzados, comprobando si existe la clave auxiliar en la cache que ha asignado a cada proceso.</li>
<li>Una vez haya leído todas las claves auxiliares (todos los procesos hijos han terminado) <strong>calcula las estadísticas</strong> y muestra los resultados.</li>
</ol>
<p>Los mensajes son inmutables, los actores <strong>secundarios sólo escriben</strong> en la clave asignada y <strong>el principal sólo lee</strong> las claves que ha asignado.</p>
<h3>Resultado de los test de robustez y modificación del código</h3>
<p>Al lanzar los test de robustez comprobé que en estos casos extremos de concurrencia la librería podía devolver la lectura de datos corruptos.</p>
<p>Hice una pequeña modificación en el código. Ahora siempre que se almacena un valor de una clave se escribe en un <strong>archivo temporal</strong>. Si la escritura es correcta, el fichero temporal se renombrará al definitivo utilizando la función <em>rename</em> de PHP. Esta función, es atómica si se realiza en el mismo sistema de ficheros. Este es el caso ya que se trabaja en el mismo directorio.</p>
<p>Volviendo a lanzar los test con este cambio ya no se obtienen datos corruptos y tanto la lectura se ejecutan sin errores.</p>
<p>Después de hacer un &#8216;<em>fork</em>&#8216; del repositorio y propuse los cambios lanzado un &#8216;<em>pull request</em>&#8216;. Esta petición ha sido aceptada y los esta modificación está ya en el repositorio oficial de <a title="[php-cache en GitHub]" href="https://github.com/ecoal95/php-cache/" target="_blank" rel="noopener">php-cache en GitHub</a></p>
<h2>Pruebas de rendimiento. Mini benchmark</h2>
<p><strong>php-cache</strong> es una librería basada en lectura/escritura de ficheros, así que su velocidad depende de lo rápido que sea el acceso a disco y su velocidad de lectura.</p>
<p>En el repositorio de GitHub he subido un pequeño script (<strong><a title="[benchmark.test.php] " href="https://github.com/ecoal95/php-cache/blob/master/test/benchmark.test.php" target="_blank" rel="noopener">benchmark.test.php</a></strong>) que permite realizar medidas del acceso a un valor de la cache y cual sería el tiempo medio por respuesta.</p>
<p>Además como referencia se calcula el valor medio que se tarda en recuperar el objeto de su representación en cadena cuando sus datos están en memoria sin acceder a disco. Es decir, el valor teórico ideal que se alcanzaría si el coste de tiempo de acceso a disco fuera cero.</p>
<p>La información que devuelve el test es tanto el <em>coste real</em> como el <em>teórico</em>, <em>número de peticiones realizadas</em>, <em>tiempo total</em> y las estadísticas con datos sobre la <em>media de milisegundos</em> que ha tardado en hacer <em>una petición</em> y el cálculo de las<em> peticiones por segundo</em>.</p>
<h3>&#8230; Dibujando y sacando conclusiones</h3>
<p>Las conclusiones se pueden pueden ver de las siguientes gráficas:</p>

		<style type='text/css'>
			#gallery-1 {
				margin: auto;
			}
			#gallery-1 .gallery-item {
				float: left;
				margin-top: 10px;
				text-align: center;
				width: 50%;
			}
			#gallery-1 img {
				border: 2px solid #cfcfcf;
			}
			#gallery-1 .gallery-caption {
				margin-left: 0;
			}
			/* see gallery_shortcode() in wp-includes/media.php */
		</style>
		<div id='gallery-1' class='gallery galleryid-803 gallery-columns-2 gallery-size-medium'><dl class='gallery-item'>
			<dt class='gallery-icon landscape'>
				<a href='/wp-content/uploads/2015/01/grafica_1_1.png'><img width="300" height="202" src="/wp-content/uploads/2015/01/grafica_1_1-300x202.png" class="attachment-medium size-medium" alt="Peticiones/seg real vrs teórico" aria-describedby="gallery-1-823" srcset="/wp-content/uploads/2015/01/grafica_1_1-300x202.png 300w, /wp-content/uploads/2015/01/grafica_1_1.png 427w" sizes="(max-width: 300px) 100vw, 300px" /></a>
			</dt>
				<dd class='wp-caption-text gallery-caption' id='gallery-1-823'>
				Gráfica 1: Peticiones/segComparando los valores real y teoríco
				</dd></dl><dl class='gallery-item'>
			<dt class='gallery-icon landscape'>
				<a href='/wp-content/uploads/2015/01/grafica_1_2.png'><img width="300" height="191" src="/wp-content/uploads/2015/01/grafica_1_2-300x191.png" class="attachment-medium size-medium" alt="" aria-describedby="gallery-1-841" srcset="/wp-content/uploads/2015/01/grafica_1_2-300x191.png 300w, /wp-content/uploads/2015/01/grafica_1_2.png 452w" sizes="(max-width: 300px) 100vw, 300px" /></a>
			</dt>
				<dd class='wp-caption-text gallery-caption' id='gallery-1-841'>
				Gráfica 2: Velocidades comparadas tamaño del objeto cacheado
				</dd></dl><br style="clear: both" />
		</div>

<p>En la primera (<strong><em>Gráfica 1</em></strong>) se muestra la información de los datos de las peticiones por segundo de los dos procesos, el real y el teórico. Si se observa con atención, para objetos de poco peso el  valor del  número de peticiones es  muy dispar entre las dos gráficas. Sin embargo, según va aumentando el peso del objeto guardado en cache, los dos valores se acercan hasta que casi el valor real es igual al ideal … Pero «<em> ¿por qué puede pasar esto?</em>»</p>
<p>Para poder poner un poco de luz en el asunto he creado la <strong><em>Gráfica 2</em></strong>. Se muestra la velocidad en <em>MB por segundo</em> en obtener el objeto. Una de las líneas es la <em>velocidad de las peticiones reales</em>, otra es como sería el <em>calculo ideal</em> y la línea amarilla es la velocidad que tarda en <em>leer de fichero</em>, es decir el tamaño del objeto dividido por la diferencia de los dos tiempos (real menos teórico).</p>
<p>Se puede observar, que mientras las velocidades de los procesos teórico y real tienden a ser constantes, la velocidad de lectura crece. En proporción, cuanto más grande es el objeto menos tarda en leerlo.</p>
<p>Con los objetos más grandes, al ser el proceso de lectura mucho más rápido que el proceso de «<em>des-serialización</em>«, el peso del primero pasa a ser despreciable en comparación con el segundo. Es la <strong>velocidad del proceso más lento</strong> (la «<em>des-serialización</em>«) la que marca la velocidad al obtener un valor de la cache.</p>
<p>La librería <strong>php-cache</strong> también tiene la posibilidad de guardar los datos en «<em>crudo</em>» sin serializar para almacenar cadenas, por ejemplo, para cachear la salida <em>html</em> directamente. Las siguientes gráficas (<em><strong>Gráficas</strong> <strong>3</strong></em> y <em><strong>4</strong></em>) son los datos obteniendo un valor de la cache en «<em>crudo</em>«. Muestran mejor a la conclusión que quiero llegar.</p>

		<style type='text/css'>
			#gallery-2 {
				margin: auto;
			}
			#gallery-2 .gallery-item {
				float: left;
				margin-top: 10px;
				text-align: center;
				width: 50%;
			}
			#gallery-2 img {
				border: 2px solid #cfcfcf;
			}
			#gallery-2 .gallery-caption {
				margin-left: 0;
			}
			/* see gallery_shortcode() in wp-includes/media.php */
		</style>
		<div id='gallery-2' class='gallery galleryid-803 gallery-columns-2 gallery-size-medium'><dl class='gallery-item'>
			<dt class='gallery-icon landscape'>
				<a href='/wp-content/uploads/2015/01/grafica_2_1.png'><img width="300" height="192" src="/wp-content/uploads/2015/01/grafica_2_1-300x192.png" class="attachment-medium size-medium" alt="" aria-describedby="gallery-2-829" srcset="/wp-content/uploads/2015/01/grafica_2_1-300x192.png 300w, /wp-content/uploads/2015/01/grafica_2_1.png 446w" sizes="(max-width: 300px) 100vw, 300px" /></a>
			</dt>
				<dd class='wp-caption-text gallery-caption' id='gallery-2-829'>
				Figura 3: Peticiones por segundo, objeto en crudo
				</dd></dl><dl class='gallery-item'>
			<dt class='gallery-icon landscape'>
				<a href='/wp-content/uploads/2015/01/grafica_2_2.png'><img width="300" height="193" src="/wp-content/uploads/2015/01/grafica_2_2-300x193.png" class="attachment-medium size-medium" alt="" aria-describedby="gallery-2-832" srcset="/wp-content/uploads/2015/01/grafica_2_2-300x193.png 300w, /wp-content/uploads/2015/01/grafica_2_2.png 444w" sizes="(max-width: 300px) 100vw, 300px" /></a>
			</dt>
				<dd class='wp-caption-text gallery-caption' id='gallery-2-832'>
				Figura 4: Velocidad, objeto en crudo
				</dd></dl><br style="clear: both" />
		</div>

<p>En este caso la velocidad de lectura aumenta según lo hace el tamaño del objeto a leer y tiende a un máximo.</p>
<p>Y vuelvo a repetir «<em>¿Por qué pasa esto?</em>» Sorprendente, &#8230;o no tanto.  La respuesta es que el<strong> sistema operativo</strong> viene al rescate y entra en acción el <strong>buffer cache </strong>del disco <em>(<a href="#referencias">3</a>)</em>.</p>
<p>El acceso a disco es mucho más lento que el acceso a memoria. El buffer cache del disco del sistema operativo sirve de colchón amortiguador de esta diferencia de velocidades de acceso. Mantiene en memoria (cache, &#8230;su cache) aquellos datos que leen la misma parte del disco varias veces durante periodos relativamente cortos de tiempo. Con respecto a este punto también he hecho pruebas realizando un <em>sleep</em> de dos segundos entre peticiones y la velocidad era la misma por lo que el los datos se conservaban en el buffer.</p>
<p>Recordar que este buffer no realiza cache de archivos, pero sí de <strong>bloques</strong>. Cuantos más bloques del fichero están en cache más rápido será la lectura y también añadir que el buffer de lectura de disco es transparente y lo gestiona el sistema operativo.</p>
<p><strong>Resumiendo</strong>, cuanto mayor sea el tamaño del objeto a cachear y mayor sea el número de lecturas, <strong>php-cache</strong> pasa de ser un sistema cache <strong>basado en disco</strong>, «<em>a priori</em>» <strong>lento</strong>, para convertirse de «<em>facto</em>» en un sistema de cache basado en <strong>memoria</strong> y pasar a ser <strong>rápido</strong>. Y recordemos que estas circunstancias, objetos grandes y costosos de calcular con cierta carga de lectura, son precisamente una de las razones por las que se valora adoptar un sistema de cache.</p>
<h2>Conclusiones</h2>
<p>Siempre que se evite la optimización prematura evitando complicar innecesariamente el software  (optimizar es un vicio, cuando se empieza no se sabe como parar), las pruebas de <strong>robustez</strong> y de <strong>rendimiento</strong> pueden ser unas <strong>herramientas</strong> muy útiles.</p>
<p>Permiten valorar como se comportará el producto que estás desarrollando o como lo hará el que estás pensando en adoptar&#8230; Sabemos que en muy pocas ocasiones los errores que surgen en un entorno de producción son reproducibles,  pero que duda cabe que estas pruebas dan un plus de confianza en el software desarrollado. Y puede, como en este caso concreto, que te lleves una sorpresa para bien y se comporte mucho mejor de lo que en un principio podías esperar.</p>
<p>Otra conclusión, <strong>siempre que se mide se debe dibujar</strong>. Es importante reflejar los datos en un gráfico. Esto ayuda a vislumbrar una tendencia en los datos y obtener respuestas.</p>
<p>Y por último romper una lanza en favor de <strong>PHP</strong>. En algún sitio he leído que si «<em>PHP fuera un arma se podía comparar con la manguera que pones al escape del coche para intentar suicidarte</em>«&#8230;</p>
<p>No pienso así, PHP es un lenguaje al que tengo especial cariño y su simplicidad y potencia está demostrada con esta clase <strong>php-cache</strong>. Con unas pocas líneas tienes un sistema de cache muy competente y fiable que puedes usar sin problemas en proyectos sencillos y en el que puedes almacenar un montón de valores en la cache&#8230; tantos como espacio tengas en el disco duro.</p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
<p><a name="referencias"></a></p>
<h3><em>Referencias</em></h3>
<ol>
<li><em> [<a href="http://highscalability.com/blog/2014/12/31/linus-the-whole-parallel-computing-is-the-future-is-a-bunch.html" target="_blank" rel="noopener">Linus: The whole «parallel computing is the future» is a bunch of crock</a>] (highscalability.com) </em></li>
<li><em>[<a title="[TwoHardThings]" href="http://martinfowler.com/bliki/TwoHardThings.html" target="_blank" rel="noopener">TwoHardThings</a>] (martinfowler.com)</em></li>
<li><em>[<a href="http://www.tldp.org/pub/Linux/docs/ldp-archived/system-admin-guide/translations/es/html/ch07s06.html" target="_blank" rel="noopener">El Buffer Cache</a>] (tldp.org)</em></li>
</ol>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/php/" rel="category tag">PHP</a>, <a href="/category/sistemas-operativos/" rel="category tag">Sistemas operativos</a> y está etiquetada con <a href="/tag/cache/" rel="tag">cache</a>, <a href="/tag/linux/" rel="tag">linux</a>, <a href="/tag/php/" rel="tag">PHP</a>, <a href="/tag/rendimiento/" rel="tag">rendimiento</a>, <a href="/tag/robustez/" rel="tag">robustez</a> en <a href="/pruebas-de-robustez-y-rendimiento-sobre-cache-y-simple-cache-en-php-y-mas/" title="00:54" rel="bookmark"><time class="entry-date" datetime="2015-01-28T00:54:19+00:00">28 enero, 2015</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-739" class="post-739 post type-post status-publish format-standard hentry category-java category-javascript tag-api tag-java tag-javascript tag-junit tag-maven tag-mock tag-rest tag-spring tag-test">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/mocks-o-el-tdd-y-yo/" rel="bookmark">Mocks&#8230; o el TDD y yo</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<blockquote>
<h1 style="text-align: right;"><em>&#8230; segunda Parte de TDD is dead? … o yo y el TDD</em></h1>
</blockquote>
<p><img src="/wp-content/uploads/2014/10/mockAndTest_p.png" alt="[Mock y test]" width="300" height="294" class="alignright size-full wp-image-780" /><strong>E</strong>ste es el segundo y último artículo de la serie que completa el anterior post <a title="TDD is dead? … o yo y el TDD. Primera Parte" href="/tdd-is-dead-o-yo-y-el-tdd-primera-parte/"><strong>TDD is dead? … o yo y el TDD</strong></a>.</p>
<p>Trataré de explicar como defino y codifico mis propios objetos &#8216;<em>mock</em>&#8216;, y de como los uso tanto para pruebas unitarias, como también en pruebas de integración entre clases.</p>
<p>Y siendo más especifico mostrar como se pueden codificar tres tipos de mock utilizados habitualmente:</p>
<ul>
<li> Simular la <strong>capa de persistencia</strong> a base de datos.</li>
<li> El que se utiliza para <strong>comprobar</strong> que se ha llamado a la <strong>interfaz</strong> que representa desde el objeto que nos interesa probar.</li>
<li>El utilizado simplemente para poder pasar las pruebas y que no nos interesa su comportamiento.</li>
</ul>
<p>Y como dijo el maestro:</p>
<blockquote>
<h1>“&#8230; hablar es barato, vamos a ver un poco de código&#8230;”</h1>
</blockquote>
<h2>Demo</h2>
<p>Para ilustrar el ejemplo utilizaré una aplicación web que mediante un <strong>formulario html</strong> sencillo llamará con <strong>ajax</strong> a un servicio <strong>REST</strong>. Consiste en dar de alta códigos de promoción de una web.</p>
<p><div id="attachment_776" style="width: 460px" class="wp-caption aligncenter"><img src="/wp-content/uploads/2014/10/pantallazoEjemploMock.png" alt="[Pantallazo de la Demo Ejemplo Mock]" width="450" height="251" class="size-full wp-image-776" srcset="/wp-content/uploads/2014/10/pantallazoEjemploMock.png 450w, /wp-content/uploads/2014/10/pantallazoEjemploMock-300x167.png 300w" sizes="(max-width: 450px) 100vw, 450px" /><p class="wp-caption-text">[Pantallado de la demo]</p></div>Los datos que se piden son la promoción, el nombre, el correo electrónico y el código de promoción. Se validará que el correo electrónico no esté ya utilizado y si todo es correcto se enviará el correo a la persona y se mostrarán los datos de los códigos ya dados de alta. </p>
<p>La demo es completamente operativa y se puede usar. Se puede descargar el código aquí:</p>
<p style="text-align: center;"><a title="[MoksExample en GitHub]" href="https://github.com/logicaalternativa/MoksExample" target="_blank"><img class="alignnone wp-image-432 size-full" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /><strong>MoksExample</strong></a> en GitHub</p>
<p style="text-align: left;">Los detalles de como funciona y como se puede probar están en el archivo <a title="[Detalles de la DEMO en el README.md]" href="https://github.com/logicaalternativa/MoksExample/blob/master/README.md" target="_blank"><strong>README.md</strong></a></p>
<p style="text-align: left;">La parte de servicios REST es Java, montada sobre <strong>Spring</strong>. En el ecosistema de Spring, <strong>Spring-Data</strong> es el mediador con la capa de persistencia de datos. En el ejemplo se usará como interfaz con la base de datos. Como framework de tests unitarios usaré <strong>Junit</strong>. <strong>Maven</strong> será la herramienta de compilación, ejecución de test y construcción del proyecto. Como es una demo para estos fines se usa <strong>Hsqldb</strong>, base de datos en memoria.</p>
<h2>Simular la capa de persistencia de BBDD</h2>
<p style="text-align: left;">En la demo existen dos entidades <em>PROMOTION</em> y <em>PROMOTION_CODE</em>. La primera es el maestro de promociones y en la segunda se almacenarán todos los códigos de promoción relacionados con las primeras. Los objetos de negocio que las definen son los beans: <a title="[Promtion.java]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/model/Promotion.java" target="_blank"><strong>Promotion</strong></a> y <a title="[PromotionCode.java]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/model/PromotionCode.java" target="_blank"><strong>PromotionCode</strong></a></p>
<p style="text-align: left;"><strong>Spring-Data</strong> se basa en el patrón repositorio. A grandes rasgos y simplificando, Spring-Data implementa la interfaz de las operaciones <em>CRUD</em> y el resto de consultas que se pueden realizar para cada entidad de la capa de persistencia (usualmente una tabla de una base de datos).</p>
<p>Existen por tanto dos interfaces definidos en el pakage <a title="[com.logicaalternativa.ejemplomock.repository] " href="https://github.com/logicaalternativa/MoksExample/tree/master/src/main/java/com/logicaalternativa/ejemplomock/repository" target="_blank"><strong>com.logicaalternativa.ejemplomock.repository</strong></a> cuya misión es definir las operaciones <em>CRUD</em> de las entidades</p>
<ul>
<li><a title="[PromotionRepository.java]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/repository/PromotionRepository.java" target="_blank"><strong>PromotionRepository</strong></a> definido para la entidad  <em>PROMOTION</em></li>
<li><a title="[PromotionCodeRepository]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/repository/PromotionCodeRepository.java" target="_blank"><strong>PromotionCodeRepository</strong></a> definido para la entidad  <em>PROMOTION_CODE</em></li>
</ul>
<p>En este caso los dos extienden del interfaz de Spring-Data <strong>JpaRepository</strong>.</p>
<p>Con Spring-Data sólo tienes que definir la interfaz con las diferentes operaciones de consulta, inserción y modificación que se van a realizar de la entidad y este se encarga de implementar la interfaz. Esto hace que resulte muy fácil codificar tus propios <em><strong>mocks</strong></em>. Después para los test se inyectarán por inversión de control al objeto de negocio.</p>
<p>Para los test he implementado los dos <em>mock</em> de cada uno de los interfaces. Están en el package <a title="[com.logicaalternativa.ejemplomock.repository.mock]" href="https://github.com/logicaalternativa/MoksExample/tree/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock" target="_blank"><strong>com.logicaalternativa.ejemplomock.repository.mock</strong></a> .</p>
<ul>
<li><a title="[PromotionRepositoryMock]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock/PromotionRepositoryMock.java" target="_blank"><strong>PromotionRepositoryMock</strong></a></li>
<li><a title="[PromotionCodeRepositoryMock]" href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock/PromotionCodeRepositoryMock.java" target="_blank"><strong>PromotionCodeRepositoryMock</strong></a></li>
</ul>
<p>Las dos clases son muy similares y siguen la misma línea. Sólo se ha implementado las operaciones necesarias para realizar los test. La idea es esa <strong>codificar sólo lo estrictamente necesario</strong>. Se añadirá o se modificará código cuando toque, si para un futuro test es necesario implementar algún otro método más.</p>
<p>Centrándome por ejemplo en el mock <strong>PromotionCodeRepositoryMock</strong>, el &#8216;<em>quid de la cuestión</em>&#8216; está en que he definido un atributo lista de tipo <strong>PromotionCode</strong>.<br />
<!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">   <span style="color: #000000; font-weight: bold;">private</span> List<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span> promotionCode<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Este es accesible mediante los métodos públicos:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">   <span style="color: #000000; font-weight: bold;">public</span> List<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span> getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline">   <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setPromotionCode<span style="color: #009900;">&#40;</span>PromotionCode...<span style="color: #006633;">promotionCode</span><span style="color: #009900;">&#41;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">6</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">7</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>He codificado los métodos <em>CRUD</em> para que operen con esta lista. Por ejemplo, así he codificado el método que sirve para obtener un código de promoción a través de su clave primaria.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> PromotionCode findOne<span style="color: #009900;">&#40;</span> <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> email <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>		</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000066; font-weight: bold;">int</span> index <span style="color: #339933;">=</span> findIndex<span style="color: #009900;">&#40;</span> email <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> index <span style="color: #339933;">!=</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      <span style="color: #000000; font-weight: bold;">return</span> clone<span style="color: #009900;">&#40;</span> getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span> index <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span>	</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Que lo que hace es encontrar el índice de la lista de códigos de promoción con el mismo email. Si lo encuentra devuelve una copia de ese objeto. Para entrar más en detalle te invito a revisar los métodos <em><strong>findIndex</strong></em>, <em><strong>clone</strong></em> y el resto de métodos que he implementado de <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/repository/mock/PromotionCodeRepositoryMock.java" title="[PromotionCodeRepositoryMock]"  target="_blank"><strong>PromotionCodeRepositoryMock</strong></a></p>
<p>Otro ejemplo es el método <em><strong>saveAndFlush</strong></em>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> PromotionCodeRepositoryMock <span style="color: #000000; font-weight: bold;">implements</span> PromotionCodeRepository <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #339933;">&lt;</span>S <span style="color: #000000; font-weight: bold;">extends</span> PromotionCode<span style="color: #339933;">&gt;</span> S saveAndFlush<span style="color: #009900;">&#40;</span>S promotionCode <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">     <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">promotionCode</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> ArrayList<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">     getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">     <span style="color: #000000; font-weight: bold;">return</span> promotionCode <span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> email <span style="color: #339933;">=</span> promotionCode <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">?</span> promotionCode.<span style="color: #006633;">getEmail</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000066; font-weight: bold;">int</span> index <span style="color: #339933;">=</span> findIndex<span style="color: #009900;">&#40;</span> email <span style="color: #009900;">&#41;</span> <span style="color: #339933;">;</span> </pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #009900;">&#40;</span> index <span style="color: #339933;">==</span> <span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">     getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">add</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">else</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">     getPromotionCode<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>.<span style="color: #006633;">set</span><span style="color: #009900;">&#40;</span> index, promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> promotionCode<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">19</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Que busca en la lista el objeto con el mismo email. Si lo encuentra actualiza el objeto de la lista y sino, lo añade a la lista.</p>
<h3>¿Cómo se usa?</h3>
<p>El test <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/bussiness/AddCodeBusinessImpTest.java" title="[AddCodeBusinessImpTest]"  target="_blank"><strong>AddCodeBusinessImpTest</strong></a> prueba el objeto de negocio <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/bussiness/AddCodeBusinessImp.java" title="[AddCodeBusinessImp]" target="_blank"><strong>AddCodeBusinessImp</strong></a>.</p>
<p>La clase de negocio (<strong>AddCodeBusinessImp</strong>) comprueba que existe el código de promoción en la BBDD y utiliza para ello <strong>PromotionRepository</strong>. En el método <em><strong>setUp()</strong></em> del test se inicializa un objeto <strong>PromotionRepositoryMock</strong> con el objeto <strong>Promotion</strong> deseado y este mock se inserta por inversión de control a la instancia de <strong>AddCodeBussinessImp</strong>.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> AddCodeBusinessImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> AddCodeBusinessImp addCodeBusinessImp<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> PromotionRepositoryMock promotionRepositoryMock<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> PromotionCodeRepositoryMock promotionCodeRepositoryMock<span style="color: #339933;">;</span>	</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> Promotion promotion<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Before</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    promotion <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Promotion<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    promotion.<span style="color: #006633;">setIdPromotion</span><span style="color: #009900;">&#40;</span> <span style="color: #cc66cc;">1</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...    </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">promotionRepositoryMock</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> PromotionRepositoryMock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    promotionRepositoryMock.<span style="color: #006633;">setPromotions</span><span style="color: #009900;">&#40;</span> promotion <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    ...  </pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #006633;">addCodeBusinessImp</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> AddCodeBusinessImp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    addCodeBusinessImp.<span style="color: #006633;">setPromotionRepository</span><span style="color: #009900;">&#40;</span> promotionRepositoryMock <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">19</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">20</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">21</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">22</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p><em>promotion</em>, <em>promotionRepositoryMock</em>, <em>addCodeBusinessImp</em> son atributos privados de <strong>AddCodeBusinessImpTest</strong>.</p>
<p>Internamente AddCodeBusinessImp llama al método <em>findOne</em> de PromotionRepository con el identificador de la promoción (el del maestro de promociones) del nuevo código que se quiere insertar.</p>
<p>Si queremos testear que ocurre si no encuentra la promoción en la BBDD, simplemente se hace lo que en el método <em><strong>testPromotionNotBbDd</strong></em> de <strong>AddCodeBusinessImpTest</strong>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> AddCodeBusinessImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Test</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testPromotionNotBbDd<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      promotionRepositoryMock.<span style="color: #006633;">setPromotions</span><span style="color: #009900;">&#40;</span> <span style="color: #009900;">&#40;</span> Promotion<span style="color: #009900;">&#091;</span><span style="color: #009900;">&#093;</span> <span style="color: #009900;">&#41;</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      addCodeBusinessImp.<span style="color: #006633;">validateAndAdd</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      ...</pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Si la lista de promociones en <strong>PromotionRepositoryMock</strong> es nula no se podrá encontrar la promoción (El método <em>findOne</em> devolverá nulo).</p>
<p>En este mismo test también se utiliza <strong>PromotionCodeRepositoryMock</strong>. Inyectado también por inversión de control a la instancia de <strong>AddCodeBusinessImp</strong>, en este caso, sirve para comprobar que se ha insertado el código de promoción. Se hace en el test <em><strong>testOk</strong></em></p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> AddCodeBusinessImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Test</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testOk<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      addCodeBusinessImp.<span style="color: #006633;">validateAndAdd</span><span style="color: #009900;">&#40;</span> promotionCode <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      <span style="color: #000000; font-weight: bold;">final</span> List<span style="color: #339933;">&lt;</span>PromotionCode<span style="color: #339933;">&gt;</span> promotionCodeBbDCodes <span style="color: #339933;">=</span> promotionCodeRepositoryMock.<span style="color: #006633;">getPromotionCode</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      <span style="color: #000066; font-weight: bold;">boolean</span> result <span style="color: #339933;">=</span> promotionCodeBbDCodes <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">                <span style="color: #339933;">&amp;&amp;</span> promotionCodeBbDCodes.<span style="color: #006633;">size</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">==</span> <span style="color: #cc66cc;">1</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">                <span style="color: #339933;">&amp;&amp;</span> promotionCode.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span> promotionCodeBbDCodes.<span style="color: #006633;">get</span><span style="color: #009900;">&#40;</span> <span style="color: #cc66cc;">0</span> <span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">               <span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      ...</pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Para tener una visión más clara de cual es la idea, lo mejor es revisar cada uno de los test <strong>Junit</strong> de <strong><a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/bussiness/AddCodeBusinessImpTest.java" title="[AddCodeBusinessImpTest]" target="_blank">AddCodeBusinessImpTest</a></strong> Creo que puede ser de gran ayuda para tener una visión global de lo que quiero plantear . He intentado que sean claros y autoexplicativos.</p>
<h2>Mock de comprobación de llamada  a interfaz y datos correctos.</h2>
<p>Lo que interesa en este caso es comprobar que un objeto de negocio  hace la llamada a un interfaz con los datos correctos. Lo que se hace es &#8216;<em>mockear</em>&#8216; esa interfaz capturando los datos de la llamada para comprobar después de que estos son correctos.</p>
<p>En la demo existe un objeto de negocio, <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[SendMailCodePromotionImp]" target="_blank"><strong>SendMailCodePromotionImp</strong></a>, que a partir de una dirección de correo manda el código de promoción por email. Este objeto de negocio realiza internamente una llamada a la interfaz <strong>JavaMailSender</strong> que implementa Spring (<strong>JavaMailSenderImpl</strong>) para enviar el correo electrónico.</p>
<p><a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[JavaMailServerMock]" target="_blank"><strong>JavaMailServerMock</strong></a>, que implementa también el interfaz <strong>JavaMailServer</strong>, es el <em>mock</em> que va a recoger los datos de la llamada. En este caso sólo me interesaba saber la dirección de correo a la que se envía el correo electrónico. Para ello he implementado el método <em><strong>send</strong></em>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> JavaMailServerMock <span style="color: #000000; font-weight: bold;">implements</span> JavaMailSender <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> <span style="color: #003399;">String</span> sendTo<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Override</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> send<span style="color: #009900;">&#40;</span> MimeMessage mimeMessage <span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> MailException <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #003399;">String</span><span style="color: #009900;">&#091;</span><span style="color: #009900;">&#093;</span> to <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      to <span style="color: #339933;">=</span> mimeMessage.<span style="color: #006633;">getHeader</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;To&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span> <span style="color: #000000; font-weight: bold;">catch</span> <span style="color: #009900;">&#40;</span>MessagingException e<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      logger.<span style="color: #006633;">error</span><span style="color: #009900;">&#40;</span> <span style="color: #0000ff;">&quot;[send] &quot;</span>.<span style="color: #006633;">concat</span><span style="color: #009900;">&#40;</span> e.<span style="color: #006633;">getMessage</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#41;</span>, e <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      to <span style="color: #339933;">=</span> <span style="color: #000066; font-weight: bold;">null</span><span style="color: #339933;">;</span>      </pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    setSendTo<span style="color: #009900;">&#40;</span> to <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #339933;">&amp;&amp;</span> to.<span style="color: #006633;">length</span> <span style="color: #339933;">&gt;</span> <span style="color: #cc66cc;">0</span> <span style="color: #339933;">?</span> to<span style="color: #009900;">&#091;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#093;</span> <span style="color: #339933;">:</span> <span style="color: #000066; font-weight: bold;">null</span> <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> getSendTo<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> sendTo<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">19</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">20</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setSendTo<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> sendTo<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">21</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">this</span>.<span style="color: #006633;">sendTo</span> <span style="color: #339933;">=</span> sendTo<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">22</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">23</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Se recoge del argumento de entrada la cabecera “<em>To</em>” para almacenarla en un atributo de la clase.</p>
<h3>¿Cómo se usa?</h3>
<p>En el test <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImpTest.java" title="[SendMailCodePromotionImpTest]" target="_blank"><strong>SendMailCodePromotionImpTest</strong></a> se utiliza este Mock. En el método <em><strong>setUp()</strong></em>, se instancia y se inserta por inversión de control al objeto <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[SendMailCodePromotionImp]" target="_blank"><strong>SendMailCodePromotionImp</strong></a>.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SendMailCodePromotionImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> SendMailCodePromotionImp sendMailCodePromotionImp<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> JavaMailServerMock javaMailServerMock<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Before</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">javaMailServerMock</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> JavaMailServerMock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...    </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">sendMailCodePromotionImp</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SendMailCodePromotionImp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">sendMailCodePromotionImp</span>.<span style="color: #006633;">setJavaMailSender</span><span style="color: #009900;">&#40;</span> javaMailServerMock <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">17</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">18</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>El test <em><strong>testOk</strong></em> de <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImpTest.java" title="[SendMailCodePromotionImpTest]" target="_blank"><strong>SendMailCodePromotionImpTest</strong></a> sirve como ejemplo para comprobar si se ha realizado correctamente la llamada:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SendMailCodePromotionImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> testOk<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">try</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      sendMailCodePromotionImp.<span style="color: #006633;">sendMailCodePromotion</span><span style="color: #009900;">&#40;</span> email, locale <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">      <span style="color: #000000; font-weight: bold;">final</span> <span style="color: #003399;">String</span> sendTo <span style="color: #339933;">=</span> javaMailServerMock.<span style="color: #006633;">getSendTo</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">      <span style="color: #000066; font-weight: bold;">boolean</span> res <span style="color: #339933;">=</span> sendTo <span style="color: #339933;">!=</span> <span style="color: #000066; font-weight: bold;">null</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">              <span style="color: #339933;">&amp;&amp;</span> sendTo.<span style="color: #006633;">equals</span><span style="color: #009900;">&#40;</span> nameUser.<span style="color: #006633;">toUpperCase</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> <span style="color: #0000ff;">&quot; &lt;&quot;</span> <span style="color: #339933;">+</span> email <span style="color: #339933;">+</span><span style="color: #0000ff;">&quot;&gt;&quot;</span>  <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Donde después de hacer la llamada al método  <em><strong>sendMailCodePromotion</strong></em> del objeto de negocio se obtiene el atributo de <em><strong>sendTo</strong></em> del <em>mock</em> para comprobar que se envía a la misma dirección de correo electrónico.</p>
<p>En este mock sólo se comprueba la cabecera &#8216;<em>To</em>&#8216;. También se podría comprobar el texto del mensaje o cualquier otro dato enviado desde el objeto de negocio.</p>
<h2>Mock para pasar las pruebas</h2>
<p>En la demo he codificado <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/org/springframework/context/mock/MessageSourceMock.java" title="[MessageSourceMock]" target="_blank"><strong>MessageSourceMock</strong></a> que implementa el interfaz <strong>MessageSource</strong>, utilidad que tiene Spring para la internacionalización. Este mock sólo me interesa para poder probar otras funcionalidades. Ha sido necesario codificado porque el objeto de negocio lo necesitaba, pero, en este caso, el resultado de su llamada era irrelevante. Solamente se ha codificado el método <em><strong>getMessage</strong></em> :</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> MessageSourceMock <span style="color: #000000; font-weight: bold;">implements</span> MessageSource <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  @Test</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #003399;">String</span> getMessage<span style="color: #009900;">&#40;</span><span style="color: #003399;">String</span> arg0, <span style="color: #003399;">Object</span><span style="color: #009900;">&#091;</span><span style="color: #009900;">&#093;</span> arg1, <span style="color: #003399;">Locale</span> arg2<span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> NoSuchMessageException <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #000000; font-weight: bold;">return</span> arg0<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">6</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">7</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">8</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Que como puedes comprobar, devuelve directamente la entrada.</p>
<h3>¿Cómo se usa?</h3>
<p>En el test <a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/test/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImpTest.java" title="[SendMailCodePromotionImpTest]" target="_blank"><strong>SendMailCodePromotionImpTest</strong></a> se utiliza este Mock. En el método <em><strong>setUp()</strong></em>Se instancia y se inserta por inversión de control al objeto<br />
<a href="https://github.com/logicaalternativa/MoksExample/blob/master/src/main/java/com/logicaalternativa/ejemplomock/rest/sender/SendMailCodePromotionImp.java" title="[SendMailCodePromotionImp]" target="_blank"><strong>SendMailCodePromotionImp</strong></a>.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">class</span> SendMailCodePromotionImpTest <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> SendMailCodePromotionImp sendMailCodePromotionImp<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">private</span> MessageSourceMock messageSourceMock<span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    @Before</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000066; font-weight: bold;">void</span> setUp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #000000; font-weight: bold;">throws</span> <span style="color: #003399;">Exception</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    <span style="color: #006633;">messageSourceMock</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MessageSourceMock<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    sendMailCodePromotionImp <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> SendMailCodePromotionImp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">12</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">    ...</pre></td></tr><tr><td class="devcodelines" width="3%">13</td><td class="devcodelinesarea"><pre class="devcode devcodeline">    <span style="color: #006633;">sendMailCodePromotionImp</span>.<span style="color: #006633;">setMessageSource</span><span style="color: #009900;">&#40;</span> messageSourceMock <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">14</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">15</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  ...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">16</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Ya ahora al hacer la llamada <em><strong>getSendTo</strong></em> del objeto de negocio no aparece la tan temida <strong>NullPointerException</strong> 😉</p>
<h2>Conclusiones</h2>
<p>Como se puede ver, con un poco de ingenio es <strong>relativamente sencillo </strong>crearte tus propios objetos mock sin tener que recurrir a Frameworks. La creación de los mock me ayudan a comprender mejor como funciona la aplicación y ver las clases involucradas como verdaderas cajas negras. Esta es la gracia del paradigma de la orientación a objetos.</p>
<p>No necesariamente tiene que llevar demasiado tiempo el codificarlos. Sólo se debería <strong>&#8216;picar&#8217; lo que necesitas cuando lo necesitas</strong> y mucho es reaprobechable. Al final del proyecto seguro que tienes un buen juego de objetos <em>mock</em> para pruebas.</p>
<p>Otra ventaja, es que no hay reflexión, no existe bbdd en memoria para los test, ni ha sido necesario levantar un entorno para pruebas&#8230; el resultado es que los test van &#8216;<em>volaos</em>&#8216;.</p>
<p><a href="/mi-cv/" title="Mi CV" target="_blank">M.E.</a></p>
<blockquote><p><strong>P.D.</strong>: Para  esta demo, de esto que te vas liando y liando&#8230; y poco a poco me &#8216;currado&#8217; un framework MVC hecho en JavaScript. Cuando lo organice un poco será material para próximos post.</p></blockquote>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/api/" rel="tag">API</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/junit/" rel="tag">junit</a>, <a href="/tag/maven/" rel="tag">maven</a>, <a href="/tag/mock/" rel="tag">Mock</a>, <a href="/tag/rest/" rel="tag">REST</a>, <a href="/tag/spring/" rel="tag">Spring</a>, <a href="/tag/test/" rel="tag">Test</a> en <a href="/mocks-o-el-tdd-y-yo/" title="00:24" rel="bookmark"><time class="entry-date" datetime="2014-10-24T00:24:12+00:00">24 octubre, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-716" class="post-716 post type-post status-publish format-minientrada hentry category-general post_format-minientrada">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/post-en-el-blog-de-civitana-firma-digital-facil-de-usar/" rel="bookmark">Post en el blog de civitana: «Firma electrónica fácil de usar»</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p style="text-align: left;"><strong>A</strong>ntes de vacaciones escribí el siguiente artículo en el <a title="[Blog civitana]" href="%20http://blog.civitana.org" target="_blank">blog</a> de <a title="[Civitana.org ]" href="https://www.civitana.org%20/" target="_blank">Civitana.org</a></p>
<address style="text-align: center;">[<strong><a title="[Firma electrónica fácil de usar]" href="http://blog.civitana.org/2014/08/11/firma-electronica-facil-de-usar/" target="_blank">Firma electrónica fácil de usar</a>]</strong> ( <a title="[Firma electrónica fácil de usar]" href="http://blog.civitana.org/2014/08/11/firma-electronica-facil-de-usar/" target="_blank">http://blog.civitana.org/2014/08/11/firma-electronica-facil-de-usar/</a>)</address>
<p><img class="aligncenter size-full wp-image-718" src="/wp-content/uploads/2014/09/baner.png" alt="[Firma digital fácil de usar]" width="710" height="97" srcset="/wp-content/uploads/2014/09/baner.png 710w, /wp-content/uploads/2014/09/baner-300x40.png 300w, /wp-content/uploads/2014/09/baner-624x85.png 624w" sizes="(max-width: 710px) 100vw, 710px" /></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada fue publicada en <a href="/category/general/" rel="category tag">General</a> el <a href="/post-en-el-blog-de-civitana-firma-digital-facil-de-usar/" title="00:45" rel="bookmark"><time class="entry-date" datetime="2014-09-10T00:45:56+00:00">10 septiembre, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-698" class="post-698 post type-post status-publish format-standard hentry category-programacion tag-java tag-mock tag-spring tag-tdd">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/tdd-is-dead-o-yo-y-el-tdd-primera-parte/" rel="bookmark">TDD is dead? … o yo y el TDD. Primera Parte</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>“<em><strong>Test-driven development (TDD)</strong></em>”, en la lengua de Cervantes “<strong><em>Desarrollo guiado por pruebas</em></strong>”&#8230; Palabras malditas para algunos&#8230; Últimamente se dice que está muerto&#8230; “<strong><em>TDD is dead?</em></strong>”.</p>
<blockquote>
<hr />
<strong>Actualización</strong>:<br />
La segunda parte de este artículo es «<a href="/mocks-o-el-tdd-y-yo/" title="Mocks… o el TDD y yo"><strong>Mocks… o el TDD y yo</strong></a>»</p>
<hr /></blockquote>
<h2>¿Qué es?</h2>
<p>A grandes rasgos, consiste en primero diseñar y realizar los test de una determinada funcionalidad (lo usual es una clase de negocio). En este punto los test no pasan =&gt; Test &#8216;<em>en rojo</em>&#8216;.</p>
<p><img class="alignright size-full wp-image-705" src="/wp-content/uploads/2014/07/tdd.png" alt="[Esquema TDD]" width="350" height="195" srcset="/wp-content/uploads/2014/07/tdd.png 350w, /wp-content/uploads/2014/07/tdd-300x167.png 300w" sizes="(max-width: 350px) 100vw, 350px" />A continuación se codifica, centrándonos en que pasen todos los test. Una vez que todos están &#8216;ok&#8217; (Test en &#8216;<em>verde</em>&#8216;) se refactoriza el código. Se da un repaso final para que quede todo correcto y pulir los flecos que quedan.</p>
<p>Estos test serán siempre independientes. No debe importar el orden en que se lancen. Se añaden a la herramienta de integración continua para que se pasen en cada compilación/build y asegurarse así que no ha habido &#8216;efectos colaterales&#8217; en cada modificación de código fuente.</p>
<h2>«<em>TDD is dead?</em>«.. el debate.</h2>
<p>Si partimos de este enfoque ¿es todo &#8216;<em>testeable</em>&#8216;? ¿Se ve condicionado tu diseño del software poder hacer este tipo de pruebas? ¿Cuanto tardan tus test? ¿Es asumible este tiempo?</p>
<p>Todo esto y más argumentos se han puesto encima de la mesa. Hay quien opina que que en el TDD puro sólo es para entornos académicos y blogs y que en el mundo real no se puede llevar al extremo. Hay pruebas que no se pueden replicar tan fácilmente y que dependen de un entorno desplegado (terceros sistemas).</p>
<p>Tampoco es recomendable que se condicione el diseño y la arquitectura para poder realizar los test. Debe ser al contrario los test se deben adaptar al diseño.</p>
<p>El TDD se basa en pasar continuamente los test, por lo tanto deben ser lo más rápidos posible. En algunos casos el tiempo de lanzar toda la batería de test no es despreciable. En este punto los Frameworks de &#8216;<em>mock</em>&#8216; basados en generación de clases por reflexión están en el punto de mira.</p>
<p>Y a pesar de todo esto, esta forma de desarrollar me ha hecho la vida más sencilla. Lo intento explicar:</p>
<h2>Mi Kung-fu, Mi TDD</h2>
<p>He llegado a esta metodología tarde. No fue hasta que empezando con un proyecto desde cero, que me puse en serio a seguir este paradigma. Mi conversión ha sido tal, que confieso que ahora ya casi no sé prescindir de los test al enfrentarme a tirar código. Primero me planteo los tests y después implemento. Aunque esto no es siempre así, tengo bastante flexibilidad.</p>
<p>Si tengo claro &#8216;<em>lo que hay que hacer</em>&#8216; hago todos del tirón. Repaso todos los casos de uso, las posibles <strong>entradas</strong>, <strong>salidas</strong> y los <strong>errores</strong> y cada caso lo reflejo en un test.  En estos casos lo más normal es que tarde más en diseñar los test que en codificar. El proceso es, de manera iterativa, terminar una parte de la codificación e ir pasando los test, hasta que no quede ninguno con error y la funcionalidad esté terminada.</p>
<p>En los casos que no tengo tan claro lo que tiene que hacer la clase, quizás porque, por ejemplo, tenga que &#8216;repartir&#8217; la responsabilidad en otra clase, empiezo realizando los test que si tengo claro, validando entradas y resultados parciales. Codifico y logró que se pasen los test. Me replanteo o no la  estructura y vuelvo a codificar los nuevos test y terminar de implementar la parte que queda. Todo también de manera iterativa.</p>
<p>En cualquier caso siempre habrá uno o varios <strong>test con las entradas y la salida correctas</strong>. Los pongo al principio de la clase de test y me sirve de documentación. De un vistazo se puede saber el comportamiento y el control de errores realizado.</p>
<h2>Sobre los &#8216;mock&#8217;</h2>
<p>Para poder realizar los test &#8216;mokeo&#8217; las clases que necesito para probar la funcionalidad. Empecé realizando <strong>mis propios objetos Mock</strong> porque no quería que mi foco se perdiera en el aprendizaje de un nuevo Framework de &#8216;<em>mokeo</em>&#8216;.</p>
<p>En la arquitectura en la que suelo trabajar Spring y Spring-Data para acceso a base de datos, en lo que todo es un <strong>interfaz</strong>, es supersencillo crear el Mock que genere la salida que necesitas. Estos objetos son reaprovechables, ya que en un proyecto normalmente las clases están relacionadas, y utilizas el mismo Mock para varios test.</p>
<p>Esto en realidad no va en contra de &#8216;la <em>máxima</em>&#8216; de que los test no puede ser un desarrollo en sí, ya que &#8216;<em>sólo codifico la parte que necesito</em>&#8216;. Si en un segundo test necesito más funcionalidad completo el comportamiento del Mock.</p>
<p>Resulta que después, leyendo post como <strong><a title="[When to mock]" href="http://blog.8thlight.com/uncle-bob/2014/05/10/WhenToMock.html" target="_blank">este</a></strong>  («<em>When to mock</em>«) en el Blog de Uncle Bob Martin me di cuenta que no iba tan mal encaminado.</p>
<p>Estoy preparando un segundo artículo donde intentaré explicar con ejemplos como hago los &#8216;<em>mock</em>&#8216;.</p>
<h2>Qué he ganado</h2>
<p>Sobre todo una <strong>nueva visión</strong> de enfrentarme al desarrollo, para mi más enriquecedora. Ahora lo primero que pienso son los parámetros que voy a pasar a la clase y que salida quiero obtener. Valoro que entradas podrían causar error y como quiero realizar este control de errores. Esto hace que tenga una idea mucho más clara de lo que va hacer la clase y de que parte de la funcionalidad va a ser responsable.</p>
<p>Para <strong>simular la base de datos</strong> utilizo mis propios &#8216;<em>mock</em>&#8216; implementando los interfaces de Spring-Data y no uso una BBDD en memoria. Esto también me ha ayudado a entender mejor que datos necesito y tener mucho más claro el modelo.</p>
<p>He ganado en <strong>seguridad</strong>. Casi consigo que el 100% del código sea testeable. Gracias a los test estoy seguro de que se ha pasado por cada uno de los &#8216;if&#8217; del  código.</p>
<p>Es significativo que ahora uso mucho menos el &#8216;<em>debug</em>&#8216; para saber que está fallando y corregir errores. Puede resultar paradójico pero en muchos casos, con los test consigo comportamientos que es difícil de obtener para obtener el mismo resultado en una prueba de integración. Normalmente hago pocos ajustes en el código cuando lo pruebo desplegado en un servidor de aplicaciones, contra una base de datos de verdad, &#8230;</p>
<p>Tengo <strong>menos bug</strong> y <strong>más control de la interrelaciones</strong> que tiene el código. Si hay alguna modificación de uan parte del código que afecta a otra, los &#8216;test&#8217; pueden evitar muchos de estos problemas de interrelación. Problemas que suelen surgir, &#8216;como siempre pasa&#8217; (ley de Murphy), en producción.</p>
<p>Como contrapartida <strong>se tarda más</strong> en el desarrollo y el proceso de generación de los test no es &#8216;<em>tan divertido</em>&#8216; como puede parecer. De todas maneras las ventajas que he obtenido me salen a cuenta y doy el tiempo por bien invertido.</p>
<h2>Reflexiones</h2>
<p>Realmente en mis proyectos, y a pesar de integrarse con más de un sistema de terceros no he tenido muchos problemas en generar los test. No he sentido que el diseño del software se haya visto condicionado.</p>
<p>Al hilo de esto, estoy acostumbrado a trabajar con Spring y su inversión de control. Hay quienes le &#8216;chirría&#8217; tener que definir un <strong>interfaz</strong> aunque sólo haya una implementación.  A mí definirlo me parece más limpio indicando así el api pública de la clase.</p>
<p>Esto para los test viene muy bien. En muchos casos por cada interfaz existirá la <strong>implementación de la funcionalidad</strong> y otra &#8216;<em>mock</em>&#8216; para<strong> simular el comportamiento</strong> para los test de otra clase.  Insisto no lo veo como un condicionante de diseño para facilitar los test. Hubiera definido el interfaz de todas maneras incluso en el caso de que no hubiera hecho los test.  Sobre esto me parece interesante este <strong><a title="[how tdd affect my designs]" href="http://blog.thecodewhisperer.com/2014/05/22/how-tdd-affects-my-designs" target="_blank">post</a> </strong>(«<em>How tdd affect my designs</em>«)</p>
<p>El hecho de implementar mis propios &#8216;<em>mock</em>&#8216; y que estos no sean creados utilizando reflexión y sólo haya que instanciarlos, hace que la lentitud no sea un problema.</p>
<p>Así que, en la práctica, no me he encontrado muchos problemas técnico/filosóficos a la hora de utilizar el TDD. Queda pendiente la segunda parte de este artículo de ejemplos de &#8216;mock&#8217; que estoy utilizado.</p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/" rel="category tag">Programación</a> y está etiquetada con <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/mock/" rel="tag">Mock</a>, <a href="/tag/spring/" rel="tag">Spring</a>, <a href="/tag/tdd/" rel="tag">TDD</a> en <a href="/tdd-is-dead-o-yo-y-el-tdd-primera-parte/" title="00:11" rel="bookmark"><time class="entry-date" datetime="2014-07-09T00:11:34+00:00">9 julio, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-678" class="post-678 post type-post status-publish format-standard hentry category-general tag-civitana tag-firma-digital tag-nosql tag-nube">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/la-aventura-de-civitana-org/" rel="bookmark">La aventura de Civitana.org</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<blockquote>
<hr />
<p><strong>Actualización octubre del 2014:</strong></p>
<p>» Después de un verano intenso que nos ha dado tiempo a desarrollar un protocolo de voto electrónico en el que por mis tareas me he tocado definir y desarrollar en gran parte, a partir de octubre de 2014, las circunstancias  hacen que me desligue de Civitana.org, .</p>
<p>Aunque tengo una pequeñisima parte del ella desde ese momento paso de ser ‘cerdo’ a convertirme en ‘pollo’. Quizás más adelante, cuando las circunstancias cambien en un futuro se pueda retomar la relación laboral.»</p>
<p>M.E.</p>
<hr />
</blockquote>
<p>Han sido unos meses muy intensos y cuando por fin <a href="https://www.civitana.org/"><strong>Civitana.org</strong></a> está en producción siento la necesidad de escribir esta entrada. Mucho trabajo y no pocos retos los que hemos tenido que superar.</p>
<h2>El primer contacto</h2>
<p>Fue a <img class="alignright wp-image-680 size-full" src="/wp-content/uploads/2014/06/logoCivitana.png" alt="[Civitana]" width="200" height="150" />principios de verano pasado cuando Iván contacto conmigo para presentarme su proyecto.</p>
<p>Lo que me encontré fue una declaración de intenciones de proyecto ambicioso, del que todavía no somos conscientes del calado que puede llegar a tener.</p>
<p>Me presentó un proyecto donde la palabra “Firma” dejaría de estar desvirtuada. Pasaría a tener un valor probatorio real, tanto de integridad, como de veracidad de la misma y de verificación de cuando se realizó.  Un proyecto donde la “participación ciudadana” se vería respaldada por un documento firmado electrónicamente, cuya firma estuviera basada en estándares, para que pudiera ser fácilmente validada y que solamente con él se pudiera defender el cambio. El reto de como presentaba el concepto de identidad en Internet era algo que se adelantaba a lo que probablemente tengamos en un par de años.</p>
<p>Todo estaba por hacer, se partía desde cero. Me uniría al proyecto en calidad de consultor en firma electrónica gracias a la experiencia anterior en el Ministerio de Cultura. En realidad a los que formamos el <strong>equipo técnico de Civitana</strong> con <strong>Tania</strong>, <strong>Jesús</strong> y yo mismo, nos ha tocado hacer de todo y estar en todos los frentes.</p>
<h2>El comienzo</h2>
<p>Mientras todo se definía y entre unas cosas y otras todo se retrasó hasta medidos de octubre. La propia naturaleza y lo innovador del proyecto me hizo ser consciente que podría tener un futuro incierto.</p>
<p>He de reconocer que los principios fueron duros pero a la vez apasionantes. Aunque para ser sincero, esto ha sido así en todo el proceso y no sólo al principio. Cada paso ha sido un reto que hemos tenido que superar y del que por ahora siempre hemos salido airosos.</p>
<p>Primero había que definir la arquitectura y la tecnología. Civitana tenía que ser escalable y montada con alta disponibilidad y además muy interactiva y usable. Creo que se eligió un stack tecnológico que cumple con todo ello. Con Frontend y Backend diferenciados y escalables, solución mixta de bases de datos relacionales y NoSql, sistema de ficheros distribuido,..etc.. Perdonarme que no pueda ser más específico pero en <strong>Civitana.org</strong> hay mucho más de lo que se ve.</p>
<h2>Finales del año pasado</h2>
<p>Y fue cuando estuvimos en el quizás hasta ahora ha sido el momento más crítico del proyecto.</p>
<p>La firma no iba como nosotros queríamos que fuera.  Nos obligó a realizar una nueva implementación de la parte de firma y generación de claves desde cero con otra tecnología, y lo que fue nuestra debilidad, se ha convertido en nuestra fortaleza. Ahora tenemos firma con cualquier dispositivo que tenga un navegador moderno, sin necesidad de instalar java, plugins, drivers, aplicaciones nativas&#8230;.</p>
<p>Sin poder entrar en detalles, de un plumazo pasamos a tener firma en PC, firma en “movilidad”, etc&#8230; Y lo mejor de una manera usable, universal, basada en estándares, y como debe ser generando las claves y la firma en el cliente, es decir, en el navegador.</p>
<p>Y todo con, a mi modesto entender, a años luz en facilidad de uso y universalidad de la “firma electrónica” a la que está todo el mundo acostumbrado. Como chascarrillo, siempre digo que esto nunca será valorado suficientemente,&#8230; si no es alguien que ha tenido que dar soporte de firma electrónica en una Sede Electrónica (un “pequeño” infierno y lo digo por lo he sufrido en mis propias carnes 🙂 ).</p>
<p>¡Ah! y todo es tecnología “<em>by Civitana</em>”.</p>
<h2>Salir a producción</h2>
<p>Nos tocaba ponernos “<em>el gorro</em>” de sistemas y montarlo todo en la nube, que es toda una aventura en si,&#8230; auditoria de seguridad, terminando la maquetación del diseño &#8230; en fin ultimando todo para por fin salir a producción el 15 de Mayo.</p>
<p>¿Y ahora? El futuro sigue incierto, ..&#8217;<em>¿la gente tomará como suya Civitana?, ¿realmente lo verá como la herramienta que puede ser?&#8217;</em>&#8230;. De lo que no tengo duda es todo el equipo técnico de <strong>Civitana</strong> disparamos siempre nuestro &#8216;<em>mejor tiro</em>&#8216;.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/general/" rel="category tag">General</a> y está etiquetada con <a href="/tag/civitana/" rel="tag">Civitana</a>, <a href="/tag/firma-digital/" rel="tag">firma digital</a>, <a href="/tag/nosql/" rel="tag">NOsql</a>, <a href="/tag/nube/" rel="tag">Nube</a> en <a href="/la-aventura-de-civitana-org/" title="23:44" rel="bookmark"><time class="entry-date" datetime="2014-06-04T23:44:26+00:00">4 junio, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-642" class="post-642 post type-post status-publish format-standard hentry category-control-de-la-configuracion category-java category-javascript tag-ant tag-grunt tag-java tag-javascript">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/aprendiendo-grunt-a-partir-de-ant/" rel="bookmark">Aprendiendo Grunt a partir de Ant</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h2>Prólogo</h2>
<h3>Hace unos años, unos 8 ya &#8230;</h3>
<p><img class="alignright size-full wp-image-657" src="/wp-content/uploads/2014/05/grunt.png" alt="[Grunt logo]" width="240" height="295" />En un proyecto me tocó realizar una &#8216;<strong>builtool</strong>&#8216;. Era una herramienta común que utilizarían todos los demás proyectos no importando su tecnología, <strong>PHP</strong>,<strong>.Net</strong>, <strong>Java</strong>, etc. Obtenía el código del sistema de control de versiones compilaba, paquetizaba y subía la build compilada a otra rama del control de versiones. En realidad era un pre-Maven porque obligaba a una cierta estructura de directorios en los proyectos pero no tenía ni su control de dependencias, ni sus arquetipos para nuevos proyectos. La herramienta estaba hecha en <strong>Ant</strong>.</p>
<p>Realmente nunca me llegó a apasionar ese proyecto, siempre me ha gustado más programar. Pero me ayudó a tener conciencia de la importancia de saber montar el &#8216;<strong><em>Control de la configuración</em></strong>&#8216; de un proyecto y también, como podéis imaginar, a tener bastante soltura con <strong>Ant</strong>.</p>
<h2>Capitulo I</h2>
<h3>… en la actualidad</h3>
<p>Para el <strong>Front</strong> del nuevo proyecto, con mucha carga de JavaScript, teníamos que generar la build  y realizar el despliegue. Para hacer menos pesada y más rápida la descarga necesitamos comprimir html, jasvascript y css y en el caso de estos dos últimos unificarlos en un sólo fichero.  Este proceso también lo  utilizaríamos para hacer despliegue continuo en nuestro entorno de preproducción, utilizando <strong>Jenkins</strong>.</p>
<p><strong>Grunt</strong> se ajustaba perfectamente a nuestras necesidades y además se unificaba las tecnologías. La elección de Grunt en vez de <strong>Gulp</strong>, otra herramienta similar, fue porque el primero está incluido en <strong>Yeoman</strong>, que viene a ser en Javascript lo que Maven es a Java. Una herramienta de gestión de dependencias, arquetipos, generación de buidls, test, etc.., que al igual que <strong>Maven</strong> permite gestionar todo el ciclo de vida de las builds. Elegí Grunt como un primer paso del camino que muy probablemente nos lleve a Yeoman.</p>
<p>Me enfrente al reto aprendiendo algo nuevo desde la perspectiva de algo conocido. Utilizando como punto de apoyo, sin que lo conocido conllevara  a perjuicios iniciales. Estas son las semejanzas, las diferencias y las conclusiones a las que he llegado.</p>
<h2>En que se parecen&#8230;</h2>
<p><strong>Ant</strong> tiene ya mucho recorrido, o dicho de otra manera ya es bastante &#8216;<em>viejuno</em>&#8216;. En cierta forma fue la respuesta de Java al <strong>Make</strong> de C. Surgió de la necesidad de crear una herramienta que pudiera compilar, generar ejecutables y que no dependiera del sistema operativo donde se ejecutara. Permite también la generación de test, despliegue, generación de documentación, etc.</p>
<p><strong>Grunt</strong> está dentro del ecosistema Javascript, es un &#8216;<strong><em>ejecutor de tareas</em></strong>&#8216; y se usa fundamentalmente para realización de builds, su testeo y su despliegue.</p>
<h3>Arquitectura y configuración</h3>
<p>Para utilizar <strong>Ant</strong> es necesario primero tener instalado <strong>Java</strong> y después la distribución de Ant. Algo similar ocurre con <strong>Grunt</strong> para poder usarlo es requisito tener instalado<strong> node.js</strong> y el cliente de Grunt.</p>
<p>Tanto en Ant como en Grunt la <strong>configuración de la build</strong> del proyecto se hace a través de un archivo. Su nombre por defecto en &#8216;<strong><em>build.xml</em></strong>&#8216; en Ant y &#8216;<strong><em>Gruntfile.js</em></strong>&#8216; en Grunt</p>
<h3>Tareas y objetivos</h3>
<p>En esencia tanto en Ant como en Grunt se utilizan las <strong>tareas</strong> disponibles (&#8216;<em>tasks</em>&#8216;) para definir <strong>objetivos</strong> (&#8216;<em>target</em>&#8216;). Los objetivos contienen la configuración de nuestro proyecto utilizando estas tareas&#8230; &#8216;<em>Copia estos ficheros</em>&#8216;, &#8216;<em>borra los ficheros de este tipo</em>&#8216;, etc..</p>
<p>En <strong>Ant</strong> un <em>target</em> pueden depender de otros. Se ejecutarán los <em>targets</em> de los que depende antes que él y lo harán en el orden indicado. Esto permite crear un flujo de ejecución de tareas.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="XML"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;project</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;Ejemplo de build&quot;</span> <span style="color: #000066;">default</span>=<span style="color: #ff0000;">&quot;ejecutar&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;target</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;ejecutar&quot;</span> <span style="color: #000066;">depends</span>=<span style="color: #ff0000;">&quot;clean,crearDistro,crearWar&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/project<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>En este caso &#8216;<em>ejecutar</em>&#8216; sería el target por defecto.</p>
<p>En <strong>Grunt</strong> se definen &#8216;<em>alias</em>&#8216; para el mismo resultado.</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Javascript"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #660066;">grunt</span>.<span style="color: #660066;">registerTask</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'default'</span><span style="color: #339933;">,</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'clean'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'copy'</span><span style="color: #339933;">,</span><span style="color: #3366CC;">'uglify'</span><span style="color: #339933;">,</span> <span style="color: #3366CC;">'concat'</span><span style="color: #339933;">,</span><span style="color: #3366CC;">'cssmin'</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">..</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Eso no significa que no puedas ejecutar <em>targets</em><strong> individuales</strong>. Por ejemplo en Ant para lanzar el target <em>clean</em> sería, ejecutando en el directorio donde está el &#8216;<em>build.xml</em>&#8216;</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ ant clean</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>o en Grunt, ejecutado en el directorio donde está el &#8216;<em>Gruntfile.js</em>&#8216;</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ grunt clean</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<h4>Variables externas</h4>
<p>Tanto en Ant como en Grunt se pueden <strong>pasar variables</strong> al archivo de configuración <strong>desde línea de comandos</strong>, lo que resulta muy útil a la hora de configurar varios entornos del mismo proyecto en el Jenkins.</p>
<p>En <strong>Ant</strong></p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ ant −<span style="color: #007800;">DdirEntorno</span>=prepro</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Usando así la variable en el <em>buid.xml</em></p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="XML"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;target</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;clean&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span>	</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;delete</span> <span style="color: #000066;">dir</span>=<span style="color: #ff0000;">&quot;${dirEntorno}&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/target<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>En Grunt:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ grunt −−<span style="color: #007800;">dirEntorno</span>=prepro</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Y el Gruntfile.js</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Javascript"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">clean<span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> main<span style="color: #339933;">:</span> <span style="color: #009900;">&#123;</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">  src<span style="color: #339933;">:</span> <span style="color: #009900;">&#91;</span><span style="color: #3366CC;">'&lt;%= dirEntorno %&gt;'</span><span style="color: #009900;">&#93;</span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">4</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> <span style="color: #009900;">&#125;</span></pre></td></tr><tr><td class="devcodelines" width="3%">5</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;">&#125;</span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<h2>… y en que se diferencian</h2>
<h3>Xml o Json/Javascript</h3>
<p><strong>Ant</strong> utiliza <em>xml</em> para definir la configuración. Esto hace que, sobre todo al principio, y con archivos de build complejos, que sea bastante rígido y engorroso.</p>
<p><strong>Grunt</strong> en este aspecto utiliza <em>json</em>, un formato mucho más liviano. Además está embebido en un archivo javascript permitiendo utilizar este lenguaje con toda su potencia. Este aspecto le da mucho más flexibilidad que Ant. Aquí es donde se le notan los años a Ant y como muestra Gant,una alternativa en el mundo Groovy que &#8216;pasa&#8217; del xml</p>
<h3>Gestión de dependencias de las tareas</h3>
<p>La filosofía de las dependencias de las tareas es completamente diferente. Ant ,de serie, trae diferentes tareas que ya se pueden usar. Esto no significa que se puedan utilizar otras tareas de terceros. Para esto se usa la tarea &#8216;<em>typedef</em>&#8216;.</p>
<p>La <strong>gestión de dependencias de las librerías</strong> que son necesarias para ejecutar estar tareas es completamente &#8216;<em>a mano&#8217;</em>. No te queda otra que bajarte la librería he incluirla, o bien en tu distribución de ant (en el directorio <em>&#8216;lib&#8217;</em>) o bien dentro de tu <em>home</em> (en el directorio &#8216;<em>.ant/lib</em>&#8216;)</p>
<p>En esto Grunt si que gana por goleada. Por defecto no viene con ninguna tarea predefinida, por lo que eres el que elige cual vas a utilizar, seleccionandola de su <a title="[Plugins de grunt]" href="http://gruntjs.com/plugins" target="_blank">página de plugins</a>. Probablemente existan varias posibilidades a la tarea que estás buscando. Después, para poder utilizarla, Grunt utiliza la potencia del gestor de paquetes de <strong>node.js</strong>, <strong>npm</strong>.</p>
<p>Por ejemplo, para instalar la tarea &#8216;<em>uglify</em>&#8216; que se utiliza para comprimir archivos js, se ejecuta el siguiente comando en el directorio donde este el <strong>Grutfile.js</strong></p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">$ npm <span style="color: #c20cb9; font-weight: bold;">install</span> grunt−contrib−uglify −−save−dev</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Esto incluye las dependencias en el &#8216;<em>package.json</em>&#8216; (Este fichero se crea al iniciar el proyecto ejecutando &#8216;<em>npm init&#8217;</em>)</p>
<p>Y para pode usar la tarea hay que añadir al <strong>Gruntfile.js</strong>:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Javascript"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #660066;">grunt</span>.<span style="color: #660066;">loadNpmTasks</span><span style="color: #009900;">&#40;</span><span style="color: #3366CC;">'grunt−contrib−uglify'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p>Fácil y cómodo, aunque tampoco falto de problemas. Por ejemplo la tarea <em>clean</em> de repente dejo de funcionar en Windows, mientras que el Linux no había problema. El problema, una de las dependencias subió de versión&#8230; y dejo de funcionar. La solución fue añadir la dependencia a la versión que funcionaba directamente en el archivo &#8216;<em>package.json</em>&#8216;. Espero tener tiempo para explicarlo mejor en otro post.</p>
<h2>Epílogo, Conclusiones</h2>
<p>Si eres de Back ,tienes algo de experiencia en Ant y quieres montar tu control de configuración para el Front que está basado en Javascript, trabajar con &#8216;Grunt&#8217; te va a resultar muy familiar.</p>
<p>Son tecnologías diferentes, algunas tareas serán similares y otras más específicas  no encontrarás en Ant, pero la esencia es la misma, así que sin miedo.</p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/control-de-la-configuracion/" rel="category tag">Control de la configuración</a>, <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/ant/" rel="tag">ant</a>, <a href="/tag/grunt/" rel="tag">grunt</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a> en <a href="/aprendiendo-grunt-a-partir-de-ant/" title="23:22" rel="bookmark"><time class="entry-date" datetime="2014-05-11T23:22:48+00:00">11 mayo, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-609" class="post-609 post type-post status-publish format-standard hentry category-criptografia-y-certificados tag-autoridades-certificadoras tag-certificados-digitales tag-cifrado-asimetico tag-clave-privada tag-clave-publica tag-ssl">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/certifficados-relaciones-de-confianza-y-entidades-certificadoras/" rel="bookmark">Certificados, relaciones de confianza y Autoridades Certificadoras</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>H</strong>ace unos par de meses, por fin tuve tiempo para realizar la integración del plugin de twitter que hice en <a title="[747mx.com]" href="http://www.747mx.com/" target="_blank" rel="noopener">747mx.com</a>. Para mi desgracia el servidor compartido no estaba muy actualizado y para que me funcionara tuve que añadir como parámetro, en las propiedades de la función cURL, el certificado de la Autoridad Certificadora. En este caso la CA de VeriSign.</p>
<p>Y este ejemplo me viene al pelo para intentar explicar brevemente como funciona los certificados digitales y es que, como en la vida misma, <strong>todo está basado en relaciones de confianza</strong>.</p>
<h3>Los fundamentos&#8230;</h3>
<p>La firma y la encriptación utilizando los certificados digitales se fundamentan en <strong>cifrado asimétrico</strong> en el que se utilizan dos claves. Una clave es <strong>pública</strong> y puede navegar sin problemas, bien por la red, en un correo electrónico, o embebida en un documento firmado por el usuario. La otra clave es <strong>privada</strong> y es la que sólo está en posesión del dueño. Por esa última razón las dos claves se deberían generar en el dispositivo del usuario, y no por ejemplo en el servidor en una aplicación web.</p>
<p>Con las dos parejas de claves se pueden hacer:</p>
<p style="padding-left: 30px;">1)  <em><strong>Firmar</strong></em> un “mensaje” con la clave privada y comprobar esa firma con la clave pública. Se calcula un resumen criptográfico (hash) del mensaje y el emisor con su clave privada firma este hash. El receptor vuelve a calcular el hash del mensaje y lo compara con el valor obtenido de firma con la clave pública del emisor.</p>
<p style="padding-left: 30px;">Así, con la firma se comprueban dos cosas:</p>
<p style="padding-left: 60px;">&#8211; La “<strong>integridad</strong>” ya que el mensaje no ha sido modificado desde que se ha enviado (no coincidirían los hash).</p>
<p style="padding-left: 60px;">&#8211; El “<strong>no repudio</strong>” ya que sólo ha podido emitir la firma el poseedor de la clave privada que corresponde a la clave pública.</p>
<p style="padding-left: 30px;">2) <em><strong>Cifrar</strong></em> un “mensaje” con la clave pública y descifrarlo con la clave privada. Solamente el poseedor de la clave privada es capaz de leer el mensaje en claro.</p>
<h3>&#8230; la confianza &#8230;</h3>
<p>Hasta aquí la situación es esta: dos usuarios generan sus parejas de claves y para mantener mensajes autentificados y cifrados se intercambian sus respectivas claves públicas, pero &#8230; ¿ cómo comprueban su “<em>identidad</em>”? ¿cómo saben que el ha generado la clave pública que tienen es quien dice ser?&#8230; Puedes caer en el peligro de lo que se llama el “<em>ataque del hombre el medio</em>”. Una tercera persona &#8216;puentea&#8217; la comunicación entre otras dos, generado dos parejas de claves y hace de &#8216;<em>proxy</em>&#8216; simulando ser la primera persona para la segunda, y ser la segunda para la primera y permitiéndolo &#8216;escuchar&#8217; toda la conversación.</p>
<p>Y es aquí donde retomo el título del post y entran en juego las <strong>relaciones de confianza</strong>&#8230; Tiene que existir algún mecanismo, que sin conocer al poseedor de la clave pública,  permita «<em>confiar</em>» en que es quien dice ser.</p>
<p>Esa confianza se puede establecer de varias maneras. O bien por <strong>anillo de confianza</strong>, o bien delegándola en una <strong>Autoridad Certificadora</strong> (y porque no, dando una vuelta de tuerca más, descasándola en una solución mixta).</p>
<p>Las dos se basan en firmar la clave pública de un usuario que se conoce su autenticidad. El el caso del anillo de confianza, es el usuario que conoce a la persona el que realiza la firma de la clave. En el caso de  la Autoridad Certificadora es esta la que establece los medios necesarios para certificar la autenticidad del usuario y después firma la clave publica del usuario con su clave privada. Un ejemplo de Autoridad Certificadora es la Policía Española con el DNI electrónico.</p>
<p>Así un tercero sólo necesita dar “<em>confianza</em>” y establecer como auténticas a sólo unas pocas claves públicas del anillo o en la clave de la autoridad certificadora.</p>
<p>Así en el caso de claves públicas de terceros, sólo serán “<em>confiables</em>” aquellas que estén firmadas por las que “<em>confío</em>”, o en todo caso por las que estén firmadas por claves que a su vez estén firmadas por claves en las que confío (disculpadme lo de “&#8230;<em>la parte contratante de la primera parte&#8230;</em>” 🙂 ). Se establece entonces una “<strong><em>cadena de confianza</em></strong>” en forma de árbol. Creo que el chascarrillo que lo resume es: “<em>&#8230;los amigos de mis amigos son mis amigos&#8230;</em>”</p>
<h3>&#8230; y los certificados</h3>
<p>Y es que un <strong>certificado digital</strong>, lo que viaja por la red, y que por ejemplo podemos ver en un navegador cuando comprobamos el certificado de un página https, no es más que un contenedor que contiene <strong>la clave pública</strong>, <strong>metadatos</strong> y la <strong>firma</strong> de ambos por parte de la Autoridad Certificadora. Estos metadatos incluyen los datos de la persona o la empresa para para quien ha sido emitido, las fechas de validez, la dirección donde consultar si el certificado ha sido revocado por la entidad emisora (OSCP o CRL), los datos de la entidad emisora, un número de serie, etc.</p>
<p><div id="attachment_620" style="width: 360px" class="wp-caption aligncenter"><img class="size-full wp-image-620" src="/wp-content/uploads/2014/04/datos_certificado_google_p1.png" alt="[Certificado digital de google.com]" width="350" height="340" srcset="/wp-content/uploads/2014/04/datos_certificado_google_p1.png 350w, /wp-content/uploads/2014/04/datos_certificado_google_p1-300x291.png 300w" sizes="(max-width: 350px) 100vw, 350px" /><p class="wp-caption-text">Certificado de google.com donde se puede ver la cadena de certificados (jerarquía) y sus metadatos</p></div>Los <strong>navegadores </strong>como el Firefox, <strong>lectores de PDF</strong> por ejemplo el Adobe Acrobat, la <strong>máquina virtual de Java</strong> (si tienes instala la JDK están en el fichero &#8216;cacerts&#8217; dentro de &#8216;$JAVA_HOME/jre/lib/security/cacert&#8217;), PHP para utilizar la función “cURL” vienen de serie ya con los certificados de las Autoridades Certificadoras más reconocidas.</p>
<p>Por el hecho de venir con la instalación del programa de turno, implícitamente le das confianza a estas autoridades certificadas. Lo que no significa que las <strong>puedas dejar de dar</strong> confianza eliminado sus certificados manualmente. O que<strong> puedas dar</strong> la misma confianza a otras autoridades incluyéndolas manualmente y que a todos los efectos los certificados emitidos por esta Autoridad Certificadora tengan la misma validez.</p>
<p>Esto es justo lo que me ha pasado en el ejemplo con el que empezaba el post. Para poder establecer la comunicación ssl con el api de twitter tuve que “darle confianza” a la CA e incluir su certificado en las opciones de la función cURL.</p>
<p>Y es que como ya he dicho antes, como en la vida misma, <strong>todo es cuestión de confianza&#8230;</strong></p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/criptografia-y-certificados/" rel="category tag">Criptografía y certificados</a> y está etiquetada con <a href="/tag/autoridades-certificadoras/" rel="tag">Autoridades certificadoras</a>, <a href="/tag/certificados-digitales/" rel="tag">Certificados digitales</a>, <a href="/tag/cifrado-asimetico/" rel="tag">cifrado asimético</a>, <a href="/tag/clave-privada/" rel="tag">clave privada</a>, <a href="/tag/clave-publica/" rel="tag">clave pública</a>, <a href="/tag/ssl/" rel="tag">ssl</a> en <a href="/certifficados-relaciones-de-confianza-y-entidades-certificadoras/" title="20:13" rel="bookmark"><time class="entry-date" datetime="2014-04-06T20:13:31+00:00">6 abril, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-583" class="post-583 post type-post status-publish format-standard hentry category-java category-javascript tag-concurrencia tag-java tag-javascript tag-vert-x">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/vert-x-mucho-mas-que-trabajar-en-java-como-node-js-y-en-groovy-ruby/" rel="bookmark">Vert.x: Mucho más que trabajar en Java como en node.js.. y en groovy, ruby,&#8230;</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h1>Prueba de concepto: Gateway con websockets y Gtalk utilizando Vert.x</h1>
<p><img class="alignleft size-full wp-image-602" src="/wp-content/uploads/2014/03/logo-white-big.png" alt="[Vert.x Logo]" width="240" height="72" />La primera vez que oí hablar de <a title="Vert.x" href="http://vertx.io/" target="_blank" rel="noopener"><strong>Vert.x</strong></a> fue en la charla sobre el nuevo lenguaje <a title="Ceylang" href="http://ceylon-lang.org/" target="_blank" rel="noopener">Ceylon</a> basado en la JVM que dio <strong>Gavin King</strong>  (la mente pensante detrás de Hibernate) el pasado febrero en <strong>MadridJUG</strong>. Comentó que para la web estaban enfocando sus esfuerzos en un framework asíncrono basado en <strong>Vert.x</strong>.</p>
<p>«<em>¿Asíncrono&#8230;?»</em> Ya se me levantó la ceja a lo &#8216;Sobera&#8217; .. y lo que me dio ya la puntilla es cuando se puso a picar en directo un servidor web (puro live coding :-)) me olía todo tenía un aire a como se trabaja con <strong>node.js</strong>,.. Así que me dije&#8230;»<em>esto de Vert.x me lo tengo que mirar</em>«.</p>
<p>He de reconocer que con el título del post me he pasado&#8230; He estado dándole vueltas a uno que tuviera &#8216;<em>punch</em>&#8216;&#8230; y me parece que he tirado por lo fácil. En realidad Vert.x es mucho más que un servidor web&#8230; Su &#8216;<em>misión</em>&#8216;, &#8216;<em>visión</em>&#8216; y &#8216;<em>valores</em>&#8216; es soportar <strong>millones</strong> <strong>de</strong> <strong>conexiones concurrentes</strong> usando un número mínimo de hilos del sistema operativo (¿¿?? así lo asegura en su documentación), imposibles en un esquema multihilo típico.</p>
<h2>¿Qué es Vert.x?</h2>
<p>Vert.x es un framework basado en eventos que corre en la máquina virtual de Java. Hecho para que sea fácil de <strong>escalar</strong> y soporte a <strong>tolerancia a fallos</strong>. Pensado para que existan de una manera sencilla varios cores en diferentes JVM y que se intercomuniquen entre ellos. <strong>Vert.x</strong> resuelve la concurrencia siguiendo el <a title="Modelo de actores" href="http://en.wikipedia.org/wiki/Actor_model" target="_blank" rel="noopener"><strong>modelo de actores</strong></a> y además asegura que no existirán bloqueos entre hilos. Otra de sus características es su &#8216;<strong><em>bus de eventos</em></strong>&#8216; que permite desacoplar tu aplicación en módulos y comunicarse entre ellos a través de mensajes. Y todo de manera asíncrona.</p>
<p><strong>Vert.x</strong> es &#8216;<strong><em>Políglota</em></strong>&#8216;, soporta <strong>JavaScript</strong>, <strong>Ruby</strong>, <strong>Groovy</strong>, <strong>Java</strong> o <strong>Python</strong> y con vista a soportar <strong>Scala</strong>, <strong>Clojure</strong> e incluso <strong>PHP</strong>. Ejecuta<strong> código fuente</strong> por lo que, por ejemplo, existe la posibilidad de arrancarlo con ficheros &#8216;.java&#8217; sin necesidad de compilarlos.</p>
<h2>Simple hilo ó multihilo</h2>
<p>Llegaréis a la conclusión y la compartiré de que con el título lo he simplificando demasiado ¿Pero porque he hecho esta comparación? Porqué Node.js y Vert.x tienen funcionamientos similares.</p>
<p>En JavaScript no existe la concurrencia. Aunque esta afirmación pueda ser no del todo cierto, porque en <strong>html5</strong> y en el cliente existe los <strong>workers</strong>, en JavaScript sólo existe un hilo y las operaciones que bloquean se ejecutan con llamadas asíncronas.</p>
<p>Y quizás esto, lo que parece su debilidad, es su virtud es esto lo que hace que node.js este valorado como un servidor con poca latencia cuando existe mucha carga .</p>
<p>La diferencia fundamental entre node.js (o Vert.x) y un sistema tradicional multihilo es que la máquina virtual de node utiliza un sólo hilo para atender todas las peticiones. El hilo se limita a recibir la petición y realizar llamadas asíncronas. No espera el resultado de la petición y continua con la siguiente. Más tarde recogerá el resultado para devolverlo al cliente.</p>
<p>Por el contrario en un sistema multihilo, por ejemplo en un despliegue tradicional de Java, existe un hilo para cada petición. Este se queda bloqueado mientras espera el resultado de una operación. Esto hace que bajo mucha carga existan muchos hilos y parte de ellos esperando, lo que repercute en la latencia.</p>
<p><strong>Vert.x</strong> trabaja de igual manera, en este caso utilizando el modelo de actores en el que cada uno de los actores será un &#8216;<strong><em>verticle</em></strong>&#8216;. En la documentación lo definen con una partícula de Vert.x y en la práctica es la manera de definir el código desplegado. Los &#8216;<em>verticles</em>&#8216; se pueden agrupar en <strong>módulos</strong> (lo más usual cuando la aplicación deja de ser trivial) y estos se pueden reutilizar.</p>
<h2>&#8230;Y la prueba de concepto</h2>
<p>Con Vert.x es muy sencillo crear <strong>servidores</strong> y <strong>clientes</strong> <strong>socket</strong>, <strong>ssl</strong>, <strong>http</strong> y <strong>websocket</strong>.</p>
<p>Necesitaba poder familiarizarme con la herramienta y tenía que hacer algo. Es entonces cuando recordé la presentación y demo muy, muy chula que hizo <strong>Iván</strong> <strong>López</strong> en <strong>MadridGUG</strong> utilizando una cuenta de Gtalk como boot. Así que basándome en esa idea he creado una prueba de concepto realizando un <strong>Gateway con WebSockets y Gtalk utilizando Vert.x</strong>. El proyecto es un proyecto <strong>Java</strong>.</p>
<p>Se utiliza una cuenta de Gtalk para poder crear una sala de chat entre usuarios que se conectan por Gtalk y usuarios que se conectan con un navegador mediante websockets.</p>
<p>Este ejemplo no explota todas las posibilidades  de Vert.x como el escalado y el bus de eventos pero si que despliega servidores web y de websocket. Me ha permitido conocer como se genera, se configura y se ejecuta un módulo. En definitiva, ha conseguido mi objetivo que como he dicho más arriba era familiarizarme con el framework</p>
<p>El proyecto lo he subido a <a title="GitHug de lógica alternativa" href="https://github.com/logicaalternativa" target="_blank" rel="noopener">GitHub</a> y que es lo que hace y como está explicado en el <a href="https://github.com/logicaalternativa/gateway-gtalk-websocket-vertx/blob/master/README.md" target="_blank" rel="noopener">README.md </a>.</p>
<p style="text-align: center;"><a title="Prueba de concepto: Gateway WebSockets y Gtalk utilizando Vert.x" href="https://github.com/logicaalternativa/gateway-gtalk-websocket-vertx" target="_blank" rel="noopener"><img class="size-full wp-image-432 alignnone" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" alt="[Logo GitHub]" width="32" height="32" /></a><a href="https://github.com/logicaalternativa/gateway-gtalk-websocket-vertx" target="_blank" rel="noopener"> Prueba de concepto: Gateway WebSockets y Gtalk utilizando Vert.x</a></p>
<p style="text-align: center;"><a title="Archivo README.md" href="https://github.com/logicaalternativa/gateway-gtalk-websocket-vertx/blob/master/README.md" target="_blank" rel="noopener">README.md</a></p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/concurrencia/" rel="tag">Concurrencia</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/vert-x/" rel="tag">vert.x</a> en <a href="/vert-x-mucho-mas-que-trabajar-en-java-como-node-js-y-en-groovy-ruby/" title="23:27" rel="bookmark"><time class="entry-date" datetime="2014-03-09T23:27:12+00:00">9 marzo, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-572" class="post-572 post type-post status-publish format-standard hentry category-javascript tag-angularjs tag-framework tag-javascript">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/mis-primeros-pasos-de-newbie-en-angularjs/" rel="bookmark">Mis primeros pasos de &#8216;newbie&#8217; en AngularJs</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong><img class="alignleft size-full wp-image-574" alt="Logo de Angular" src="/wp-content/uploads/2014/01/AngularJS-Shield-large_p.png" width="200" height="211" />A</strong>ctualmente estoy involucrado en un proyecto en el que la arquitectura es un Backend de servicios web Rest (Java) y como Frontend una aplicación de una sola página (SPA Single-page application) hecha en <strong>AngularJs</strong>, utilizando el patrón MVC en el navegador.</p>
<p>Siempre he tenido ganas en saber algo más de como funciona este framework y no podía perder la oportunidad de echar una mano en el Front.</p>
<p>Para poneros en antecedentes, vaya por delante que en mi anterior trabajo apenas se utilizaba JavaScript en la vista. Así que ahí estaba yo, leyendo un manual de AngularJs con muchas ganas, intentando asimilar todos los nuevos conceptos de la herramienta y del lenguaje.</p>
<p>Aquí van mis primeras conclusiones sobre Angularjs de un &#8216;newbie&#8217; que todavía tiene mucho que aprender.</p>
<h2>Single-page application</h2>
<p>La primera y quizás más importante es que me ha encantado el concepto. Te plantea una aplicación web de una manera diferente. Ya no piensas en peticiones web, formularios, etc, sino que piensas en <strong>eventos</strong>.</p>
<p>Al ser una aplicación de una sola página pasas de pensar en una aplicación web al uso a una que se parece más a .NET. La página se carga una vez (index.html) y es Angular quien se encarga según la url (en realidad ficticia con un ancla #) la que carga las diferentes &#8216;plantillas&#8217; (vista, código html parcial) y los diferentes &#8216;controladores&#8217; (funciones javaScript) que hace que se convierta en diferentes &#8216;páginas&#8217;.</p>
<p>No se carga una página por petición por lo que no es necesario guardar variables &#8216;volátiles&#8217; en sesión, simplemente la almacenas en memoria. De hecho nosotros solamente almacenamos en cookies las credenciales de acceso.</p>
<p>A nivel de controlador defines las funciones que responderán a los diferentes eventos. El apretar un botón, un enlace, el cambio de foco de un campo de formulario,etc&#8230; Te centras en programar la lógica del evento, sin preocuparte como propagar el cambio para dibujar el resultado al usuario. De eso se ocupa Angular&#8230;</p>
<h2>Conexión vista-controlador-backend ¿Programación reactiva?</h2>
<p>Dos cosas me han llamado la atención para bien. Primero, la conexión entre la vista y el controlador.</p>
<p>Es directa. Si desde el controlador se cambia una variable esta se propaga directamente en la vista y se produce un cambio en lo que está viendo en usuario. También en el otro sentido, se puede saber cuando se ha modificado una entidad por el usuario y procesar este cambio en el controlador.</p>
<p>Si tenemos en cuenta que los campos de un formulario pueden constituir una entidad en su conjunto, es fácil imaginar lo sencillo que es propagar los cambios también al backend. No se si se puede llamar &#8216;<em>Programación Reactiva</em>&#8216; pero se le parece mucho&#8230; Un cambio realizado por el usuario se puede propagar al backend y un cambio en el backend se puede propagar y que lo vea el usuario.</p>
<h2>Inyección de dependencias</h2>
<p>La segunda es la <strong>inyección de dependencias</strong> que implementa Angular. Una aplicación se divide en módulos y en estos hay controladores, directivas (estas enfocadas más a la vista y a sus validaciones) y servicios. Todas las dependencias, por ejemplo, de un servicio que necesita un controlador, se definen a nivel de módulo de aplicación.</p>
<p>Siguiendo el ejemplo, para poder utilizar el servicio en tu controlador es tan sencillo como tener como argumento&nbsp;en la definición de tu función controlador un objeto servicio. Angular se encarga de instanciar correctamente el servicio que necesita el controlador resolviendo a su vez todas las dependencias.</p>
<p>A nivel de modulo se pueden definir, factorías, servicios y proveedores&#8230; Seguro que quien se han pegado en Java con Spring esto les suena algo&#8230;</p>
<h2>Más cosas</h2>
<p>Angular es un framework muy completo. En el core viene con directivas, filtros, y servicios predefinidos (como su propia implementación del patrón &#8216;<strong><em>promise</em></strong>&#8216; [$q]) que te hace la vida más fácil para un novatillo en el lenguaje y en el concepto como yo.</p>
<p>Tiene &#8216;<em>interceptadores</em>&#8216; que son parecidos a los filtros de Java que te permiten capturar la petición al servidor y por ejemplo enviar las credenciales de conexión sin tener que hacerlo en cada petición.</p>
<p>Angular está orientado a <strong>TDD</strong>. Es sencillo tanto hacer test unitarios como test de integración.</p>
<h2>Conclusiones Pros y Contras</h2>
<h3 style="padding-left: 30px;">Ventajas</h3>
<p style="padding-left: 30px;">En esta fase de aprendizaje Angular me lo ha puesto sencillo. Me ha definido un marco estándar de trabajo y me ha ayudado a no tener la sensación de estar haciendo las cosas no también como debería.</p>
<p style="padding-left: 30px;">Además me he encontrado con que la documentación es buena y en este momento ya hay mucha gente trabajando con él por lo que puedes encontrar solución a casi cualquier problema en Stackoverflow.</p>
<p style="padding-left: 30px;">Otra de las ventajas es su rapidez de ejecución. Las peticiones al servidor son sólo llamadas ajax y plantillas parciales html. Realmente es destacable la rapidez con que se muestran todos los cambios.</p>
<p style="padding-left: 30px;">Este tipo de arquitectura es fácilmente cacheable al ser todo archivos estáticos por lo que la escalabilidad del Front casi deja de ser un problema.</p>
<p style="padding-left: 30px;">Por lo que escrito más arriba. El dinamismo que le da a la web es difícil de superar en otra arquitectura.</p>
<h3 style="padding-left: 30px;">Contras</h3>
<p style="padding-left: 30px;">La dudas que me surgen es que cuando la aplicación empiece a crecer en ficheros js cuanto va a ser de pesada en la primera carga. A lo mejor cuando llegue habrá que plantearse una librería como RequireJs. Por rendimiento realmente no es necesaria, ya que Angular sólo carga en memoria lo que necesita.</p>
<p style="padding-left: 30px;">Otra de las pegas es de usabilidad. Es muy común que en un mismo controlador manejes, por ejemplo, dos formularios y que juegues con su visibilidad para mostrar uno u otro. Si en el proceso el usuario aprieta el botón de &#8216;Atrás&#8217; del navegador lo más probable es que le lleve a una sección de la web que no se corresponde con el anterior paso. Estas cosas hay que tenerlas en cuenta en el diseño de la aplicación.</p>
<p style="padding-left: 30px;">Otro punto a tener en cuenta es a indexación por parte de los buscadores. Al ser todo javaScript y dinámico probablemente Google no podrá indexar la web.</p>
<p style="padding-left: 30px;">El problema de IE8. Es el único navegador que no soporta HTML5 y que actualmente aún lo usa mucha gente, aunque afortunadamente cada vez menos. Para que Angular soporte IE8 hay que hacer &#8216;unas movidas&#8217;, que hace que es mejor plantearse indicar al usuario que utilice otro navegador.</p>
<p style="padding-left: 30px;">Y por último es un cambio de concepto en el diseño de una página web. Por las inercias de las empresas, esto lleva a no pocas reticencias para que alguna se atreva a realizar su proyecto en Angular.</p>
<p>Para una web que siempre requiera un registro, y muy dinámica tipo red social, para mi las ventajas supera con mucho a los inconvenientes.</p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/angularjs/" rel="tag">AngularJs</a>, <a href="/tag/framework/" rel="tag">Framework</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a> en <a href="/mis-primeros-pasos-de-newbie-en-angularjs/" title="21:51" rel="bookmark"><time class="entry-date" datetime="2014-01-31T21:51:18+00:00">31 enero, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-555" class="post-555 post type-post status-publish format-standard has-post-thumbnail hentry category-java category-javascript tag-java tag-javascript tag-mvc tag-nosql">
				<header class="entry-header">
			<img width="240" height="102" src="/wp-content/uploads/2014/01/foto.jpg" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="Java versus JavaScript" />
						<h1 class="entry-title">
				<a href="/java-versus-javascript-reflexiones/" rel="bookmark">Java versus JavaScript, reflexiones</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>C</strong>on la aparición de <strong>Node.js</strong> y la posibilidad de programar <strong>JavaScript</strong> en servidor se palpa entre los “<em>javeros</em>” cierta, no se encontrar la palabra, &#8230;¿preocupación?. La sensación es de “<em>&#8230;nos están cambiando el agua&#8230;</em>” y el comentario más oído es “<em>&#8230; parece que es lo que se lleva ahora, no me gusta, pero habrá que aprenderlo&#8230;</em>”</p>
<p>A este desasosiego no ayudan post como los de <strong>PayPal</strong> (<a title="[PayPal se pasa a Node.js]" href="https://www.paypal-engineering.com/2013/11/22/node-js-at-paypal/" target="_blank" rel="noopener">enlace</a> ) en el que en resumen dicen que se pasan a JavaScript entre otras cosas porque es más rápido, necesitan menos gente y además se tira menos código. En respuesta a este post ha habido otros que han salido en defensa de Java y para poner coherencia en el tema (<a title="[Replica al post de Paypal]" href="http://developer-blog.cloudbees.com/2013/12/about-paypal-node-vs-java-fight.html?m=1" target="_blank" rel="noopener">enlace</a>)&#8230; y es que es lo que tienen casi todos los benchmark que pecan de partidistas.</p>
<p>En todas las ingenierías, pero mucho más en informática, tienes que estar en continua formación y estar al tanto de lo que se está haciendo. Es cierto que no podemos negar que también va todo un poco por modas y que es todo es cíclico. Parece que más tarde o más temprano siempre volvemos al mismo sitio que nos estamos moviendo en un circulo cerrado. Yo prefiero verlo más como una espiral&#8230; si la ves verticalmente parece que estás en el mismo punto,&#8230; pero que si la ves horizontalmente te das cuenta que estás en un nivel superior. Un ejemplo de esto son las nuevas bases de datos <strong>NOsql</strong>. Puede parecer que vuelven a las bases de datos pre-relacionales pero en realidad aportan muchas más cosas (escalabilidad, rapidez, big data y su explotación).</p>
<p>Pasa lo mismo con JavaScript hace mucho mucho tiempo que ha dejado de ser un lenguaje que sirve para poco más que hacer validaciones y hacer las “<em>cosas bonitas</em>” en la capa de presentación.</p>
<p>El gran problema de los “javeros” que dan sus primeros pasos en JavaScript, entre los que me incluyo, es que a la hora de enfrentarse al nuevo lenguaje piensan “<em>&#8230; al final será algo como Java, con tipado dinámico y bueno con callbacks..</em>. ” y nada más lejos de la realidad, JavaScript es otra filosofía y en realidad casi casi comparte con Java poco más que el nombre y algunas palabras reservadas.</p>
<p>Creo que en el aprendizaje hay que enfrentarse con una actitud diferente y positiva. Me parece muy interesante el trabajo que ha realizado <strong>Micael Gallego </strong>en su blog (<a title="[Blog Micael Gallego]" href="http://micaelgallego.github.io/blog/Viaje-por-las-tecnologias-de-front-end/" target="_blank" rel="noopener">enlace</a>), en el que explica su viaje en el aprendizaje del lenguaje desde el punto de vista de un programador Java y como a lo largo de los diferentes artículos va entendiendo la filosofía de JavaScript. A mi me ha ayudado mucho su lectura, así que no puedo más que recomendarla.</p>
<p>Reconozco que no soy experto en JavaScript y no puedo opinar en profundidad. Pero desde fuera creo que lo bueno y lo malo de JavaScript es que debido a su dinamismo, se pueden hacer las cosas de varias maneras. En Java por el contrario que es todo más cuadriculado.</p>
<p>De todas maneras creo que lo mejor es ser práctico, intentar conocer las debilidades y las fortalezas de cada lenguaje&#8230; Por ejemplo no me platearía hacer una aplicación de escritorio para Widonws en Java, para eso creo que es mucho mejor .NET. Por la misma razón me encontraría más a gusto, en aplicaciones de Backend en un proyecto con un equipo de trabajo numeroso, en un arquitectura Java que en una JavaScript, ya que al ser Java más “estricto” el código tendería ser más uniforme.</p>
<p>Lo que es cierto es que JavaScript permite hacer nuevas arquitecturas muy escalables y derivando gran parte de la responsabilidades al cliente. <strong>Angular.js</strong> es un framework que sigo muy de cerca. Sé que en algunos aspectos puede ser limitado pero prefiero la seguridad de basarme en algo estándar para montar una arquitectura MVC en el cliente.</p>
<p>Además JavaScript, junto con HTML5 se está convirtiendo en la única opción en la parte de navegador. Debido a las restricciones de seguridad que se están poniendo a los <strong>applets</strong> de java y a las <strong>extensiones</strong> y <strong>plugins</strong>. Son un autentico quebradero de cabeza por los agujeros de seguridad encontrados. Un ejemplo, Firefox a partir de su versión 26 no vienen habilitados por defecto los plugins excepto el de Flash.</p>
<p>Por eso en cosas “<em>especiales</em>” en la capa de cliente que por inercia antes te planteabas hacerlas con un applet o una extensión ahora enfocas tus esfuerzos en hacerlas en JavaScript&#8230; y se pueden hacer cosas muy, muy chulas.</p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/mvc/" rel="tag">MVC</a>, <a href="/tag/nosql/" rel="tag">NOsql</a> en <a href="/java-versus-javascript-reflexiones/" title="20:21" rel="bookmark"><time class="entry-date" datetime="2014-01-05T20:21:53+00:00">5 enero, 2014</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-532" class="post-532 post type-post status-publish format-standard hentry category-general category-java tag-configuracion tag-externalizar tag-java tag-jetty tag-spring tag-tomcat">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/configuracion-de-entornos-flexible-en-spring-utilizando-spel/" rel="bookmark">Configuración de entornos flexible en Spring utilizando SpEL</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h2>Introducción</h2>
<p>En general cuando desarrollas una aplicación de cualquier tipo te enfrentas al reto de:</p>
<h3 style="padding-left: 30px;">1) Configurar la aplicación de una manera sencilla</h3>
<p style="padding-left: 30px;">La configuración tiene que ser cómoda de modificar y tiene que estar centralizada (evitando que este desperdigada en multitud de ficheros de configuración las rutas, parámetros de conexión etc&#8230;)</p>
<h3 style="padding-left: 30px;">2) Que un mismo ejecutable (jar o war en el caso de java) sirva para diferentes entornos.</h3>
<p style="padding-left: 30px;">Evitar tener que hacer un build para diferentes entornos (Además probablemente en un entorno corporativo no tengas acceso a las contraseñas y a las rutas de los recursos, etc.. de producción) A esto es a lo que me refiero con externalizable.</p>
<p><strong>Spring</strong> es una poderosa y elegante herramienta que permite configurar una aplicación y establecer las dependencias entre sus clases a través de anotaciones o mediante archivos xml.</p>
<p>Pero esta potencia también puede llevar al peligro de que si no somos cuidadosos tengamos los parámetros de conexión, contraseñas, URL y rutas desperdigadas en varios archivos.</p>
<p>Para esto <strong>Spring</strong> ofrece herramientas que permiten cargar propiedades y valores de archivos &#8216;<em>.properties</em>&#8216; y además estos archivos pueden encontrase fuera del jar o del war e incluso pueden estar cifrados. Con esto se soluciona la centralización y la externalización.</p>
<h2>El problema</h2>
<p>Hecha la introducción paso a explicar el problema: Había que configurar una aplicación web en Spring en diferentes entornos en una misma máquina (un entorno en un <strong>Jetty</strong> y otro en un <strong>Tomcat</strong>), por lo que había que externalizar la configuración y además al estar en la misma máquina no servía que la ruta al fichero de configuración fuera fija (de estilo &#8216;<em>/home/usuario/aplicacion.properties</em>&#8216;)</p>
<h2>La solución</h2>
<p>Ha sido utilizar el bean &#8216;<em>PropertyPlaceholderConfigurer</em>&#8216; de <strong>Spring</strong> y utilizar <strong>SpEL</strong> (<em>Spring Expression Language</em>) de esta forma:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="XML"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.0&quot;</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">&quot;UTF-8&quot;</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;beans</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans&quot;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000066;">xmlns:xsi</span>=<span style="color: #ff0000;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000066;">xsi:schemaLocation</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000000; font-weight: bold;">&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;bean</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">&quot;propertyConfigurer&quot;</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span> </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;locations&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;#{systemProperties['aplicacion.config'] != null ? 'file:' + systemProperties['aplicacion.config'] :'classpath:'}application.properties&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> ...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/beans<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 01</strong>. Configuración xml de &#8216;propertyConfigurer&#8217;</p>
<p>La clave está en la línea 8. Si está definida la propiedad del sistema &#8216;<strong><em>aplicacion.config</em></strong>&#8216; buscará en el sistema de ficheros, el archivo de configuración &#8216;<em>aplicacion.properties</em>&#8216; en la dirección que indica su valor. Si no, busca el &#8216;<em>aplication.properties</em>&#8216; en el <em>classpath</em> (es decir dentro del war), por lo que este sería el archivo de configuración de la aplicación por defecto.</p>
<p>Un ejemplo del contenido de &#8216;<em>aplicacion.properties</em>&#8216; podría ser</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #006633;">aplicacion</span>.<span style="color: #006633;">config</span>.<span style="color: #006633;">pathfiles</span><span style="color: #339933;">=/</span>home<span style="color: #339933;">/</span>miguel<span style="color: #339933;">/</span>aplicacion<span style="color: #339933;">/</span>tmp</pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 02</strong>. Ejemplo de contenido de aplicacion.properties</p>
<p>Y la manera de usarlo dentro de la configuración xml de Spring sería:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="XML"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">01</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;?xml</span> <span style="color: #000066;">version</span>=<span style="color: #ff0000;">&quot;1.0&quot;</span> <span style="color: #000066;">encoding</span>=<span style="color: #ff0000;">&quot;UTF-8&quot;</span><span style="color: #000000; font-weight: bold;">?&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">02</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;beans</span> <span style="color: #000066;">xmlns</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans&quot;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">03</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000066;">xmlns:xsi</span>=<span style="color: #ff0000;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">04</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000066;">xsi:schemaLocation</span>=<span style="color: #ff0000;">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">05</td><td class="devcodelinesarea"><pre class="devcode devcodeline"><span style="color: #009900;"> <span style="color: #000000; font-weight: bold;">&gt;</span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">06</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines" width="3%">07</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;bean</span> <span style="color: #000066;">id</span>=<span style="color: #ff0000;">&quot;utilFichero&quot;</span> <span style="color: #000066;">class</span>=<span style="color: #ff0000;">&quot;com.logicaalternativa.ejemplo.UtilFicheroImp&quot;</span><span style="color: #000000; font-weight: bold;">&gt;</span></span> </pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">08</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline">  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;property</span> <span style="color: #000066;">name</span>=<span style="color: #ff0000;">&quot;directorio&quot;</span> <span style="color: #000066;">value</span>=<span style="color: #ff0000;">&quot;${aplicacion.config.pathfiles}&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span></pre></td></tr><tr><td class="devcodelines" width="3%">09</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/bean<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">10</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"> ...</pre></td></tr><tr><td class="devcodelines" width="3%">11</td><td class="devcodelinesarea"><pre class="devcode devcodeline"> <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/beans<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 03.</strong> Ejemplo de como se utilizan los valores definidos en el archivo de configuración</p>
<p>Ya sólo me queda indicar como se define esa propiedad. En el <strong>Tomcat </strong>un buen sitio es el &#8216;<em><strong>catalina.properties</strong>&#8216;</em> de su directorio &#8216;<em>config</em>&#8216;. Se definiría así:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Java"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr><tr><td class="devcodelines devcodelinesodd devcodelinesodd" width="3%">2</td><td class="devcodelinesarea devcodelinesareaodd devcodelinesareaodd"><pre class="devcode devcodeline"><span style="color: #006633;">aplicacion</span>.<span style="color: #006633;">config</span><span style="color: #339933;">=/</span>home<span style="color: #339933;">/</span>miguel<span style="color: #339933;">/</span>config<span style="color: #339933;">-</span>aplicacion<span style="color: #339933;">-</span>tomcat<span style="color: #339933;">/</span></pre></td></tr><tr><td class="devcodelines" width="3%">3</td><td class="devcodelinesarea"><pre class="devcode devcodeline">...</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 04.</strong> Configurando el Tomcat</p>
<p>O directamente definiendo la propiedad al arrancar la máquina virtual. Por ejemplo si tu proyecto tiene configurado el plugin,&nbsp; arrancando el jetty embebido de mvn de la siguiente manera:</p>
<p><!--DEVFMTCODE--><pre class="devcodeblock" title="Bash"><div class="devcodeoverflow"><table class="devcodearea" width="100%"><tr><td class="devcodelines" width="3%">1</td><td class="devcodelinesarea"><pre class="devcode devcodeline">mvn -Daplicacion.config=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>miguel<span style="color: #000000; font-weight: bold;">/</span>config-aplicacion-jetty<span style="color: #000000; font-weight: bold;">/</span> jetty:run</pre></td></tr></table></div></pre><!--END_DEVFMTCODE--></p>
<p style="text-align: center;"><strong>Código 05</strong>. Ejemplo al arrancar el jetty de mvn</p>
<p style="text-align: left;">En los ejemplos en los dos directorios &#8216;<em>/home/miguel/config&minus;aplicacion&minus;jetty/</em>&#8216; y &#8216;<em>/home/miguel/config&minus;aplicacion&minus;tomcat/</em>&#8216; se encontrarían sendos archivos &#8216;<em>aplicacion.properties</em>&#8216; cada uno configurados con los valores para cada entorno.</p>
<p>Espero que os sirva.</p>
<p><a title="Mi CV" href="/mi-cv/">M.E.</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/general/" rel="category tag">General</a>, <a href="/category/programacion/java/" rel="category tag">Java</a> y está etiquetada con <a href="/tag/configuracion/" rel="tag">Configuración</a>, <a href="/tag/externalizar/" rel="tag">Externalizar</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/jetty/" rel="tag">Jetty</a>, <a href="/tag/spring/" rel="tag">Spring</a>, <a href="/tag/tomcat/" rel="tag">Tomcat</a> en <a href="/configuracion-de-entornos-flexible-en-spring-utilizando-spel/" title="23:53" rel="bookmark"><time class="entry-date" datetime="2013-12-16T23:53:59+00:00">16 diciembre, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-489" class="post-489 post type-post status-publish format-standard hentry category-java tag-despliegue-continuo tag-java tag-jenkins tag-junit tag-maven">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/de-despliegue-continuo-y-de-responsabilidad-personal/" rel="bookmark">De despliegue continuo y de responsabilidad personal</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h1>Despliegue continuo con Jenkins, Maven, Selenium y Junit</h1>
<p>Están surgiendo nuevos conceptos como el <strong>despliegue continuo</strong> y la <strong>responsabilidad personal</strong> que están cambiando la forma de desplegar en un entorno de producción.</p>
<p>Digamos que la “manera tradicional” es decidir que funcionalidades van a ir en cada versión codificarlas, probar esa versión y por fin el despliegue en producción. Quién se haya enfrentado a esto sabe el estrés que produce el despliegue de una nueva versión sobre todo si conlleva bastantes cambios, &#8230;si ya sabemos que todo está probado, que no va a pasar nada, pero el mal trago del despliegue no te lo quita nadie … <em>“¿irá todo bien? ¿no irá?</em>”</p>
<h2>Despliegue continuo</h2>
<p>¿Cómo están haciendo las cosas empresas como Facebook? … pues simplemente <strong>no hay versiones</strong>. <a href="/de-despliegue-continuo-y-de-responsabilidad-personal/#more-489" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a> y está etiquetada con <a href="/tag/despliegue-continuo/" rel="tag">despliegue continuo</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/jenkins/" rel="tag">jenkins</a>, <a href="/tag/junit/" rel="tag">junit</a>, <a href="/tag/maven/" rel="tag">maven</a> en <a href="/de-despliegue-continuo-y-de-responsabilidad-personal/" title="20:38" rel="bookmark"><time class="entry-date" datetime="2013-11-17T20:38:51+00:00">17 noviembre, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-427" class="post-427 post type-post status-publish format-standard hentry category-apis category-php tag-api tag-php tag-rest tag-tweets tag-twitter tag-widget">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/tweets-interes-difusion-audiencia-trasteando-api-twiter/" rel="bookmark">Dar valor a los tweets: Interés, difusión, audiencia,&#8230; trasteando con el API de Twitter</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>N</strong>o se puede decir que sea un &#8216;<em>social media</em>&#8216;, pero de un tiempo a esta parte <strong>Twitter</strong> se ha convertido para mi en una fuente de información esencial y casi imprescindible.&nbsp; Tiene un pero, a veces te pierdes entre toda la información que te llega&#8230; Pensando siempre &#8216;<strong>alternativamente</strong>&#8216; me surgieron <strong>estas preguntas</strong>:</p>
<blockquote><p>¿Sé puede hacer un poco más social una red social como Twitter?&#8230; ¿Por qué no mostrar de una manera sencilla como han valorado los demás usuarios el tweet que estás leyendo?&#8230;¿cuánto se ha difundido?&#8230;. ¿Sé puede estimar a cuanta gente a llegado?</p></blockquote>
<p>Lo que me dio pie fue que, para<a title="[747mx.com]" href="http://www.747mx.com/" target="_blank"> 747mx.com</a>, un proyecto hermano de <strong>Lógica Alternativa</strong>, quería incorporar la información de los tweets pero el <strong>widget</strong> oficial me fastidiaba el diseño, no sabía como encajarlo. La solución pasaba en estudiar el <strong>API REST</strong> de <strong>Twitter</strong>. Puesto manos a la obra me di cuenta del mundo de posibilidades que permitía,&#8230; apareció en mi el físico que llevo dentro, ese el que le gusta lo de los coeficientes y esas cosas, la cosa se lío y el resultado fue el siguiente. <a href="/tweets-interes-difusion-audiencia-trasteando-api-twiter/#more-427" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/apis/" rel="category tag">APIs</a>, <a href="/category/programacion/php/" rel="category tag">PHP</a> y está etiquetada con <a href="/tag/api/" rel="tag">API</a>, <a href="/tag/php/" rel="tag">PHP</a>, <a href="/tag/rest/" rel="tag">REST</a>, <a href="/tag/tweets/" rel="tag">tweets</a>, <a href="/tag/twitter/" rel="tag">Twitter</a>, <a href="/tag/widget/" rel="tag">widget</a> en <a href="/tweets-interes-difusion-audiencia-trasteando-api-twiter/" title="20:39" rel="bookmark"><time class="entry-date" datetime="2013-09-17T20:39:54+00:00">17 septiembre, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-400" class="post-400 post type-post status-publish format-standard hentry category-programacion tag-card-sorting tag-diseno-centrado-en-el-usuario tag-experiencia-de-usuario tag-testing-ab tag-usabilidad">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/apuntes-sobre-diseno-centrado-en-el-usuario-experiencia-de-usuario-usabilidad/" rel="bookmark">Apuntes sobre diseño centrado en el usuario, Experiencia de usuario, Usabilidad, &#8230;</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>Usabilidad</strong>, <strong>Experiencia de Usuario</strong>, <strong>Diseño Centrado en el Usuario</strong>, &#8230; son palabras que se nos han hecho familiares a raíz de la evolución de la web y sobre todo con la aparición de los nuevos dispositivos móviles.</p>
<p>Esto ha hecho que el técnico experto en estas materias sean uno de los perfiles más valorados en el mercado. Existen otros conceptos relacionados, unos a nivel teórico y otros unidos a la práctica profesional, que son elementos claves y que engloban lo que se llama interacción persona-ordenador (IPO).</p>
<p>En mi vida profesional he utilizado estas técnicas y conceptos. Últimamente me he enfrentado a ellos desde la visión académica. Para poder fijar ideas y tener una visión clara y concisa de esta apasionante disciplina me obligado a escribir este artículo.</p>
<p>Me centraré más en el Diseño Centrado en el Usuario, en que consiste, cuales son sus ventajas, sus etapas, que herramientas se usan y su integración con la metodologías ágiles. Pero antes y para enmarcarlo en su contexto doy unas pequeñas pinceladas sobre conceptos como Interacción persona-ordenador, Experiencia de usuario y Usabilidad. <a href="/apuntes-sobre-diseno-centrado-en-el-usuario-experiencia-de-usuario-usabilidad/#more-400" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/" rel="category tag">Programación</a> y está etiquetada con <a href="/tag/card-sorting/" rel="tag">Card Sorting</a>, <a href="/tag/diseno-centrado-en-el-usuario/" rel="tag">Diseño Centrado en el Usuario</a>, <a href="/tag/experiencia-de-usuario/" rel="tag">Experiencia de Usuario</a>, <a href="/tag/testing-ab/" rel="tag">Testing A/B</a>, <a href="/tag/usabilidad/" rel="tag">Usabilidad</a> en <a href="/apuntes-sobre-diseno-centrado-en-el-usuario-experiencia-de-usuario-usabilidad/" title="21:02" rel="bookmark"><time class="entry-date" datetime="2013-08-27T21:02:55+00:00">27 agosto, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-380" class="post-380 post type-post status-publish format-standard hentry category-sistemas-operativos tag-html-5 tag-javascript tag-sistemas-operativos-2">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/lineas-generales-del-desarrollo-para-tizen-nuevo-so-enfocado-a-smartphones/" rel="bookmark">Líneas maestras del desarrollo para Tizen, nuevo SO enfocado a Smartphones</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong><img class="size-full wp-image-383 alignright" alt="[Logo de tizen]" src="/wp-content/uploads/2013/07/tizen_p.png" width="300" height="102" />Tizen</strong> es un nuevo sistema operativo, que pretende ser global. Su principal objetivo son los Smartphone pero exitirán versiones para PC, para tablets, TV inteligentes e incluso para coches (por cierto este último con muy buena pinta, <a title="[Tizen para coches]" href="http://www.youtube.com/watch?v=HZClYjAxP6Y" target="_blank">ver vídeo</a>)&nbsp;</p>
<p><strong><a title="[Tizen]" href="http://www.tizen.org/">Tizen</a></strong> esta patrocinado y promovido por la <strong>Linux Foundation</strong>. El proyecto es una “<em>join venture</em>” de varias empresas que van desde operadores móviles como <strong>Vodafone</strong> y <strong>Orange</strong>, a fabricantes de dispositivos como <strong>Samsung</strong> e <strong>Intel</strong>. Se ha elegido una forma de gobierno democrático en el que ninguna de las empresas que la forma lleva el peso de las decisiones, aunque eso no significa que cada una de ellas pueda crear sus propios módulos.</p>
<p><strong>Tizen</strong> se fundamenta en estándares y es una plataforma de código abierto basada en <strong>Linux</strong>. Para el desarrollo de aplicaciones se ha elegido <strong>HTML 5</strong> como entorno de desarrollo de sus aplicaciones.&nbsp;</p>
<p>Gracias al Taller de Tizen organizado por <a title="[Madrid JS]" href="http://www.meetup.com/madridjs/" target="_blank"><strong>MadridJS</strong></a> y impartido por <strong>Intel</strong> he podido saber las líneas maestras de su plataforma de desarrollo, <strong>API</strong> y <strong>SDK</strong>.  <a href="/lineas-generales-del-desarrollo-para-tizen-nuevo-so-enfocado-a-smartphones/#more-380" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/sistemas-operativos/" rel="category tag">Sistemas operativos</a> y está etiquetada con <a href="/tag/html-5/" rel="tag">HTML 5</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/sistemas-operativos-2/" rel="tag">sistemas operativos</a> en <a href="/lineas-generales-del-desarrollo-para-tizen-nuevo-so-enfocado-a-smartphones/" title="21:03" rel="bookmark"><time class="entry-date" datetime="2013-07-11T21:03:19+00:00">11 julio, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-362" class="post-362 post type-post status-publish format-standard hentry category-javascript tag-geolocalizacion tag-javascript tag-mapas tag-openlayers tag-openstreetmap">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/openstreetmap-openlayers-openrouteservice-la-alternativa-a-google-maps/" rel="bookmark">OpenStreetMap-OpenLayers-OpenRouteService la &#8216;alternativa&#8217; a Google Maps</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><b>R</b>ealmente no te das cuenta de la dependencia que tienes de los servicios de Google. Piensas que puedes disponer de ellos porque además de ser potentes son gratis&#8230; hasta que dejan de serlo.</p>
<p><img class="alignleft size-full wp-image-370" alt="[Mapa OpenLayers]" src="/wp-content/uploads/2013/07/mapa.png" width="250" height="124" />Me ha ocurrido en el pasado, en un proyecto personal (<a title="747mx.com" href="http://www.747mx.com/" target="_blank"><strong>747mx.com</strong></a>) que utilizaba el traductor de <strong>Google</strong>. Era gratis hasta un número de peticiones, suficientes para la pretensiones de esa página y pasó a ser de pago desde la primera petición. Algo que no me podía permitir en ese portal.</p>
<p>Así que cuando en una entrevista a <strong>Javier De La Torre</strong> uno de los fundadores de <strong>Vizzuality</strong> señalaba a <strong>OpenStreetMap</strong> como alternativa seria a Google Maps me dije &#8216;<em>… esto me lo tengo que mirar</em>&#8216; .</p>
<p>Para saber como funciona de verdad, lo que me propuse fue migrar un código que tenía con el API de Google Maps en <b>747mx.com</b>. Basarme en él y hacer lo mismo en <a title="OpenStreetMap" href="http://www.openstreetmap.org/" target="_blank"><b>OpenStreetMap</b></a> utilizando lal librería <a title="OpenLayers" href="http://www.openlayers.org/" target="_blank"><b>OpenLayers</b></a> y el servicio de geolocalización de <a title="[OpenRouteService.org]" href="http://www.OpenRouteService.org/"><b>OpenRouteService.org</b>.</a>  <a href="/openstreetmap-openlayers-openrouteservice-la-alternativa-a-google-maps/#more-362" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/geolocalizacion/" rel="tag">Geolocalización</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/mapas/" rel="tag">Mapas</a>, <a href="/tag/openlayers/" rel="tag">OpenLayers</a>, <a href="/tag/openstreetmap/" rel="tag">OpenStreetMap</a> en <a href="/openstreetmap-openlayers-openrouteservice-la-alternativa-a-google-maps/" title="11:32" rel="bookmark"><time class="entry-date" datetime="2013-07-03T11:32:20+00:00">3 julio, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-315" class="post-315 post type-post status-publish format-standard hentry category-la-nube tag-blog tag-cloud-computing tag-mysql tag-nube tag-php tag-wordpress">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/logicaalternativa-com-esta-en-las-nubes/" rel="bookmark">LogicaAlternativa.com está en la(s) nube(s), en OpenShift</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>“<em><strong>S</strong>i lees esto significa que Lógica Alternativa está ya en la nube</em>”&#8230; Lo siento no he podido resistir la tentación de empezar esta entrada como los epílogos de las pelis 🙂</p>
<p><img class="alignright size-full wp-image-341" alt="[OpenShift]" src="/wp-content/uploads/2013/06/openshift_mod_p.png" width="150" height="117" /><a title="[OpenShift]" href="https://www.openshift.com/" target="_blank">OpenShift</a> es un servicio de <strong>Red Hat</strong> encuadrado en la capa <strong>PaaS</strong> (Plataforma como Servicio), enfocado por lo tanto al <strong>desarrollador</strong>. Permite desplegar un montón de tipos de aplicaciones, <strong>J2EE</strong> (jbossas-7, jenkins-1.4, Tomcat 6, Tomcat 7, ..) <strong>PHP</strong>, <strong>Perl</strong>, <strong>Pyton</strong>, <strong>Ruby</strong>, <strong>JavaScript</strong> (node.js) contra base de datos como <strong>MySql</strong>, <strong>PostgreSQL</strong>, ¡<strong>MongoDb</strong>!. Y realizar integración continua con <strong>Jenkins</strong> (se más de uno que al llegar aquí ya se le está haciendo la boca agua).</p>
<p>Tiene una mecánica &#8216;alternativa&#8217;, aquí que no hay un ftp al uso. Se utiliza <strong>Git</strong> y el cliente por linea de comandos <strong>rhc</strong>. <a href="/logicaalternativa-com-esta-en-las-nubes/#more-315" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/la-nube/" rel="category tag">La Nube</a> y está etiquetada con <a href="/tag/blog/" rel="tag">blog</a>, <a href="/tag/cloud-computing/" rel="tag">Cloud Computing</a>, <a href="/tag/mysql/" rel="tag">MySQL</a>, <a href="/tag/nube/" rel="tag">Nube</a>, <a href="/tag/php/" rel="tag">PHP</a>, <a href="/tag/wordpress/" rel="tag">WordPress</a> en <a href="/logicaalternativa-com-esta-en-las-nubes/" title="21:39" rel="bookmark"><time class="entry-date" datetime="2013-06-15T21:39:51+00:00">15 junio, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-288" class="post-288 post type-post status-publish format-standard hentry category-programacion">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/el-siguiente-nivel-agile-coach-competency-framework/" rel="bookmark">El siguiente nivel, Agile Coach Competency Framework</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><span><strong>P</strong>ara mi son tiempos de cambios, algunos “forzados” y otros “provocados”. Ahora tengo la necesidad de saber que es lo que está pasando en este mundillo de la programación y la informática. Siempre me ha interesado las metodologías ágiles, así que el pasado miércoles asistí a un seminario/taller organizado por <a title="[Madrid Agile]" href="https://twitter.com/madriagil">Agile Madrid</a> y dirigido por<strong> Ángel Diaz Maroto</strong>. </span></p>
<p><span style="color: #545454;">En este seminario presentó el <strong>Framework de Competencias de Agile Coach</strong> ideado por <a title="[Lyssa Adkins]" href="http://www.coachingagileteams.com/" target="_blank">Lyssa Adkins</a>. La idea de fondo de este marco de trabajo es intentar conseguir transformar a un grupo de personas en un grupo de alto rendimiento. <a href="/el-siguiente-nivel-agile-coach-competency-framework/#more-288" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></span></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada fue publicada en <a href="/category/programacion/" rel="category tag">Programación</a> el <a href="/el-siguiente-nivel-agile-coach-competency-framework/" title="10:52" rel="bookmark"><time class="entry-date" datetime="2013-05-31T10:52:52+00:00">31 mayo, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-214" class="post-214 post type-post status-publish format-standard hentry category-java tag-hibernate tag-java">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/hibernate-4-obtener-el-objeto-connection-relacionado-con-la-sesion/" rel="bookmark">Hibernate 4: obtener el objeto Connection relacionado con la sesión</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><strong>U</strong>na nota rápida de un problema con el que me he pegado hace poco.</p>
<p>Necesitaba lanzar una función de BBDD (<strong>Oracle</strong>) desde <strong>Hibernate</strong> manteniendo la transacción.&nbsp; Para lanzar la función desde jdbc, en las versiones anteriores de Hibernate era muy intuitivo obtener el objeto <strong>Connection</strong> relacionado con la sesión pero en <strong>Hibernate 4</strong> ha cambiado el interface <strong>Session. <a href="/hibernate-4-obtener-el-objeto-connection-relacionado-con-la-sesion/#more-214" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></strong></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a> y está etiquetada con <a href="/tag/hibernate/" rel="tag">Hibernate</a>, <a href="/tag/java/" rel="tag">Java</a> en <a href="/hibernate-4-obtener-el-objeto-connection-relacionado-con-la-sesion/" title="13:47" rel="bookmark"><time class="entry-date" datetime="2013-05-28T13:47:38+00:00">28 mayo, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-197" class="post-197 post type-post status-publish format-standard hentry category-sistemas-operativos tag-linux tag-sistemas-operativos-2">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/puppy-linux/" rel="bookmark">Puppy Linux</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<div>
<p><strong><img class="alignleft size-full wp-image-202" alt="logo" src="/wp-content/uploads/2013/05/logo.png" width="63" height="68" />H</strong>ace mucho tiempo que en casa hay un ordenador, casi casi está ahí desde siempre. Es un Intel Celeron a 2.66 Mhz con 256 Mb de RAM. Lo utilizamos todos y se usa para navegar, ver el correo, de servidor de impresión&#8230;</p>
<p>Ha salido bueno, porque ha sobrevivido a todo lo que estaba en la mesa del escritorio. Se ha mantenido, ahí sempiterno, mientras todo (ratones, teclados, monitores, altavoces, etc) ha ido muriendo y se ha tenido que ir cambiando.</p>
<p>El caso es que el Windows XP que tiene instalado se ha ido degradando. El pobre tampoco podía con las nuevas versiones de antivirus. Era un suplicio por el tiempo que tardaba en arrancar y en abrir las aplicaciones.</p>
<p>Buscaba una solución sin tener que quemar todas mis naves y manteniendo todo lo que tenía instalado y la encontré en una distribución linux, <a title="[Puppy Linux]" href="http://puppylinux.org/" target="_blank"><strong>Puppy</strong></a>. Me gusto su lógica alternativa&#8230; <a href="/puppy-linux/#more-197" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></div>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/sistemas-operativos/" rel="category tag">Sistemas operativos</a> y está etiquetada con <a href="/tag/linux/" rel="tag">linux</a>, <a href="/tag/sistemas-operativos-2/" rel="tag">sistemas operativos</a> en <a href="/puppy-linux/" title="21:12" rel="bookmark"><time class="entry-date" datetime="2013-05-21T21:12:49+00:00">21 mayo, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-163" class="post-163 post type-post status-publish format-standard hentry category-android category-java">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/cambio-de-color-a-barra-de-progreso-en-android/" rel="bookmark">Cambio de color a barra de progreso en Android</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><b><img class="alignleft size-full wp-image-185" alt="Android" src="/wp-content/uploads/2013/05/Android.png" width="150" height="150" />L</b>a duración de manga de motocross se mide en minutos + 2 vueltas. A nivel regional son 20 minutos + 2 vueltas, a nivel nacional 30 minutos + 2 vueltas, etc&#8230; Entrenando lo normal es hacer mangas de la misma duración, o de menos tiempo (mejorando la rapidez) o de más (mejorando el fondo). Las motos de cross no tienen instrumentación y obliga a que una persona desde fuera indique al piloto cuanto le queda de manga.</p>
<p>¿Qué por qué cuento esto? Desde hace bastante tiempo mi hermano y yo corremos motocross a nivel regional. Bueno en realidad mi hermano es el “quemao” y siempre andaba quejándose de que sus entrenos no podían ser de calidad porque no sabía el tiempo que llevaba, no sabía cuando apretar, cuando regular, bla, bla, bla&#8230;</p>
<p>Ahí salió el “<i>hermano informático</i>”, surgió el problema de cambiar el color a una barra de progreso y echarme a la cara el peor &#8216;<i>stakeholder</i>&#8216; que he tenido en mi vida …  <a href="/cambio-de-color-a-barra-de-progreso-en-android/#more-163" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada fue publicada en <a href="/category/programacion/android/" rel="category tag">Android</a>, <a href="/category/programacion/java/" rel="category tag">Java</a> el <a href="/cambio-de-color-a-barra-de-progreso-en-android/" title="18:34" rel="bookmark"><time class="entry-date" datetime="2013-05-09T18:34:51+00:00">9 mayo, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-133" class="post-133 post type-post status-publish format-standard hentry category-java category-javascript tag-acceso tag-java tag-javascript tag-login tag-securizar tag-sha-1">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/java-securizacion-de-formulario-de-acceso-con-sha-1/" rel="bookmark">(Java) Securización de formulario de acceso con SHA-1</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><img class="alignright size-full wp-image-150" alt="Anonymous_JAVA_p" src="/wp-content/uploads/2013/04/Anonymous_JAVA_p.png" width="138" height="150" /><strong>C</strong>ompletando la <a title="Securización de formulario de acceso con SHA-1" href="/securizacion-de-formulario-de-acceso-con-sha-1/">entrada anterior</a>, he realizado la implementación en <strong>Java</strong>. Básicamente &#8216;<em>todo es lo mismo&#8230; pero no es igual</em>&#8216;&nbsp; :-). Cambia la manera de obtener el <strong>número aleatorio</strong> y la forma de obtener el <strong>sha-1</strong>.</p>
<p>La estructura es la de un proyecto <strong>Maven</strong> web con su <a href="https://github.com/logicaalternativa/ejemplosJava/blob/master/loginsha1/pom.xml" target="_blank">pom.xml</a> para que sea sencillo compilarlo y generar el war. Paso a explicarlo.&nbsp; <a href="/java-securizacion-de-formulario-de-acceso-con-sha-1/#more-133" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/java/" rel="category tag">Java</a>, <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a> y está etiquetada con <a href="/tag/acceso/" rel="tag">acceso</a>, <a href="/tag/java/" rel="tag">Java</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/login/" rel="tag">login</a>, <a href="/tag/securizar/" rel="tag">securizar</a>, <a href="/tag/sha-1/" rel="tag">SHA-1</a> en <a href="/java-securizacion-de-formulario-de-acceso-con-sha-1/" title="21:29" rel="bookmark"><time class="entry-date" datetime="2013-04-28T21:29:17+00:00">28 abril, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-68" class="post-68 post type-post status-publish format-standard hentry category-javascript category-php tag-acceso tag-javascript tag-login tag-php tag-securizar tag-sha-1">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="/securizacion-de-formulario-de-acceso-con-sha-1/" rel="bookmark">Securización de formulario de acceso con SHA-1</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><img class="alignleft size-full wp-image-69" alt="sha1" src="/wp-content/uploads/2013/04/sha1.png" width="150" height="125" /><strong>M</strong>uchas veces las aplicaciones web no tienen acceso por ssl (https) y suelen tener <strong>un formulario de &#8216;login&#8217; de usuario y contraseña</strong>.</p>
<p>Esto quiere decir que información sensible como la contraseña se transmite en texto claro y que sea relativamente fácil que terceros pueden tener acceso a ella. Por ejemplo esnifando el tráfico si el usuario se conecta con una wifi abierta.</p>
<p>Lo que presento a continuación es una manera sencilla de securizar la contraseña utilizando el algoritmo hash <strong>sha-1</strong>. Por simplicidad este ejemplo lo he hecho en <strong>PHP</strong>, pero no tiene complicación hacerlo en <a title="(Java) Securización de formulario de acceso con SHA-1" href="/java-securizacion-de-formulario-de-acceso-con-sha-1/"><strong>Java</strong></a>. He utilizado también la librería de javaScript <strong>PHP.js</strong> que no conocía pero &#8216;<em>me ha gustado su lógica</em>&#8216; 🙂</p>
<p>Bueno este es el problema y esta es la solución que propongo. Al lío&#8230; <a href="/securizacion-de-formulario-de-acceso-con-sha-1/#more-68" class="more-link">Sigue leyendo <span class="meta-nav">&rarr;</span></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			Esta entrada se publicó en <a href="/category/programacion/javascript/" rel="category tag">JavaScript</a>, <a href="/category/programacion/php/" rel="category tag">PHP</a> y está etiquetada con <a href="/tag/acceso/" rel="tag">acceso</a>, <a href="/tag/javascript/" rel="tag">JavaScript</a>, <a href="/tag/login/" rel="tag">login</a>, <a href="/tag/php/" rel="tag">PHP</a>, <a href="/tag/securizar/" rel="tag">securizar</a>, <a href="/tag/sha-1/" rel="tag">SHA-1</a> en <a href="/securizacion-de-formulario-de-acceso-con-sha-1/" title="12:06" rel="bookmark"><time class="entry-date" datetime="2013-04-19T12:06:10+00:00">19 abril, 2013</time></a><span class="by-author"> por <span class="author vcard"><a class="url fn n" href="/author/miguel/" title="Ver todas las entradas de Miguel R. Esteban Martín" rel="author">Miguel R. Esteban Martín</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
			
					<nav id="nav-below" class="navigation" role="navigation">
			<h3 class="assistive-text">Navegación de entradas</h3>
			<div class="nav-previous"><a href="/author/miguel/page/2/" ><span class="meta-nav">&larr;</span> Entradas más antiguas</a></div>
			<div class="nav-next"></div>
		</nav><!-- .navigation -->
	
		
		</div><!-- #content -->
	</section><!-- #primary -->


			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-3" class="widget widget_text">			<div class="textwidget"><a href="/feed/" title="Suscribirse a este sitio usando RSS 2.0"><img class="alignnone" alt="[RSS]" src="/wp-content/uploads/2013/04/rss_copy.png" width="20" height="20" /></a>&nbsp;&nbsp;<a href="/feed/" title="Suscribirse a este sitio usando RSS 2.0"><abbr title="Really Simple Syndication">RSS</abbr> de las entradas</a></div>
		</aside>		<aside id="recent-posts-2" class="widget widget_recent_entries">		<h3 class="widget-title">Entradas recientes</h3>		<ul>
					<li>
				<a href="/charla-commit-conf-2023-sobre-programacion-funcional-y-patrones-funcionales/">Charla Commit Conf 2023 sobre programación funcional y patrones funcionales</a>
						</li>
					<li>
				<a href="/notas-sobre-aprendizaje-por-refuerzo/">Notas sobre aprendizaje por refuerzo</a>
						</li>
					<li>
				<a href="/diapositivas-de-la-charla-de-commit-conf/">Vídeo y diapositivas de la charla de Commit Conf</a>
						</li>
					<li>
				<a href="/futuros-y-promesas-y-tambien-monadas-implementando-el-patron/">Futuros y promesas,&#8230; y también monadas. Implementando el patrón</a>
						</li>
					<li>
				<a href="/akka-por-ejemplos-actores-tipados/">Actores tipados, Akka por ejemplos</a>
						</li>
				</ul>
		</aside>		<aside id="text-2" class="widget widget_text"><h3 class="widget-title">Sobre el autor</h3>			<div class="textwidget"><a href="/mi-cv"><a href="/mi-cv/#imagenMiCV"><img class="alignright" alt="[Sobre el autor]" src="/wp-content/uploads/2013/04/miguel_p_90x82_claro.jpg" /></a>
<small>Mi nombre es Miguel Rafael Esteban Martín. Llevo más de 20 años trabajando como&nbsp;desarrollador&nbsp; y &nbsp;arquitecto&nbsp; de software en diferentes empresas, lenguajes de programación y plataformas.<br/>
En este blog hablaré sobre programación y tecnología e intentaré hacerlo de manera clara y amena.<br/>
Actualmente trabajando como programador de software en Darwinex.<br/>
Más sobre mi en el enlace <strong><a href="/mi-cv/#imagenMiCV">Mi CV</a></strong></small>

<p style="text-align: center;"><small><strong>Contacto</strong><br/>
<a href="/mi-cv/#email"><img class="alignnone" alt="[correo electrónico]" src="/wp-content/uploads/2013/04/e_mail_p.png" width="32" height="32" /></a><a href="http://es.linkedin.com/in/miguelresteban"><img class="size-full wp-image-25 alignnone" alt="[Perfil en LinkedIn]" src="/wp-content/uploads/2013/04/linkedin.png" width="32" height="32" /></a><a href="https://twitter.com/MiguelREsteban"><img class="size-full wp-image-25 alignnone" alt="[Perfil en Twitter]" src="/wp-content/uploads/2013/04/twitter.png" width="32" height="32" /></a><a href="https://github.com/logicaalternativa"><img class="size-full wp-image-25 alignnone" alt="[Perfil en GitHub]" src="/wp-content/uploads/2013/09/GitHub-Mark-32px.png" width="32" height="32" /></a>
</small></p></div>
		</aside><aside id="text-8" class="widget widget_text">			<div class="textwidget"> <!-- De aquí -->
    <div id="twitter"></div>    
    <script type="text/javascript" src="/etc/ejemplos/php/twiter-api/js/carga-widget.js.php"></script>
    <!-- hasta aquí --></div>
		</aside><aside id="categories-4" class="widget widget_categories"><h3 class="widget-title">Categorías</h3>		<ul>
	<li class="cat-item cat-item-15"><a href="/category/programacion/android/" >Android</a>
</li>
	<li class="cat-item cat-item-36"><a href="/category/apis/" >APIs</a>
</li>
	<li class="cat-item cat-item-64"><a href="/category/control-de-la-configuracion/" >Control de la configuración</a>
</li>
	<li class="cat-item cat-item-57"><a href="/category/criptografia-y-certificados/" >Criptografía y certificados</a>
</li>
	<li class="cat-item cat-item-98"><a href="/category/programacion/funcional/" title="Programación funcional">Funcional</a>
</li>
	<li class="cat-item cat-item-10"><a href="/category/general/" >General</a>
</li>
	<li class="cat-item cat-item-90"><a href="/category/inteligencia-artificial/" >Inteligencia artificial</a>
</li>
	<li class="cat-item cat-item-14"><a href="/category/programacion/java/" >Java</a>
</li>
	<li class="cat-item cat-item-8"><a href="/category/programacion/javascript/" >JavaScript</a>
</li>
	<li class="cat-item cat-item-21"><a href="/category/la-nube/" >La Nube</a>
</li>
	<li class="cat-item cat-item-87"><a href="/category/programacion/patrones/" >Patrones</a>
</li>
	<li class="cat-item cat-item-3"><a href="/category/programacion/php/" >PHP</a>
</li>
	<li class="cat-item cat-item-100"><a href="/category/presentaciones/" title="Presentaciones en eventos y conferencias">Presentaciones</a>
</li>
	<li class="cat-item cat-item-20"><a href="/category/programacion/" >Programación</a>
</li>
	<li class="cat-item cat-item-105"><a href="/category/programacion/reactiva/" >Reactiva</a>
</li>
	<li class="cat-item cat-item-99"><a href="/category/programacion/scala/" >Scala</a>
</li>
	<li class="cat-item cat-item-16"><a href="/category/sistemas-operativos/" >Sistemas operativos</a>
</li>
		</ul>
</aside>		</div><!-- #secondary -->
		</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
			<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.es_ES"><img alt="Licencia de Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Lógica Alternativa</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.logicaalternativa.com/mi-cv/" property="cc:attributionName" rel="cc:attributionURL">Miguel Rafael Esteban Martín</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.es_ES">Creative Commons Reconocimiento-NoComercial 3.0 Unported License</a>.		
			<!--
						<a href="https://wordpress.org/" title="Plataforma semántica de publicación personal">Creado con WordPress</a>
			-->
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type='text/javascript' src='/wp-content/themes/twentytwelve/js/navigation.js?ver=20140711'></script>
<script type='text/javascript' src='/wp-includes/js/wp-embed.min.js?ver=4.7.26'></script>
</body>
</html>
